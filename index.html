<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive STEM Animation Platform | ImagineASTORE Play</title>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
     <meta name="description" content="Experience ImagineASTORE's interactive STEM animation platform. Visualize equations, engage students, and transform learning. Try it now!">
     <meta name="robots" content="index, follow">
     <!-- **IMPORTANT**: Canonical URL is the preferred URL for THIS page -->
     <link rel="canonical" href="https://play.imaginea.store/" />
 
     <!-- ====== Social Media Meta Tags (Open Graph & Twitter) ====== -->
         <meta property="og:title" content="Interactive STEM Animation Platform | ImagineASTORE Play" />
     <meta property="og:description" content="Experience ImagineASTORE's interactive STEM animation platform. Visualize equations, engage students, and transform learning. Try it now!" />
     <meta property="og:type" content="website" />
     <meta property="og:url" content="https://play.imaginea.store/" />
     <meta property="og:image" content="https://play.imaginea.store/images/social-preview.jpg" /> 
     <meta property="og:site_name" content="ImagineASTORE" />
 
     <meta name="twitter:card" content="summary_large_image" />
     <meta name="twitter:title" content="Interactive STEM Animation Platform | ImagineASTORE Play" />
     <meta name="twitter:description" content="Experience ImagineASTORE's interactive STEM animation platform..." />
     <meta name="twitter:image" content="https://play.imaginea.store/images/social-preview.jpg" />
      <meta name="twitter:site" content="@YourImagineaStoreTwitterHandle"> 
 
     <!-- ====== Favicon Links (Host these files appropriately) ====== -->
     <link rel="icon" href="/favicon.ico" sizes="any">
     <link rel="icon" href="/favicon.svg" type="image/svg+xml">
     <link rel="apple-touch-icon" href="/apple-touch-icon.png">
     <link rel="manifest" href="/site.webmanifest">
 
    <style>

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        
        body {
            overflow-x: hidden;
            background-color: #0A192F; /* Deep Blue */
            color: #ccd6f6; /* Light text */
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            height: 800vh;
        }

        .container {
            width: 90%;
            max-width: 1140px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .section {
            padding: 80px 0;
            position: relative; /* For absolute elements if needed */
            z-index: 4; /* Above wrapper background */
        }

        .section-title {
            font-size: 2.5rem; /* 40px */
            color: #64ffda; /* Teal accent */
            text-align: center;
            margin-bottom: 1rem; /* 16px */
            font-weight: 600;
        }

        .section-subtitle {
            font-size: 1.125rem; /* 18px */
            color: #8892b0; /* Lighter slate */
            text-align: center;
            max-width: 600px;
            margin: 0 auto 3.5rem; /* 56px */
            line-height: 1.7;
        }

        /* --- Landing Section --- */
        #landing-section {
            height: 100vh; width: 100%; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
            background-color: #07111f; position: relative; 
            z-index: 5;
             padding: 20px;
        }
        #landing-section h1 { font-size: 3rem; margin-bottom: 20px; color: #64ffda; }
        #landing-section p { font-size: 1.2rem; max-width: 600px; margin-bottom: 30px; line-height: 1.6; color: #a8b2d1; }
        #landing-section .scroll-down-indicator {
            position: absolute; bottom: 30px; left: 50%;
            transform: translateX(-50%); font-size: 0.9rem; color: #8892b0;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
             0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
             40% { transform: translateX(-50%) translateY(-10px); }
             60% { transform: translateX(-50%) translateY(-5px); }
        }

        /* --- Animation Wrapper --- */
        #animation-wrapper {
            height: 1000vh; /* Controls scroll duration for animation */
            position: relative;
            z-index: 2;
            margin-top: -1px; /* Prevent tiny gaps */
            padding-top: 1px;
            /* background: #112240; */
        }

        /* --- Canvas Container (Sticky) --- */
        #canvas-container {
            width: 100%;
            height: 100vh;
            position: sticky;
            top: 0;
            overflow: hidden;
            z-index: 3;
            /* background-color: #0A192F; */
        }

        /* --- Canvas Itself (Absolute) --- */
        #busCanvas {
            display: block; position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; z-index: 1;
        }

        /* --- Content Sections (Features, Workflow, Testimonials, CTA) --- */

        /* Features Section */
        .features { background-color: #0d1b2f; } /* Slightly lighter than body */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }
        .feature-card {
            background-color: #112240; /* Darker card background */
            padding: 35px 30px;
            border-radius: 8px;
            border: 1px solid #1d3150; /* Subtle border */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-align: center;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .feature-card .icon {
            margin-bottom: 20px;
        }
        .feature-card .icon svg {
            width: 48px;
            height: 48px;
            stroke: #64ffda; /* Icon color */
            /* Animation applied via inline SVG */
        }
        .feature-card h3 {
            font-size: 1.25rem; /* 20px */
            color: #ccd6f6;
            margin-bottom: 10px;
            font-weight: 500;
        }
        .feature-card p {
            font-size: 0.95rem; /* ~15px */
            color: #8892b0;
        }

        /* Workflow Section */
        .workflow { background-color: #0A192F; } /* Match body */
        .workflow-steps {
            display: flex;
            justify-content: space-between;
            gap: 30px;
            flex-wrap: wrap;
        }
        .step-card {
            background-color: #112240;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #1d3150;
            text-align: center;
            flex-basis: calc(33.333% - 20px); /* Adjust for gap */
            min-width: 250px;
            flex-grow: 1;
            position: relative;
             overflow: hidden;
        }

        .step-number {
            position: absolute;
            top: -10px;
            right: -5px;
            font-size: 4rem;
            font-weight: 700;
            color: rgba(100, 255, 218, 0.1); /* Faded accent color */
            line-height: 1;
             user-select: none;
        }
        .step-card h3 {
            font-size: 1.3rem;
            color: #ccd6f6;
            margin-bottom: 15px;
             position: relative; /* Keep above number */
             z-index: 1;
        }
        .step-card p {
            font-size: 0.95rem;
            color: #8892b0;
             position: relative; /* Keep above number */
             z-index: 1;
        }


        /* Testimonials Section */
        .testimonials { background-color: #0d1b2f; }
        .testimonial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        .testimonial-card {
            background-color: #112240;
            padding: 30px;
            border-radius: 8px;
            border-left: 4px solid #64ffda; /* Accent border */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .testimonial-text {
            font-style: italic;
            color: #a8b2d1;
            margin-bottom: 20px;
            font-size: 1rem;
        }
        .testimonial-text::before {
            content: 'â€œ';
            font-size: 2rem;
            color: #64ffda;
            position: relative;
            top: 5px;
            margin-right: 5px;
            line-height: 0;
        }
        .testimonial-author {
            display: flex;
            align-items: center;
        }
        .author-avatar {
            margin-right: 15px;
        }
        .author-avatar svg {
            width: 45px;
            height: 45px;
            border-radius: 50%;
        }
        .author-name {
            font-weight: 600;
            color: #ccd6f6;
            font-size: 1rem;
        }
        .author-role {
            font-size: 0.85rem;
            color: #8892b0;
        }


        /* CTA Section */
        .cta {
            background: linear-gradient(rgba(10, 25, 47, 0.85), rgba(10, 25, 47, 0.85)), url('https://via.placeholder.com/1500x500/112240/0A192F?text=Abstract+BG') center/cover no-repeat; /* Placeholder BG */
            text-align: center;
            padding: 100px 0;
        }
        .cta h2 {
            font-size: 2.2rem;
            color: #fff;
            margin-bottom: 15px;
        }
        .cta p {
            font-size: 1.1rem;
            color: #a8b2d1;
            max-width: 650px;
            margin: 0 auto 30px;
        }
        .cta-button {
            display: inline-block;
            background-color: #64ffda;
            color: #0A192F;
            padding: 14px 35px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: background-color 0.3s ease, transform 0.3s ease;
            border: 1px solid #64ffda;
        }
        .cta-button:hover {
            background-color: transparent;
            color: #64ffda;
             transform: translateY(-3px);
        }


        /* --- Footer --- */
        footer {
            background-color: #07111f; /* Darkest */
            padding: 60px 0 30px;
            color: #8892b0;
            font-size: 0.9rem;
        }
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }
        .footer-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ccd6f6;
            text-decoration: none;
            margin-bottom: 15px;
            display: inline-block;
        }
        .footer-logo span { color: #64ffda; }
        .footer-about { margin-bottom: 20px; line-height: 1.7; }
        .footer-social { display: flex; gap: 15px; }
        .social-icon {
            color: #a8b2d1;
            transition: color 0.3s ease, transform 0.3s ease;
            display: inline-block;
        }
        .social-icon svg { width: 20px; height: 20px; }
        .social-icon:hover { color: #64ffda; transform: translateY(-2px); }
        .footer-heading {
            font-size: 1.1rem;
            color: #ccd6f6;
            margin-bottom: 15px;
            font-weight: 500;
        }
        .footer-links { list-style: none; padding: 0; margin: 0; }
        .footer-links li { margin-bottom: 10px; }
        .footer-links a {
            color: #8892b0;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .footer-links a:hover { color: #64ffda; }

        .footer-subscribe { margin-bottom: 40px; border-top: 1px solid #1d3150; padding-top: 30px;}
        .subscribe-form { display: flex; margin-bottom: 10px; max-width: 400px;}
        .subscribe-form input[type="email"] {
            flex-grow: 1; padding: 10px 15px; border: 1px solid #1d3150;
            background-color: #0A192F; color: #ccd6f6; border-radius: 4px 0 0 4px;
            outline: none;
        }
        .subscribe-form button {
            padding: 10px 15px; background-color: #64ffda; color: #0A192F;
            border: none; border-radius: 0 4px 4px 0; font-weight: 600; cursor: pointer;
            transition: background-color 0.3s ease;
        }
         .subscribe-form button:hover { background-color: #52c4b3; }
        .subscribe-text { font-size: 0.85rem; color: #8892b0; }


        .footer-bottom {
            border-top: 1px solid #1d3150;
            padding-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 0.85rem;
        }
        .footer-bottom-links a {
            color: #8892b0; text-decoration: none; margin-left: 15px;
            transition: color 0.3s ease;
        }
         .footer-bottom-links a:hover { color: #64ffda; }

        /* --- Fixed Overlays --- */
        #info { /* ... styles ... */ z-index: 10; }
        #scrollInfo { /* ... styles ... */ z-index: 10; }

        /* --- SVG Background --- */
        #bg-animation { /* ... styles ... */ z-index:5; }
        /* SVG Animations & Styles */
        /* ... (include all necessary SVG styles) ... */

        /* --- Animation Placeholders --- */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .animate-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        /* Basic stagger effect placeholder */
        .stagger-children > * {
             opacity: 0;
             transform: translateY(20px);
             transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .stagger-children.is-visible > * {
             opacity: 1;
             transform: translateY(0);
        }
        /* Add transition-delay in JS for actual stagger */

    </style>
      <style>
        #busCanvas { display: block; width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; }

/* --- Start: Provided Root Variables & Base Styles --- */
:root{--space-3xs: clamp(.25rem, .2411rem + .0446vi, .3125rem);--space-2xs: clamp(.5rem, .4821rem + .0893vi, .625rem);--space-xs: clamp(.75rem, .7232rem + .1339vi, .9375rem);--space-s: clamp(1rem, .9643rem + .1786vi, 1.25rem);--space-m: clamp(1.5rem, 1.4464rem + .2679vi, 1.875rem);--space-l: clamp(2rem, 1.9286rem + .3571vi, 2.5rem);--space-xl: clamp(3rem, 2.8929rem + .5357vi, 3.75rem);--space-2xl: clamp(4rem, 3.8571rem + .7143vi, 5rem);--space-3xl: clamp(5rem, 4.8214rem + .8929vi, 6.25rem);--space-4xl: clamp(6rem, 5.7857rem + 1.0714vi, 7.5rem);--space-5xl: clamp(7rem, 6.75rem + 1.25vi, 8.75rem);--space-6xl: clamp(8rem, 7.7143rem + 1.4286vi, 10rem);--space-7xl: clamp(9rem, 8.6786rem + 1.6071vi, 11.25rem);--space-8xl: clamp(10rem, 9.6429rem + 1.7857vi, 12.5rem);--space-3xs-2xs: clamp(.25rem, .1964rem + .2679vi, .625rem);--space-2xs-xs: clamp(.5rem, .4375rem + .3125vi, .9375rem);--space-xs-s: clamp(.75rem, .6786rem + .3571vi, 1.25rem);--space-s-m: clamp(1rem, .875rem + .625vi, 1.875rem);--space-m-l: clamp(1.5rem, 1.3571rem + .7143vi, 2.5rem);--space-l-xl: clamp(2rem, 1.75rem + 1.25vi, 3.75rem);--space-xl-2xl: clamp(3rem, 2.7143rem + 1.4286vi, 5rem);--space-2xl-3xl: clamp(4rem, 3.6786rem + 1.6071vi, 6.25rem);--space-3xl-4xl: clamp(5rem, 4.6429rem + 1.7857vi, 7.5rem);--space-4xl-5xl: clamp(6rem, 5.6071rem + 1.9643vi, 8.75rem);--space-5xl-6xl: clamp(7rem, 6.5714rem + 2.1429vi, 10rem);--space-6xl-7xl: clamp(8rem, 7.5357rem + 2.3214vi, 11.25rem);--space-7xl-8xl: clamp(9rem, 8.5rem + 2.5vi, 12.5rem);--space-xs-m: clamp(.75rem, .5893rem + .8036vi, 1.875rem);--space-4xl-8xl: clamp(6rem, 5.0714rem + 4.6429vi, 12.5rem);--space-s-l: clamp(1rem, .7857rem + 1.0714vi, 2.5rem);--space-2xl-8xl: clamp(4rem, 2.7857rem + 6.0714vi, 12.5rem);--space-2xl-5xl: clamp(4rem, 3.3214rem + 3.3929vw, 8.75rem)}@font-face{font-family:IBM Plex Mono;src:url(/assets/fonts/IBMPlexMono-Regular.woff2) format("woff2");font-style:normal;font-weight:400;font-display:swap}:root{--initial-vh: 1vh;--actual-vh: 1vh;--body-font-size: var(--fluid-16-18);--font-family-heading: "neue-haas-grotesk-display", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; /* Added fallback */ --font-family-body: "neue-haas-grotesk-text", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; /* Added fallback */ 
--body-background-color: #0A192F;

--body-text-color: var(--color-white);--body-line-height: 1.5;--column-width: calc((100vw - var(--container-padding) * 2 - var(--gutter) * 11) / 12);--column-width-gutter: calc(var(--column-width) + var(--gutter));--column-width-2-gutter: calc(var(--column-width) + var(--gutter) * 2);--site-header-height: calc(var(--space-xl-2xl) * 1.1);--height-without-header: calc(var(--vh) * 100 - var(--site-header-height));--fast-start-easing: cubic-bezier(.17, .67, .1, .99);--faster-start-easing: cubic-bezier(.19, 1, .22, 1);--slow-start-easing: cubic-bezier(.73, 0, 0, 1);--content-list-image-size: calc(var(--space-8xl) * 1.2);--container-padding: 20px;--gutter: 10px;--site-header-height: 0px;--color-error: #ff1a1a;--color-white: #f6f6f6;--color-black: #000000;--color-orange: #ec5d40;--color-primary: #2622f7;--color-light-gray: #fff2e2;--color-primary-01: #4991e5;--color-primary-02: #39bdd6;--color-primary-03: #3bd4cb;--color-primary-04: #BAD7F5;--color-primary-05: #e4ecf4;--color-gray: #a7a6a6;--color-gray-light: #c8c7c7;--color-dark: #121111;--breakpoints-xs: 0;--breakpoints-ss: 360px;--breakpoints-sm: 940px;--breakpoints-md: 1024px;--breakpoints-md2: 1155px;--breakpoints-ml: 1340px;--breakpoints-lg: 1440px;--breakpoints-lg2: 1600px;--breakpoints-xl: 1960px;--breakpoints-xxl: 2400px}@media (min-width: 940px){:root{--container-padding: 3vw}}@media (min-width: 940px){:root{--gutter: 1vw}}@media (min-width: 1024px){:root{--site-header-height: 0px}}*,*:before,*:after{box-sizing:border-box}*{padding:0;margin:0}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:var(--body-background-color, #fff);color:var(--body-text-color, #000);font-family:var(--font-family-body), sans-serif; /* Added generic fallback */ font-size:var(--body-font-size);font-weight:var(--body-font-weight, 400);line-height:var(--body-line-height, 1.5);tab-size:4;-webkit-tap-highlight-color:transparent;text-size-adjust:100%; overflow-x: hidden; /* Prevent horizontal scroll from animations */ }img,picture,video,canvas,svg{display:block;width:100%;max-width:100%}article,figure,footer,header,aside,main,nav{display:block}input,button,select,optgroup,textarea{color:var(--body-text-color, currentcolor);font-family:inherit;font-size:inherit;font-weight:inherit;line-height:inherit}table{border-collapse:collapse}a[href^="tel:"]{text-decoration:none!important}a[href^="mailto:"]{user-select:auto!important}button,[role=button]{padding:0;border:none;margin:0;appearance:none;background:none;box-shadow:none;color:inherit;cursor:pointer;font:inherit;text-align:left;user-select:none}select{word-wrap:normal}select:disabled{opacity:1}textarea{resize:vertical}fieldset{min-width:0;border:0}svg,symbol,iframe{border:none} /* Added symbol, iframe */dfn{font-style:normal}abbr{text-decoration:none}hr{height:0;color:inherit}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}
/* Removed html,body position:fixed; to allow scrolling */
html,body{top:0;left:0;width:100%; min-height:100%; /* Use min-height to allow content growth */ margin:0;padding:0;border:0;touch-action:manipulation; /* Allow pinch-zoom etc. */ font-synthesis:none;text-rendering:optimizelegibility}
img{-webkit-user-drag:none;-khtml-user-drag:none;-moz-user-drag:none;-o-user-drag:none;}button,input,textarea,img,picture,canvas,svg{-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}::-moz-selection{color:var(--color-white);background:#267ee2}::selection{color:var(--color-white);background:#267ee2;-webkit-text-fill-color:var(--color-white)}html.no-js body{display:none}html{scrollbar-width:none!important;-ms-overflow-style:none}html body::-webkit-scrollbar{display:none}
/* These canvas/ui rules seem irrelevant now but kept just in case */
/* #canvas{display:none;pointer-events:auto;position:absolute;top:0;left:0;width:100%;height:100%}.is-ready #canvas{display:block}#ui{display:none;width:100%;pointer-events:none}.is-ready #ui{display:block;pointer-events:auto}#ui.is-hidden,#ui.is-hidden *{display:none;pointer-events:none}#pages-container{position:relative;width:100%;height:100%}.page{position:relative;width:100%;opacity:0}.section{position:relative} */
a{color:currentcolor;outline:none;text-decoration:none;-webkit-touch-callout:none;user-select:none}a:hover{text-decoration:none}*:focus{outline:none}ul{list-style:none}
/* O-rimlight rule - can be applied to elements if desired */
.o-rimlight{--rim-angle: 0;--border-radius: 8px;position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:0}.o-rimlight:before,.o-rimlight:after{position:absolute;content:"";width:calc(100% + 2px);height:calc(100% + 2px);left:-1px;top:-1px;border-radius:var(--border-radius);padding:1px;background-image:conic-gradient(from var(--rim-angle),rgb(57,189,214) 0%,rgba(73,145,229,.5) 15%,transparent 30%,transparent 35%,rgba(73,145,229,.18) 50%,transparent 65%,transparent 75%,rgba(73,145,229,.2) 95%,rgb(57,189,214))}.o-rimlight:before{filter:blur(5px);opacity:.5}
:root{--font-base-multiplier: 1;--fluid-36-80: calc(clamp(2.25rem, 1.5825rem + 2.8479vw, 7.75rem) * var(--font-base-multiplier));--fluid-22-40: calc(clamp(1.375rem, 1.1019rem + 1.165vw, 3.625rem) * var(--font-base-multiplier));--fluid-20-30: calc(clamp(1.25rem, 1.0983rem + .6472vw, 2.5rem) * var(--font-base-multiplier));--fluid-18-30: calc(clamp(1.125rem, .943rem + .7767vw, 1.875rem) * var(--font-base-multiplier));--fluid-16-22: calc(clamp(1rem, .909rem + .3883vw, 1.375rem) * var(--font-base-multiplier));--fluid-16-18: calc(clamp(1rem, .9697rem + .1294vw, 1.125rem) * var(--font-base-multiplier));--fluid-14-18: calc(clamp(.875rem, .8143rem + .2589vw, 1.125rem) * var(--font-base-multiplier));--fluid-14-16: calc(clamp(.875rem, .8447rem + .1294vw, 1rem) * var(--font-base-multiplier));--fluid-12-16: calc(clamp(.75rem, .6893rem + .2589vw, 1rem) * var(--font-base-multiplier));--fluid-30-16: calc(clamp(1rem, 2.0874rem + -.9061vw, 1.875rem) * var(--font-base-multiplier));--h1: var(--fluid-36-80);--h2: var(--fluid-22-40);--h3: var(--fluid-20-30);--h4: var(--fluid-18-30);--h5: var(--fluid-12-16);--h6: var(--fluid-16-22);--h7: var(--fluid-12-16);--body1: var(--fluid-14-18);--body2: var(--fluid-12-16);--link-header-internal: 16px;--link-header-external: 16px;--btn1: var(--fluid-16-18);--btn2: var(--fluid-14-16);--link-footer: 16px}@media (max-width: 939.98px){:root{--font-base-multiplier: 1.2}}@media (max-width: 359.98px){:root{--font-base-multiplier: 1}}@media (min-width: 1960px){:root{--multiplier: 1.25;--fluid-36-80: calc(clamp(2.25rem, 1.5825rem + 2.8479vw, 7.75rem) * var(--multiplier));--fluid-22-40: calc(clamp(1.375rem, 1.1019rem + 1.165vw, 3.625rem) * var(--multiplier));--fluid-20-30: calc(clamp(1.25rem, 1.0983rem + .6472vw, 2.5rem) * var(--multiplier));--fluid-18-30: calc(clamp(1.125rem, .943rem + .7767vw, 1.875rem) * var(--multiplier));--fluid-16-18: calc(clamp(1rem, .9697rem + .1294vw, 1.125rem) * var(--multiplier));--fluid-14-18: calc(clamp(.875rem, .8143rem + .2589vw, 1.125rem) * var(--multiplier));--fluid-14-16: calc(clamp(.875rem, .8447rem + .1294vw, 1rem) * var(--multiplier));--fluid-12-16: calc(clamp(.75rem, .6893rem + .2589vw, 1rem) * var(--multiplier));--fluid-30-16: calc(clamp(1rem, 2.0874rem + -.9061vw, 1.875rem) * var(--multiplier))}}@media (max-width: 359.98px){:root{--link-header-internal: 14px;--link-header-external: 14px}}
h1,h2,h3,h4,h5,h6{font-family:var(--font-family-heading), sans-serif; /* Added generic fallback */ font-weight:400;line-height:calc(1.1em + 4px)}
/* Adjusting font sizes to use vars more consistently */
h1 { font-size: var(--h1); }
h2 { font-size: var(--h2); }
h3 { font-size: var(--h3); } /* Using H3 as base for feature titles */
h4 { font-size: var(--h4); } /* Adjusted footer heading */
h5 { font-size: var(--h5); } /* Adjusted workflow/feature titles */
h6 { font-size: var(--h6); }
/* --- End: Provided Root Variables & Base Styles --- */


/* --- Subscription Form Styles --- */
.footer-subscribe {
grid-column: 1 / -1; /* Span all columns */
margin-bottom: var(--space-2xl);
}

.subscribe-form {
display: flex;
gap: var(--space-xs);
margin-top: var(--space-m);
}

.subscribe-form input {
flex: 1;
padding: var(--space-xs);
border-radius: 8px;
border: 1px solid rgba(73, 145, 229, 0.3);
background: rgba(16, 19, 28, 0.7);
color: var(--color-white);
font-size: var(--body2);
transition: border-color 0.3s var(--fast-start-easing);
}

.subscribe-form input:focus {
outline: none;
border-color: var(--color-primary-02);
}

.subscribe-form button {
white-space: nowrap;
padding: var(--space-xs) var(--space-m);
font-size: var(--body2);
}

.subscribe-text {
margin-top: var(--space-xs);
font-size: calc(var(--body2) * 0.9);
opacity: 0.8;
}

@media (max-width: 640px) {
.subscribe-form {
flex-direction: column;
}
}

/* Custom styles for the landing page */
html {
    scroll-behavior: smooth; /* Add smooth scroll */
}
body {
    font-family: var(--font-family-body), sans-serif; /* Ensure fallback font works */
    background-color: var(--body-background-color);
    color: var(--body-text-color);
    position: relative;
}

/* --- Background SVG Animation --- */
.bg-animation {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
z-index: 5;
pointer-events: none
}

/* --- Header --- */
#site-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    padding: var(--space-s) var(--container-padding); /* Use space variable */
    background-color: rgba(16, 19, 28, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px); /* Safari fallback */
    z-index: 100;
    transition: background-color 0.4s ease, padding 0.4s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#site-header.scrolled {
    background-color: rgba(16, 19, 28, 0.95);
     padding-top: var(--space-xs);
     padding-bottom: var(--space-xs);
     box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.logo {
    font-size: var(--h4); /* Responsive font size */
    font-weight: 700;
    color: var(--color-white);
    display: flex;
    align-items: center;
    transition: transform 0.3s var(--fast-start-easing);
    user-select: none; /* Prevent text selection */
}
.logo:hover {
    transform: scale(1.03);
}
.logo span {
    color: var(--color-primary-02);
}

.nav-links {
    display: flex;
    gap: var(--space-l); /* Use space variable */
    align-items: center; /* Align items including button */
}

.nav-links a:not(.button-primary) { /* Style links excluding the button */
    color: var(--color-white);
    transition: color 0.3s var(--fast-start-easing), transform 0.3s var(--fast-start-easing);
    font-size: var(--link-header-internal); /* Use font variable */
    position: relative;
    padding-bottom: 5px; /* Space for underline */
}
.nav-links a:not(.button-primary)::after { /* Add underline animation */
     content: '';
     position: absolute;
     width: 0;
     height: 2px;
     display: block;
     margin-top: 5px;
     right: 0;
     background: var(--color-primary-02);
     transition: width 0.3s var(--fast-start-easing);
     transition-timing-function: var(--fast-start-easing);
     bottom: 0; /* Position at the bottom */
     margin-top: 0;
}

.nav-links a:not(.button-primary):hover::after {
    width: 100%;
    left: 0;
    background-color: var(--color-primary-02);
}
.nav-links a:not(.button-primary):hover {
    color: var(--color-primary-02);
    transform: translateY(-2px);
}

.button-primary {
    background: linear-gradient(90deg, var(--color-primary-01), var(--color-primary-02));
    color: var(--color-white) !important; /* Ensure text color overrides general 'a' color */
    padding: var(--space-xs) var(--space-m);
    border-radius: 8px;
    font-weight: 500;
    transition: transform 0.3s var(--fast-start-easing), box-shadow 0.3s var(--fast-start-easing);
    box-shadow: 0 4px 15px rgba(57, 189, 214, 0.2); /* Subtle glow */
    font-size: var(--btn1); /* Use font variable */
    display: inline-block; /* Behave like a button */
    text-decoration: none; /* Remove default link underline */
    border: none;
    cursor: pointer;
}
.button-primary:hover {
    transform: scale(1.05) translateY(-2px); /* Enhanced hover */
    box-shadow: 0 6px 20px rgba(57, 189, 214, 0.4); /* Brighter glow */
    color: var(--color-white) !important;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--container-padding);
    position: relative; /* Needed for elements inside relying on container bounds */
    z-index: 1; /* Ensure container content is above section backgrounds */
}

/* --- Hero Section --- */
.hero {
    padding-top: calc(var(--space-6xl) + 80px); /* Increased padding top + approx header height */
    padding-bottom: var(--space-4xl);
    background: radial-gradient(circle at 20% 20%, rgba(38, 65, 102, 0.6), var(--body-background-color) 70%), /* Faded gradient */
                var(--body-background-color); /* Solid background */
    position: relative;
    overflow: hidden; /* Contain pseudo elements */
}

/* Animated background shapes */
.hero::before, .hero::after {
     content: '';
     position: absolute;
     border-radius: 50%;
     background: linear-gradient(45deg, var(--color-primary-01), var(--color-primary-02));
     opacity: 0.08; /* Reduced opacity */
     filter: blur(80px); /* Increased blur */
     z-index: 0;
     animation: backgroundPulse 15s infinite alternate ease-in-out;
 }

.hero::before {
    width: 400px; /* Larger */
    height: 400px;
    top: 10%;
    left: 5%;
     animation-delay: 0s;
 }

.hero::after {
    width: 500px; /* Larger */
    height: 500px;
    bottom: 10%; /* Adjusted */
    right: 5%; /* Adjusted */
    animation-delay: -5s; /* Offset animation */
}

@keyframes backgroundPulse {
     0% { transform: scale(1) rotate(0deg); opacity: 0.06; }
     50% { transform: scale(1.2) rotate(15deg); opacity: 0.1; }
     100% { transform: scale(1) rotate(0deg); opacity: 0.06; }
 }

.hero-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-xl);
    align-items: center;
    position: relative; /* Ensure content is above pseudo-elements */
    z-index: 1;
}

@media (max-width: 940px) {
    .hero-content {
        grid-template-columns: 1fr;
        text-align: center; /* Center text on mobile */
    }
    .hero-image {
        order: -1; /* Image appears first */
        max-width: 70%; /* Reduced size */
        margin: 0 auto var(--space-l); /* Add margin bottom */
    }
    .hero-text h1 {
        font-size: var(--h2); /* Slightly smaller H1 on mobile */
    }
    .hero-text p {
         max-width: 90%;
         margin-left: auto;
         margin-right: auto;
    }
    .hero-buttons {
         justify-content: center; /* Center buttons on mobile */
         flex-wrap: wrap; /* Allow buttons to wrap */
    }
}

.hero-text h1 {
    font-size: var(--h1);
    margin-bottom: var(--space-s);
    color: var(--color-white);
    line-height: 1.1;
    animation: fadeInUp 1s var(--slow-start-easing) 0.2s backwards;
}

.hero-text p {
    font-size: var(--body1);
    margin-bottom: var(--space-m);
    color: var(--color-primary-04);
    max-width: 450px;
    animation: fadeInUp 1s var(--slow-start-easing) 0.4s backwards;
}

.hero-buttons {
    display: flex;
    gap: var(--space-s);
    margin-top: var(--space-m);
    animation: fadeInUp 1s var(--slow-start-easing) 0.6s backwards;
}

.button-secondary {
    background: rgba(73, 145, 229, 0.1);
    border: 1px solid var(--color-primary-01);
    color: var(--color-white);
    padding: var(--space-xs) var(--space-m); /* Use space variable */
    border-radius: 8px;
    font-weight: 500;
    transition: background 0.3s var(--fast-start-easing), transform 0.3s var(--fast-start-easing), box-shadow 0.3s var(--fast-start-easing);
    font-size: var(--btn1); /* Use font variable */
    display: inline-block; /* Behave like a button */
    text-decoration: none;
    cursor: pointer;
}
.button-secondary:hover {
    background: rgba(73, 145, 229, 0.2);
    transform: scale(1.05) translateY(-2px);
     box-shadow: 0 4px 15px rgba(73, 145, 229, 0.2);
}

/* Animation styles */
@keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-15px) rotate(-1deg); } /* Added slight rotate */
    100% { transform: translateY(0px); }
}
.hero-image {
    animation: float 7s ease-in-out infinite; /* Slightly slower */
     transition: transform 0.5s var(--fast-start-easing); /* Smooth transition on resize */
     max-width: 100%; /* Ensure it doesn't overflow container */
}
@media (max-width: 940px) {
     .hero-image {
         animation: float 8s ease-in-out infinite; /* Even slower on mobile */
     }
 }


/* --- Shared Section Styles & Animations --- */
.section {
    padding: var(--space-5xl) 0; /* Consistent padding */
     position: relative; /* Contain animations/pseudo-elements */
     overflow: hidden; /* Prevent section background bleeds */
}
.section-title, .section-subtitle, .animate-on-scroll:not(.stagger-children > *) {
     /* Animation applied via JS '.is-visible' class */
     opacity: 0;
     transform: translateY(var(--space-s));
     transition: opacity 0.8s var(--slow-start-easing), transform 0.8s var(--slow-start-easing);
 }
.section-title.is-visible, .section-subtitle.is-visible, .animate-on-scroll.is-visible {
     opacity: 1;
     transform: translateY(0);
 }
 .section-title {
     text-align: center;
     font-size: var(--h2);
     margin-bottom: var(--space-s); /* Reduced margin */
     color: var(--color-white);
 }
 .section-subtitle {
     text-align: center;
     font-size: var(--body1);
     max-width: 700px;
     margin: 0 auto var(--space-xl); /* Adjusted margins */
     color: var(--color-primary-04);
     transition-delay: 0.15s; /* Stagger subtitle slightly */
 }

 /* Stagger children animation class */
 .stagger-children > * {
     opacity: 0;
     transform: translateY(var(--space-m));
     transition: opacity 0.6s var(--slow-start-easing), transform 0.6s var(--slow-start-easing);
     /* Delay is applied inline via JS */
 }

.stagger-children.is-visible > * {
     opacity: 1;
     transform: translateY(0);
 }

/* --- Features Section --- */
.features {
    background-color: var(--body-background-color); /* Ensure solid bg */
}
.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 280px), 1fr)); /* Adjusted minmax */
    gap: var(--space-l);
    margin-top: var(--space-xl);
}
.feature-card {
    background: linear-gradient(140deg, rgba(73, 145, 229, 0.05), rgba(57, 189, 214, 0.08)); /* More subtle */
    border-radius: 12px;
    padding: var(--space-l);
    transition: transform 0.4s var(--fast-start-easing), box-shadow 0.4s var(--fast-start-easing), border-color 0.4s var(--fast-start-easing); /* Use easing */
    height: 100%; /* Make cards in a row same height */
    position: relative;
    border: 1px solid rgba(73, 145, 229, 0.15); /* Slightly softer border */
    display: flex; /* Align content nicely */
    flex-direction: column; /* Stack content vertically */
    /* Inherits animation from .stagger-children parent */
}
.feature-card:hover {
    transform: translateY(-10px) scale(1.02); /* Add scale */
    border-color: rgba(73, 145, 229, 0.4);
    box-shadow: 0 10px 30px rgba(57, 189, 214, 0.15); /* Add shadow */
}
.feature-card::before { /* Top border reveal effect */
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    border-radius: 12px 12px 0 0; /* Match top corners */
    background: linear-gradient(90deg, var(--color-primary-01), var(--color-primary-02));
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s var(--fast-start-easing); /* Use easing */
}
.feature-card:hover::before {
    transform: scaleX(1);
}
.icon {
    width: 48px;
    height: 48px;
    margin-bottom: var(--space-s);
     transition: transform 0.4s var(--fast-start-easing);
     flex-shrink: 0; /* Prevent icon from shrinking */
}
.feature-card:hover .icon { /* Animate icon on card hover */
     transform: scale(1.1) rotate(-5deg);
}

.feature-card h3 {
    font-size: var(--h5); /* Match CSS definition */
    margin-bottom: var(--space-xs); /* Use variable */
    color: var(--color-primary-03);
}
.feature-card p {
    color: var(--color-primary-04);
    font-size: var(--body2);
    flex-grow: 1; /* Allow p to take remaining space */
}

/* --- Workflow Section --- */
.workflow {
     background: var(--body-background-color);
     position: relative;
}
.workflow::before { /* Background Gradient */
    content: '';
    position: absolute;
    top: -15%; /* Shift gradient position */
    left: -15%; /* Shift gradient position */
    width: 130%; /* Make gradient larger */
    height: 130%; /* Make gradient larger */
    background: radial-gradient(circle at 80% 20%, rgba(57, 189, 214, 0.06), transparent 60%); /* Softer gradient */
    animation: backgroundPulse 18s infinite alternate ease-in-out -3s; /* Reuse pulse but slower */
    z-index: 0; /* Behind content */
}

.workflow .container { /* Ensure container is above gradient */
     position: relative;
     z-index: 1;
 }

.workflow-steps {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-xl); /* Increased gap */
    margin-top: var(--space-xl);
}

@media (max-width: 940px) {
    .workflow-steps {
        grid-template-columns: 1fr;
        gap: var(--space-xl); /* More space on mobile stack */
    }
}

.step-card {
    background: rgba(19, 26, 41, 0.7); /* Darker background */
    border-radius: 12px;
    padding: var(--space-l) var(--space-l) var(--space-xl); /* More bottom padding */
    border: 1px solid rgba(73, 145, 229, 0.15);
    position: relative;
    /* Inherits animation from .stagger-children parent */
     transition: transform 0.3s var(--fast-start-easing), box-shadow 0.3s var(--fast-start-easing);
}
.step-card:hover {
     transform: translateY(-8px);
     box-shadow: 0 8px 25px rgba(57, 189, 214, 0.1);
}

.step-number {
    position: absolute;
    top: calc(-1 * var(--space-m)); /* Adjusted positioning */
    left: var(--space-l);
    width: calc(var(--space-m) * 2); /* Adjusted size */
    height: calc(var(--space-m) * 2);
    background: linear-gradient(135deg, var(--color-primary-01), var(--color-primary-02)); /* Steeper angle */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: var(--color-white);
    font-size: var(--body1);
    box-shadow: 0 4px 10px rgba(57, 189, 214, 0.3);
     transition: transform 0.3s var(--fast-start-easing);
}
 .step-card:hover .step-number {
      transform: scale(1.1) rotate(-5deg);
 }


.step-card h3 {
    font-size: var(--h5); /* Match definition */
    margin-top: calc(var(--space-m) * 1.5); /* Add space below number */
    margin-bottom: var(--space-xs); /* Use variable */
    color: var(--color-primary-02);
}

.step-card p {
    color: var(--color-primary-04);
    font-size: var(--body2);
}

/* --- Testimonials Section --- */
.testimonials {
     background: linear-gradient(180deg, var(--body-background-color) 0%, #131A29 90%); /* Use a dark color value */
}

.testimonial-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 300px), 1fr));
    gap: var(--space-l);
    margin-top: var(--space-xl);
}

.testimonial-card {
    background: rgba(38, 65, 102, 0.15); /* Use color var component with alpha */
    border-radius: 12px;
    padding: var(--space-l);
    border: 1px solid rgba(73, 145, 229, 0.1); /* Softer border */
     /* Inherits animation from .stagger-children parent */
     transition: background-color 0.3s var(--fast-start-easing);
     display: flex; /* Flex layout */
     flex-direction: column; /* Stack text and author */
     justify-content: space-between; /* Push author to bottom */
     height: 100%; /* Ensure cards in row match height */
}
.testimonial-card:hover {
     background: rgba(57, 189, 214, 0.1); /* Change background on hover */
}


.testimonial-text {
    color: var(--color-primary-04);
    font-size: var(--body2);
    margin-bottom: var(--space-m);
    font-style: italic;
    position: relative; /* For quote marks */
    padding-left: var(--space-l); /* More space for quote */
    flex-grow: 1; /* Allow text to take space */
}
 .testimonial-text::before { /* Add quote mark */
    content: '"';
    position: absolute;
    left: 0;
    top: -0.3em; /* Adjust vertical position */
    font-size: 4em; /* Larger quote */
    color: var(--color-primary-01);
    opacity: 0.2; /* More subtle */
    font-family: Georgia, serif;
    line-height: 1;
 }


.testimonial-author {
    display: flex;
    align-items: center;
    margin-top: var(--space-m); /* Space above author */
    flex-shrink: 0; /* Prevent author section shrinking */
}

.author-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: var(--space-s); /* Increase space */
     flex-shrink: 0; /* Prevent shrinking */
     border: 2px solid var(--color-primary-02); /* Add border */
     box-shadow: 0 0 10px rgba(57, 189, 214, 0.3);
     overflow: hidden; /* Ensure content fits */
}
.author-avatar svg, .author-avatar img { /* Ensure SVG/img fills avatar */
    width: 100%;
    height: 100%;
    object-fit: cover; /* Cover for images */
}

.author-details { /* Wrap name and role */
     line-height: 1.3;
}

.author-name {
    font-size: var(--body2);
    font-weight: 500;
    color: var(--color-white);
    display: block; /* Ensure block display */
}

.author-role {
    font-size: calc(var(--body2) * 0.9); /* Slightly smaller */
    color: var(--color-primary-03); /* Changed color slightly */
    display: block; /* Ensure block display */
    opacity: 0.8; /* Slightly less prominent */
}


/* --- CTA Section --- */
.cta {
    padding: var(--space-5xl) 0;
    background: linear-gradient(140deg, var(--color-primary-01), var(--color-primary-02) 120%); /* Extend gradient */
    text-align: center;
     position: relative;
     overflow: hidden;
}
 /* Add animated glow effect */
 .cta::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 120%; /* Large size */
      padding-bottom: 120%; /* Aspect ratio */
      border-radius: 50%;
      background: radial-gradient(circle, rgba(246, 246, 246, 0.1) 0%, rgba(246, 246, 246, 0) 65%); /* Adjusted opacity/stop */
      transform: translate(-50%, -50%) scale(0.8);
      animation: pulseGlow 5s infinite ease-out;
      z-index: 0;
  }

.cta .container { /* Keep content above glow */
      position: relative;
      z-index: 1;
  }

@keyframes pulseGlow {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.3; }
      50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.6; } /* More pronounced scale/opacity */
      100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.3; }
  }

.cta h2 {
    font-size: var(--h2);
    color: var(--color-white);
    margin-bottom: var(--space-m);
    text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.cta p {
    font-size: var(--body1);
    color: rgba(255, 255, 255, 0.9);
    max-width: 600px;
    margin: 0 auto var(--space-l);
}

.cta-button {
    background: var(--color-white);
    color: var(--color-primary-01) !important; /* Important to override link color */
    padding: var(--space-s) var(--space-l); /* Use variables */
    border-radius: 8px;
    font-weight: 600;
    font-size: var(--btn1);
    transition: transform 0.3s var(--fast-start-easing), box-shadow 0.3s var(--fast-start-easing);
    display: inline-block;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    text-decoration: none;
    border: none;
    cursor: pointer;
}
.cta-button:hover {
    transform: scale(1.05) translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
     color: var(--color-primary-01) !important;
}


/* --- Footer --- */
footer {
    background-color: #0C0F1A; /* Slightly darker than body */
    padding: var(--space-3xl) 0 var(--space-l); /* Adjusted padding */
    color: var(--color-primary-04);
    border-top: 1px solid rgba(73, 145, 229, 0.1);
    font-size: var(--body2); /* Base font size for footer */
}

.footer-grid {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: var(--space-xl); /* Increase gap */
    margin-bottom: var(--space-2xl); /* Space before bottom */
}

@media (max-width: 940px) {
    .footer-grid {
        grid-template-columns: 1fr 1fr;
        gap: var(--space-l) var(--space-xl); /* Adjust row/column gap */
    }
    .footer-grid > div:first-child { /* Span logo/about across */
        grid-column: 1 / -1;
    }
}

@media (max-width: 640px) {
    .footer-grid {
        grid-template-columns: 1fr;
        gap: var(--space-xl); /* More vertical space */
    }
     .footer-grid > div:first-child {
         grid-column: auto; /* Reset span */
     }
}

.footer-logo {
    font-size: var(--h4); /* Adjusted size */
    font-weight: 700;
    color: var(--color-white);
    margin-bottom: var(--space-s);
    display: inline-block;
     transition: transform 0.3s var(--fast-start-easing);
     user-select: none;
 }
 .footer-logo:hover {
     transform: scale(1.03);
 }

.footer-logo span {
    color: var(--color-primary-02);
}

.footer-about {
    margin-bottom: var(--space-m);
    font-size: var(--body2);
    opacity: 0.8; /* Slightly less prominent */
    max-width: 350px; /* Limit width */
    line-height: 1.6;
}

.footer-heading {
    font-size: var(--h7); /* Match definition */
    color: var(--color-white);
    margin-bottom: var(--space-m); /* Increase space */
    font-weight: 500;
    text-transform: uppercase; /* Add style */
    letter-spacing: 0.5px; /* Add style */
     opacity: 0.9;
}

.footer-links {
    list-style: none;
    padding: 0;
    margin: 0;
}

.footer-links li {
    margin-bottom: var(--space-s); /* Increase space */
}

.footer-links a {
    color: var(--color-primary-04);
    transition: color 0.3s var(--fast-start-easing), padding-left 0.3s var(--fast-start-easing);
    font-size: var(--body2);
     position: relative;
}
.footer-links a:hover {
    color: var(--color-primary-02);
     padding-left: var(--space-xs); /* Indent on hover */
}
 .footer-links a:hover::before { /* Add indicator */
    content: 'â€º';
    position: absolute;
    left: 0;
    top: 0;
    color: var(--color-primary-02);
    line-height: 1; /* Align better */
}

.footer-social {
    display: flex;
    gap: var(--space-s); /* Increase gap */
    margin-top: var(--space-m);
}

.social-icon {
    width: 40px; /* Slightly larger */
    height: 40px;
    border-radius: 50%;
    background: rgba(73, 145, 229, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s var(--fast-start-easing), transform 0.3s var(--fast-start-easing);
}
.social-icon:hover {
    background: rgba(73, 145, 229, 0.3);
    transform: translateY(-3px) scale(1.1); /* Lift and scale */
}

.social-icon svg {
    width: 20px; /* Larger icon */
    height: 20px;
    fill: var(--color-primary-04);
     transition: fill 0.3s ease;
 }
 .social-icon:hover svg {
     fill: var(--color-white);
 }

.footer-bottom {
    margin-top: var(--space-l); /* Adjusted space */
    padding-top: var(--space-l); /* Increased space */
    border-top: 1px solid rgba(73, 145, 229, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: var(--body2);
     opacity: 0.7; /* Less prominent */
     flex-wrap: wrap; /* Allow wrapping */
     gap: var(--space-s); /* Gap between items */
}

@media (max-width: 640px) {
    .footer-bottom {
        flex-direction: column;
        gap: var(--space-m); /* Increase gap */
        text-align: center;
    }
}

.footer-bottom-links {
    display: flex;
    gap: var(--space-l); /* Increase gap */
    flex-wrap: wrap; /* Allow wrapping */
    justify-content: center; /* Center links if they wrap */
}

.footer-bottom-links a {
    color: var(--color-primary-04);
    transition: color 0.3s var(--fast-start-easing);
}
.footer-bottom-links a:hover {
    color: var(--color-primary-02);
}


/* --- Mobile Menu --- */
.mobile-menu-toggle {
    display: none;
    font-size: var(--h3); /* Larger toggle */
    cursor: pointer;
     background: none;
     border: none;
     color: var(--color-white);
     padding: var(--space-xs);
     z-index: 101; /* Above header */
      transition: transform 0.3s var(--fast-start-easing);
      line-height: 1; /* Prevent extra space */
}
.mobile-menu-toggle:hover {
     transform: scale(1.1);
     color: var(--color-primary-02); /* Highlight on hover */
}

@media (max-width: 768px) {
    .mobile-menu-toggle {
        display: block;
    }
    .nav-links {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh; /* Full height */
        background-color: rgba(16, 19, 28, 0.98); /* More opaque */
        backdrop-filter: blur(15px); /* Stronger blur */
         -webkit-backdrop-filter: blur(15px);
        flex-direction: column;
        align-items: center;
        justify-content: center; /* Center links vertically */
        padding: var(--space-m) 0;
        transform: translateX(100%);
        opacity: 0;
        visibility: hidden; /* Hide when inactive */
        transition: transform 0.4s var(--faster-start-easing), opacity 0.4s var(--faster-start-easing), visibility 0s 0.4s; /* Delay hiding */
        z-index: 99; /* Below toggle button */
        gap: var(--space-xl); /* Larger gap for full screen */
    }
    .nav-links.active {
        transform: translateX(0);
        opacity: 1;
        visibility: visible; /* Show when active */
         transition: transform 0.4s var(--faster-start-easing), opacity 0.4s var(--faster-start-easing), visibility 0s 0s;
    }
     /* Style mobile menu items */
     .nav-links a {
         font-size: var(--h3) !important; /* Larger font size, ensure override */
         opacity: 0;
         transform: translateY(20px);
         animation: mobileMenuItemFadeIn 0.5s var(--fast-start-easing) forwards;
         padding-bottom: 0; /* Remove padding for underline */
     }
     .nav-links a::after {
         display: none; /* Hide underline on mobile */
     }
      /* Ensure button looks correct */
     .nav-links .button-primary {
         padding: var(--space-m) var(--space-l); /* Larger padding */
         font-size: var(--h4); /* Larger font */
     }
     /* Stagger link animation */
    .nav-links.active a:nth-child(1) { animation-delay: 0.2s; }
    .nav-links.active a:nth-child(2) { animation-delay: 0.3s; }
    .nav-links.active a:nth-child(3) { animation-delay: 0.4s; }
    .nav-links.active a:nth-child(4) { animation-delay: 0.5s; } /* Apply to button too */
}
 @keyframes mobileMenuItemFadeIn {
     to {
         opacity: 1;
         transform: translateY(0);
     }
 }


/* --- Animation Keyframes --- */
@keyframes fadeInUp {
     from {
         opacity: 0;
         transform: translateY(var(--space-s));
     }
     to {
         opacity: 1;
         transform: translateY(0);
     }
}

/* --- Fix SVG potential overflow issue --- */
svg {
     max-width: 100%;
     height: auto;
 }


 /* --- Beta Signup Styles --- */
.beta-signup {
display: flex;
align-items: center;
gap: var(--space-xs);
position: relative;
}

.beta-input {
width: 0;
/* opacity: 0; */
padding: 20;
border: none;
background:  #ffffff !important;
color: var(--color-black);
border-radius: 4px;
font-size: var(--body2);
transition: all 0.3s var(--fast-start-easing);
transform: translateX(10px);
position: absolute;
right: 100%;
}

.beta-signup:hover .beta-input,
.beta-signup:focus-within .beta-input {
width: 180px;
opacity: 1;
padding: var(--space-3xs) var(--space-xs);
transform: translateX(0);
border: 1px solid rgba(57, 189, 214, 0.3);
}

.beta-button {
white-space: nowrap;
}

/* Mobile styles for beta signup */
@media (max-width: 768px) {
.beta-signup {
flex-direction: column;
width: 100%;
margin-top: var(--space-s);
}

.beta-input {
position: static;
width: 100% !important;
opacity: 1 !important;
transform: none !important;
margin-bottom: var(--space-xs);
}

.beta-button {
width: 100%;
}
}

/* General Section Styling (Assuming .section provides padding) */
#problem-section,
#feature-section,
#pricing-section {
    padding: 60px 0; /* Adjust padding as needed */
    z-index: 10;
    background-color: #0d1b2f; /* Slightly lighter background example
    /* border-top: 1px solid #1d3150; /* Optional separator */
}

#problem-section h2,
#feature-section h2,
#pricing-section h2 { /* Added pricing h2 */
    text-align: center;
    font-size: 2.2rem; /* Adjust size */
    color: #64ffda; /* Accent color (match theme) */
    margin-bottom: 40px; /* Space below heading */
}

/* Container for the icons */
#problem-icons,
#feature-icons {
    display: flex;
    flex-wrap: wrap; /* Allow items to wrap to the next line */
    justify-content: space-around; /* Distribute items nicely */
    align-items: flex-start; /* Align tops of containers */
    gap: 30px; /* Space between icon containers */
    margin-top: 30px;
    padding: 0 15px; /* Add some horizontal padding */
}

/* Individual Icon Container */
.icon-container {
    display: flex;
    flex-direction: column; /* Stack icon and text vertically */
    align-items: center; /* Center content horizontally */
    text-align: center;
    flex-basis: 150px; /* Suggest a starting width */
    flex-grow: 1; /* Allow containers to grow */
    max-width: 200px; /* Limit maximum width */
    padding: 15px;
    /* Optional: Add a background/border for visual separation */
    /* background-color: #112240; */
    
    /* border: 1px solid #1d3150; */
    border-radius: 8px;
}

/* Main Icon Styling */
.icon-container > .icon { /* Target the main icon */
    font-size: 3.5rem; /* Make icons larger */
    color: #64ffda; /* Accent color - Adjust to your theme */
    margin-bottom: 15px; /* Space below icon */
    transition: transform 0.3s ease, color 0.3s ease;
    cursor: pointer; /* Indicate it's clickable */
}

.icon-container > .icon:hover {
    transform: scale(1.1); /* Slightly enlarge on hover */
    color: #ffffff; /* Brighter color on hover - Adjust */
}

/* Icon Text Styling */
.icon-text {
    font-size: 0.95rem;
    color: #a8b2d1; /* Lighter slate color - Adjust */
    line-height: 1.5;
    margin-top: 5px;
}

/* Secondary Icons within the text */
.icon-text > .fa-solid,
.icon-text > .fa-regular {
    margin-left: 5px; /* Space from the text */
    font-size: 0.9em; /* Slightly smaller than the text */
    opacity: 0.8; /* Make them slightly less prominent */
    color: #8892b0; /* Slightly different color */
}

/* ========================================== */
/* Pricing Section Styling                    */
/* ========================================== */

#pricing-section .section-subtitle {
    font-size: 1.1rem;
    color: #a8b2d1;
    max-width: 700px;
    margin: 0 auto 40px;
    text-align: center;
}

.pricing-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); /* Responsive grid */
    gap: 30px; /* Space between cards */
    max-width: 1200px; /* Limit overall width */
    margin: 0 auto; /* Center the container */
    padding: 0 15px;
}

.pricing-card {
    background-color: #112240; /* Dark card background */
    border: 1px solid #1d3150; /* Subtle border */
    border-radius: 8px;
    padding: 30px 25px;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.pricing-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

/* Highlight the featured plan */
.pricing-card.featured {
    border-color: #64ffda; /* Accent border */
    box-shadow: 0 0 20px rgba(100, 255, 218, 0.2); /* Subtle glow */
    transform: scale(1.03); /* Slightly larger */
    position: relative; /* For potential ribbon/badge */
}

.pricing-card.featured:hover {
    transform: scale(1.03) translateY(-8px); /* Keep hover effect */
}

/* Optional: Add a "Most Popular" badge */
.pricing-card.featured::before {
    content: 'Most Popular';
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #64ffda;
    color: #0A192F;
    padding: 5px 12px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    white-space: nowrap;
}


.pricing-card h3 {
    font-size: 1.4rem;
    color: #ccd6f6; /* Light text */
    margin-bottom: 8px;
    text-align: center;
}

.pricing-card .student-count {
    font-size: 0.9rem;
    color: #8892b0; /* Lighter slate */
    text-align: center;
    margin-bottom: 20px;
    min-height: 2.5em; /* Ensure consistent spacing */
}

.price-container {
    margin-bottom: 25px;
    text-align: center;
    border-bottom: 1px solid #1d3150;
    padding-bottom: 25px;
}

.price-amount {
    font-size: 2.8rem;
    font-weight: 600;
    color: #ffffff; /* White */
}

.price-unit {
    font-size: 0.9rem;
    color: #8892b0; /* Lighter slate */
    margin-left: 5px;
}

.features-list {
    list-style: none;
    padding: 0;
    margin: 0 0 25px 0; /* Add bottom margin */
    flex-grow: 1; /* Make list take available space */
}

.features-list li {
    color: #a8b2d1; /* Light slate */
    font-size: 0.95rem;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
}

.features-list li::before {
    content: 'âœ“'; /* Checkmark */
    color: #64ffda; /* Accent color */
    font-weight: bold;
    margin-right: 10px;
    font-size: 1.1em;
}

.pricing-card .cta-button {
    display: block; /* Make button full width */
    width: 100%;
    text-align: center;
    margin-top: auto; /* Push button to bottom */
    padding: 12px 20px;
    font-size: 1rem;
    background-color: #64ffda;
    color: #0A192F;
    border: 1px solid #64ffda;
    border-radius: 4px;
    text-decoration: none;
    font-weight: 600;
    transition: background-color 0.3s ease, color 0.3s ease;
}

.pricing-card .cta-button:hover {
    background-color: transparent;
    color: #64ffda;
}

/* Style the enterprise button differently */
.pricing-card.enterprise .cta-button {
    background-color: transparent;
    color: #64ffda;
    border: 1px solid #64ffda;
}
.pricing-card.enterprise .cta-button:hover {
    background-color: #64ffda;
    color: #0A192F;
}


.pricing-footnote {
    text-align: center;
    margin-top: 40px;
    font-size: 0.85rem;
    color: #8892b0; /* Lighter slate */
    line-height: 1.6;
}


/* ========================================== */
/* Responsive Adjustments                     */
/* ========================================== */

@media (max-width: 768px) {
    #problem-icons,
    #feature-icons {
        flex-direction: column; /* Stack items vertically */
        align-items: center; /* Center items in the column */
        gap: 40px; /* Adjust vertical gap */
    }

    .icon-container {
        flex-basis: auto; /* Reset basis */
        max-width: 80%; /* Allow containers to take more width */
        width: 100%;
    }

    #problem-section h2,
    #feature-section h2,
    #pricing-section h2 {
        font-size: 1.8rem; /* Smaller headings on mobile */
    }

     /* Adjust pricing card grid for better stacking */
     .pricing-cards-container {
         grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Allow slightly wider cards before stacking */
     }

}

@media (max-width: 480px) {
    .icon-container > .icon {
        font-size: 3rem; /* Slightly smaller icons on very small screens */
    }
    .icon-text {
        font-size: 0.9rem;
    }

    .pricing-card {
         padding: 25px 20px; /* Less padding on small screens */
    }
    .price-amount {
         font-size: 2.5rem;
    }
    .pricing-card.featured::before {
        font-size: 0.75rem;
        padding: 4px 10px;
        top: -12px;
    }
}
</style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>    
    <header id="site-header">
    <a href="#" class="logo">Imagine<span>ASTORE</span></a>
    <nav>
        <button class="mobile-menu-toggle" aria-label="Toggle Menu" aria-expanded="false">â˜°</button>
        <div class="nav-links">
            <a href="#features">Features</a>
            <a href="#workflow">How It Works</a>
            <a href="#testimonials">Testimonials</a>
               <div class="beta-signup">
            <input type="email" placeholder="Your email" class="beta-input" aria-label="Email for beta access">
            <button class="button-primary beta-button">Join Beta</button>
        </div>
            <a href="play.html" class="button-primary">Try for Free</a> 
        </div>
    </nav>
</header>
    <!-- Section 1: Landing Page -->
    <section id="landing-section">
        <div class="container hero-content">
            <div class="hero-text">
                <h1>Transform STEM Education with Animation</h1>
                <p>imagine a store makes learning equations and concepts engaging through interactive animations. Help students visualize abstract concepts while reducing teacher workload.</p>
                <div class="hero-buttons">
                    <a href="play.html" class="button-primary">Get Started</a>
                    <a href="#" class="button-secondary">Watch Demo</a>
                </div>
            </div>
            <div class="hero-image">
                <svg viewBox="0 0 600 400" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <defs>
                      <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#070B34">
                          <animate attributeName="stop-color" values="#070B34;#0F2557;#070B34" dur="20s" repeatCount="indefinite" />
                        </stop>
                        <stop offset="50%" stop-color="#0F2557">
                          <animate attributeName="stop-color" values="#0F2557;#1E3B70;#0F2557" dur="15s" repeatCount="indefinite" />
                        </stop>
                        <stop offset="100%" stop-color="#131a29">
                          <animate attributeName="stop-color" values="#131a29;#0F2557;#131a29" dur="18s" repeatCount="indefinite" />
                        </stop>
                      </linearGradient>
                  
                      <linearGradient id="waveGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stop-color="#4991e5">
                          <animate attributeName="stop-color" values="#4991e5;#39bdd6;#6e48aa;#4991e5" dur="8s" repeatCount="indefinite" />
                        </stop>
                        <stop offset="50%" stop-color="#39bdd6">
                          <animate attributeName="stop-color" values="#39bdd6;#3bd4cb;#d667cd;#39bdd6" dur="8s" repeatCount="indefinite" />
                        </stop>
                        <stop offset="100%" stop-color="#3bd4cb">
                          <animate attributeName="stop-color" values="#3bd4cb;#4991e5;#42c6ff;#3bd4cb" dur="8s" repeatCount="indefinite" />
                        </stop>
                      </linearGradient>
                  
                      <filter id="neonGlow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="10" result="blur" />
                        <feComposite in="SourceGraphic" in2="blur" operator="over" />
                        <feColorMatrix type="matrix" values="
                          1 0 0 0 0
                          0 1 0 0 0.2
                          0 0 1 0 0.9
                          0 0 0 1 0" />
                      </filter>
                  
                      <filter id="softGlow" x="-20%" y="-20%" width="140%" height="140%">
                        <feGaussianBlur stdDeviation="4" result="blur" />
                        <feFlood flood-color="#4991e5" flood-opacity="0.3" result="color"/>
                        <feComposite in="color" in2="blur" operator="in" result="glow"/>
                        <feComposite in="SourceGraphic" in2="glow" operator="over" />
                        <animate attributeName="stdDeviation" values="4;6;4" dur="4s" repeatCount="indefinite" />
                      </filter>
                  
                      <filter id="textGlow" x="-30%" y="-30%" width="160%" height="160%">
                        <feGaussianBlur stdDeviation="3" result="blur" />
                        <feFlood flood-color="#39bdd6" flood-opacity="0.8" result="glowColor"/>
                        <feComposite in="glowColor" in2="blur" operator="in" result="softGlow"/>
                        <feComposite in="SourceGraphic" in2="softGlow" operator="over"/>
                        <animate attributeName="flood-opacity" values="0.8;0.2;0.8" dur="3s" repeatCount="indefinite" />
                      </filter>
                  
                  
                      <pattern id="gridPattern" width="40" height="40" patternUnits="userSpaceOnUse">
                        <rect width="40" height="40" fill="none" />
                        <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#1d2d50" stroke-width="0.5">
                          <animate attributeName="stroke-opacity" values="0.2;0.6;0.2" dur="10s" repeatCount="indefinite" />
                        </path>
                      </pattern>
                  
                      <radialGradient id="particleGradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                        <stop offset="0%" stop-color="#ffffff" stop-opacity="1" />
                        <stop offset="100%" stop-color="#39bdd6" stop-opacity="0" />
                      </radialGradient>
                  
                      <filter id="noise" x="0%" y="0%" width="100%" height="100%">
                        <feTurbulence type="fractalNoise" baseFrequency="0.01" numOctaves="3" seed="1" />
                        <feDisplacementMap in="SourceGraphic" scale="5" />
                      </filter>
                  
                      <mask id="waveMask">
                        <rect width="600" height="400" fill="white" opacity="0.95" />
                        <circle cx="300" cy="200" r="0" fill="black">
                          <animate attributeName="r" values="0;600" dur="3s" begin="0s" fill="freeze" />
                        </circle>
                      </mask>
                  
                      <clipPath id="containerClip">
                        <rect x="100" y="50" width="400" height="300" rx="20" ry="20" />
                      </clipPath>
                <path id="sinPath" d="M150,180 Q200,120 250,180 Q300,240 350,180 Q400,120 450,180" />
                      <path id="cosinePath" d="M150,240 Q200,180 250,120 Q300,180 350,240 Q400,180 450,120" />
                  
                      <marker id="dot" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5">
                        <circle cx="5" cy="5" r="3" fill="#39bdd6">
                          <animate attributeName="r" values="3;4;3" dur="1s" repeatCount="indefinite" />
                        </circle>
                      </marker>
                    </defs>

                    <rect width="600" height="400" fill="url(#gridPattern)" opacity="0.2">
                      <animateTransform attributeName="transform" type="translate" from="0 0" to="40 40" dur="60s" repeatCount="indefinite" />
                    </rect>
                    <g clip-path="url(#containerClip)" opacity="0.4">
                      <g id="particles">
                        <circle cx="150" cy="100" r="1" fill="url(#particleGradient)">
                          <animate attributeName="cx" values="150;450;150" dur="15s" repeatCount="indefinite" />
                          <animate attributeName="cy" values="100;300;100" dur="20s" repeatCount="indefinite" />
                          <animate attributeName="r" values="1;3;1" dur="8s" repeatCount="indefinite" />
                        </circle>
                        <circle cx="200" cy="250" r="2" fill="url(#particleGradient)">
                          <animate attributeName="cx" values="200;400;200" dur="18s" repeatCount="indefinite" begin="1s" />
                          <animate attributeName="cy" values="250;150;250" dur="15s" repeatCount="indefinite" begin="1s" />
                          <animate attributeName="r" values="2;4;2" dur="9s" repeatCount="indefinite" begin="1s" />
                        </circle>
                        <circle cx="350" cy="200" r="1.5" fill="url(#particleGradient)">
                          <animate attributeName="cx" values="350;150;350" dur="20s" repeatCount="indefinite" begin="2s" />
                          <animate attributeName="cy" values="200;250;200" dur="17s" repeatCount="indefinite" begin="2s" />
                          <animate attributeName="r" values="1.5;3.5;1.5" dur="7s" repeatCount="indefinite" begin="2s" />
                        </circle>
                        <circle cx="400" cy="100" r="2" fill="url(#particleGradient)">
                          <animate attributeName="cx" values="400;200;400" dur="22s" repeatCount="indefinite" begin="3s" />
                          <animate attributeName="cy" values="100;300;100" dur="19s" repeatCount="indefinite" begin="3s" />
                          <animate attributeName="r" values="2;4;2" dur="6s" repeatCount="indefinite" begin="3s" />
                        </circle>
                        <circle cx="300" cy="150" r="1" fill="url(#particleGradient)">
                          <animate attributeName="cx" values="300;450;300" dur="17s" repeatCount="indefinite" begin="4s" />
                          <animate attributeName="cy" values="150;200;150" dur="14s" repeatCount="indefinite" begin="4s" />
                          <animate attributeName="r" values="1;3;1" dur="8s" repeatCount="indefinite" begin="4s" />
                        </circle>
                      </g>
                    </g>
                  
                    <rect x="100" y="50" width="400" height="300" rx="20" ry="20" fill="#131a29" fill-opacity="0.7" stroke="url(#waveGradient)" stroke-width="2" mask="url(#waveMask)">
                      <animate attributeName="stroke-width" values="2;4;2" dur="4s" repeatCount="indefinite" />
                      <animate attributeName="stroke-dasharray" values="0,0;5,5;0,0" dur="30s" repeatCount="indefinite" />
                      <animateTransform attributeName="transform" type="scale" additive="sum" from="1 1" to="1.01 1.01" dur="3s" repeatCount="indefinite" begin="0s" calcMode="spline" keySplines="0.4 0 0.2 1" />
                    </rect>
                    <g opacity="0" transform="translate(300,200)">
                      <line x1="-150" y1="0" x2="150" y2="0" stroke="#2a4061" stroke-width="1" />
                      <line x1="0" y1="-150" x2="0" y2="150" stroke="#2a4061" stroke-width="1" />
                      <line x1="0" y1="0" x2="100" y2="-50" stroke="#2a4061" stroke-width="1" stroke-dasharray="3,2" />
                      <text x="150" y="15" font-family="Arial, sans-serif" font-size="12" fill="#bad7f5">x</text>
                      <text x="5" y="-140" font-family="Arial, sans-serif" font-size="12" fill="#bad7f5">y</text>
                      <text x="105" y="-55" font-family="Arial, sans-serif" font-size="12" fill="#bad7f5">z</text>
                      <animate attributeName="opacity" values="0;0.6" dur="2s" fill="freeze" begin="1s" />
                      <animateTransform attributeName="transform" type="rotate" from="0 300 200" to="360 300 200" dur="60s" repeatCount="indefinite" additive="sum" />
                    </g>
                    <text x="300" y="100" font-family="Arial, sans-serif" font-size="24" fill="#bad7f5" text-anchor="middle" filter="url(#textGlow)" opacity="0">
                      sin(x) Function Visualization
                      <animate attributeName="opacity" values="0;1" dur="2s" fill="freeze" begin="0.5s" />
                      <animateTransform attributeName="transform" type="translate" from="0,-20" to="0,0" dur="2s" fill="freeze" begin="0.5s" calcMode="spline" keySplines="0.4 0 0.2 1" />
                    </text>
                  
                    <g clip-path="url(#containerClip)">
                      <path d="M150,180 Q200,120 250,180 Q300,240 350,180 Q400,120 450,180" fill="none" stroke="url(#waveGradient)" stroke-width="3" filter="url(#softGlow)">
                        <animate id="waveAnim" attributeName="d"
                                 values="M150,180 Q200,120 250,180 Q300,240 350,180 Q400,120 450,180;
                                         M150,180 Q200,240 250,180 Q300,120 350,180 Q400,240 450,180;
                                         M150,180 Q200,120 250,180 Q300,240 350,180 Q400,120 450,180"
                                 dur="8s"
                                 repeatCount="indefinite"
                                 calcMode="spline"
                                 keySplines="0.4 0 0.6 1; 0.4 0 0.6 1" />
                        <animate attributeName="stroke-width" values="3;5;3" dur="4s" repeatCount="indefinite" />
                      </path>
                  
                      <path d="M150,240 Q200,180 250,120 Q300,180 350,240 Q400,180 450,120" fill="none" stroke="#3bd4cb" stroke-width="2" opacity="0.5" stroke-dasharray="1,1">
                        <animate attributeName="d"
                                 values="M150,240 Q200,180 250,120 Q300,180 350,240 Q400,180 450,120;
                                         M150,120 Q200,180 250,240 Q300,180 350,120 Q400,180 450,240;
                                         M150,240 Q200,180 250,120 Q300,180 350,240 Q400,180 450,120"
                                 dur="8s"
                                 repeatCount="indefinite"
                                 calcMode="spline"
                                 keySplines="0.4 0 0.6 1; 0.4 0 0.6 1"
                                 begin="0.5s" />
                        <animate attributeName="opacity" values="0;0.5;0" dur="16s" repeatCount="indefinite" />
                      </path>
                  
                      <path d="M150,180 L175,120 L200,180 L225,240 L250,180 L275,120 L300,180 L325,240 L350,180 L375,120 L400,180 L425,240 L450,180"
                            fill="none" stroke="#ff6b6b" stroke-width="1.5" opacity="0">
                        <animate attributeName="opacity" values="0;0;0.4;0.4;0;0" dur="16s" repeatCount="indefinite" begin="8s" />
                        <animate attributeName="stroke-width" values="1.5;2.5;1.5" dur="2s" repeatCount="indefinite" begin="8s" />
                      </path>
                    </g>
                  
                    <g id="dataPointsContainer">
                      <circle id="point1" cx="150" cy="180" r="4" fill="#4991e5" filter="url(#softGlow)">
                        <animate attributeName="cy"
                                 values="180;120;180;240;180"
                                 dur="8s"
                                 repeatCount="indefinite"
                                 calcMode="spline"
                                 keySplines="0.4 0 0.6 1; 0.4 0 0.6 1; 0.4 0 0.6 1; 0.4 0 0.6 1" />
                        <animate attributeName="r" values="4;6;4" dur="2s" repeatCount="indefinite" />
                      </circle>
                  
                      <circle id="point2" cx="250" cy="180" r="4" fill="#39bdd6" filter="url(#softGlow)">
                        <animate attributeName="cy"
                                 values="180;240;180;120;180"
                                 dur="8s"
                                 repeatCount="indefinite"
                                 calcMode="spline"
                                 keySplines="0.4 0 0.6 1; 0.4 0 0.6 1; 0.4 0 0.6 1; 0.4 0 0.6 1" />
                        <animate attributeName="r" values="4;6;4" dur="2s" repeatCount="indefinite" begin="0.5s" />
                      </circle>
                  
                      <circle id="point3" cx="350" cy="180" r="4" fill="#3bd4cb" filter="url(#softGlow)">
                        <animate attributeName="cy"
                                 values="180;120;180;240;180"
                                 dur="8s"
                                 repeatCount="indefinite"
                                 calcMode="spline"
                                 keySplines="0.4 0 0.6 1; 0.4 0 0.6 1; 0.4 0 0.6 1; 0.4 0 0.6 1" />
                        <animate attributeName="r" values="4;6;4" dur="2s" repeatCount="indefinite" begin="1s" />
                      </circle>
                  
                      <circle id="point4" cx="450" cy="180" r="4" fill="#6e48aa" filter="url(#softGlow)">
                        <animate attributeName="cy"
                                 values="180;240;180;120;180"
                                 dur="8s"
                                 repeatCount="indefinite"
                                 calcMode="spline"
                                 keySplines="0.4 0 0.6 1; 0.4 0 0.6 1; 0.4 0 0.6 1; 0.4 0 0.6 1" />
                        <animate attributeName="r" values="4;6;4" dur="2s" repeatCount="indefinite" begin="1.5s" />
                      </circle>
                    </g>
                  
                    <g id="tooltip" opacity="0" filter="url(#softGlow)">
                      <rect x="250" y="120" width="120" height="60" rx="10" ry="10" fill="#1d2d50" fill-opacity="0.9" stroke="#39bdd6" stroke-width="1.5" />
                      <text x="260" y="145" font-family="Arial, sans-serif" font-size="12" fill="#ffffff">sin(Ï€/2) = 1.0</text>
                      <text x="260" y="165" font-family="Arial, sans-serif" font-size="12" fill="#ffffff">Amplitude: 1.0</text>
                  
                      <animate attributeName="opacity" values="0;0;0.9;0.9;0;0" dur="12s" repeatCount="indefinite" begin="4s" />
                      <animateTransform attributeName="transform"
                                       type="translate"
                                       values="0,0; 50,-10; 100,0; 50,10; 0,0"
                                       dur="12s"
                                       repeatCount="indefinite"
                                       begin="4s"
                                       calcMode="spline"
                                       keySplines="0.4 0 0.6 1; 0.4 0 0.6 1; 0.4 0 0.6 1; 0.4 0 0.6 1" />
                    </g>
                  
                    <g transform="translate(180, 320)">
                      <text id="formula" font-family="Arial, sans-serif" font-size="18" fill="#bad7f5" filter="url(#textGlow)">
                        <tspan x="0" y="0" opacity="0">
                          y = A sin(Ï‰x + Ï†)
                          <animate attributeName="opacity" values="0;1" dur="1s" fill="freeze" begin="3s" />
                        </tspan>
                      </text>
                  
                      <g>
                        <text id="params" x="180" y="0" font-family="Arial, sans-serif" font-size="18" fill="#3bd4cb" opacity="0">
                          [A=1, Ï‰=1, Ï†=0]
                          <animate attributeName="opacity" values="0;1" dur="1s" fill="freeze" begin="4s" />
                        </text>
                        <animateTransform id="paramAnim" attributeName="transform" type="scale" from="1 1" to="1 1" dur="4.5s" repeatCount="indefinite" additive="sum" begin="paramChange.begin" values="1 1; 1.1 1.1; 1 1" keyTimes="0; 0.5; 1"></animateTransform>
                    
                    </g>
                  
                      <animate id="paramChange" attributeName="visibility" from="visible" to="visible" dur="8s" repeatCount="indefinite" begin="5s" />
                      <set xlink:href="#params" attributeName="textContent" to="[A=1.5, Ï‰=1, Ï†=0]" begin="paramChange.begin" />
                      <set xlink:href="#params" attributeName="textContent" to="[A=1.5, Ï‰=2, Ï†=0]" begin="paramChange.begin+2s" />
                      <set xlink:href="#params" attributeName="textContent" to="[A=1, Ï‰=1, Ï†=Ï€/4]" begin="paramChange.begin+4s" />
                      <set xlink:href="#params" attributeName="textContent" to="[A=1, Ï‰=1, Ï†=0]" begin="paramChange.begin+6s" />
                    </g>
                  
                    <circle cx="300" cy="270" r="25" fill="url(#waveGradient)" filter="url(#neonGlow)">
                      <animate attributeName="r" values="25;30;25" dur="3s" repeatCount="indefinite" />
                      <animateMotion path="M0,0 Q30,-50 60,0 Q90,50 120,0 Q150,-50 180,0" dur="16s" repeatCount="indefinite" />
                      <animate attributeName="filter" values="url(#neonGlow);url(#softGlow);url(#neonGlow)" dur="8s" repeatCount="indefinite" />
                    </circle>
                  
                    <g clip-path="url(#containerClip)" opacity="0">
                      <path d="M300,200 Q310,190 320,200 Q330,210 340,200 Q350,190 360,200 Q370,210 380,200" fill="none" stroke="#ff6b6b" stroke-width="1">
                        <animate attributeName="d"
                                 values="M300,200 Q310,190 320,200 Q330,210 340,200 Q350,190 360,200 Q370,210 380,200;
                                         M300,200 Q290,190 280,200 Q270,210 260,200 Q250,190 240,200 Q230,210 220,200;
                                         M300,200 Q310,190 320,200 Q330,210 340,200 Q350,190 360,200 Q370,210 380,200"
                                 dur="20s"
                                 repeatCount="indefinite" />
                      </path>
                  
                      <animate attributeName="opacity" values="0;0;0.7;0.7;0;0" dur="24s" repeatCount="indefinite" begin="16s" />
                      <animateTransform attributeName="transform" type="rotate" from="0 300 200" to="360 300 200" dur="60s" repeatCount="indefinite" additive="sum" begin="16s" />
                    </g>
                  
                    <g id="infoPanel" transform="translate(400, 90)" opacity="0">
                      <rect x="0" y="0" width="130" height="80" rx="5" ry="5" fill="#1d2d50" stroke="#39bdd6" stroke-width="1" fill-opacity="0.7" />
                      <text x="10" y="20" font-family="Arial, sans-serif" font-size="12" fill="#bad7f5">Frequency (Hz):</text>
                      <rect x="10" y="30" width="110" height="5" rx="2" ry="2" fill="#39bdd6" />
                      <rect x="10" y="30" width="55" height="5" rx="2" ry="2" fill="#3bd4cb">
                        <animate attributeName="width" values="55;85;40;70;55" dur="16s" repeatCount="indefinite" />
                      </rect>
                  
                      <text x="10" y="50" font-family="Arial, sans-serif" font-size="12" fill="#bad7f5">Amplitude:</text>
                      <rect x="10" y="60" width="110" height="5" rx="2" ry="2" fill="#39bdd6" />
                      <rect x="10" y="60" width="70" height="5" rx="2" ry="2" fill="#3bd4cb">
                        <animate attributeName="width" values="70;40;90;60;70" dur="18s" repeatCount="indefinite" />
                      </rect>
                  
                      <animate attributeName="opacity" values="0;0.9;0.9;0;0;0" dur="20s" repeatCount="indefinite" begin="12s" />
                    </g>
                  
                    <g opacity="0">
                      <g transform="translate(300,200)">
                        <text x="0" y="0" font-family="Arial, sans-serif" font-size="16" fill="#bad7f5" text-anchor="middle">âˆ«</text>
                        <animateTransform attributeName="transform" type="rotate" from="0 0 0" to="360 0 0" dur="20s" repeatCount="indefinite" additive="sum" />
                        <animateTransform attributeName="transform" type="translate" from="0 -100" to="0 -100" dur="20s" repeatCount="indefinite" additive="sum" />
                      </g>
                  
                      <g transform="translate(300,200)">
                        <text x="0" y="0" font-family="Arial, sans-serif" font-size="16" fill="#bad7f5" text-anchor="middle">Ï€</text>
                        <animateTransform attributeName="transform" type="rotate" from="72 0 0" to="432 0 0" dur="25s" repeatCount="indefinite" additive="sum" />
                        <animateTransform attributeName="transform" type="translate" from="0 -110" to="0 -110" dur="25s" repeatCount="indefinite" additive="sum" />
                      </g>
                  
                      <g transform="translate(300,200)">
                        <text x="0" y="0" font-family="Arial, sans-serif" font-size="16" fill="#bad7f5" text-anchor="middle">âˆ‘</text>
                        <animateTransform attributeName="transform" type="rotate" from="144 0 0" to="504 0 0" dur="30s" repeatCount="indefinite" additive="sum" />
                        <animateTransform attributeName="transform" type="translate" from="0 -100" to="0 -100" dur="30s" repeatCount="indefinite" additive="sum" />
                      </g>
                  
                      <g transform="translate(300,200)">
                        <text x="0" y="0" font-family="Arial, sans-serif" font-size="16" fill="#bad7f5" text-anchor="middle">âˆž</text>
                        <animateTransform attributeName="transform" type="rotate" from="216 0 0" to="576 0 0" dur="35s" repeatCount="indefinite" additive="sum" />
                        <animateTransform attributeName="transform" type="translate" from="0 -105" to="0 -105" dur="35s" repeatCount="indefinite" additive="sum" />
                      </g>
                  
                      <g transform="translate(300,200)">
                        <text x="0" y="0" font-family="Arial, sans-serif" font-size="16" fill="#bad7f5" text-anchor="middle">âˆ‚</text>
                        <animateTransform attributeName="transform" type="rotate" from="288 0 0" to="648 0 0" dur="40s" repeatCount="indefinite" additive="sum" />
                        <animateTransform attributeName="transform" type="translate" from="0 -95" to="0 -95" dur="40s" repeatCount="indefinite" additive="sum" />
                      </g>
                  
                      <animate attributeName="opacity" values="0;0.6;0.6;0" dur="30s" repeatCount="indefinite" begin="8s" />
                    </g>
                  
                    <g>
                      <circle cx="300" cy="200" r="5" fill="none" stroke="#39bdd6" stroke-width="1" opacity="0">
                        <animate attributeName="r" values="5;150" dur="4s" repeatCount="indefinite" begin="6s" />
                        <animate attributeName="stroke-width" values="3;0.5" dur="4s" repeatCount="indefinite" begin="6s" />
                        <animate attributeName="opacity" values="0.8;0" dur="4s" repeatCount="indefinite" begin="6s" />
                      </circle>
                  
                      <circle cx="300" cy="200" r="5" fill="none" stroke="#3bd4cb" stroke-width="1" opacity="0">
                        <animate attributeName="r" values="5;150" dur="4s" repeatCount="indefinite" begin="8s" />
                        <animate attributeName="stroke-width" values="3;0.5" dur="4s" repeatCount="indefinite" begin="8s" />
                        <animate attributeName="opacity" values="0.8;0" dur="4s" repeatCount="indefinite" begin="8s" />
                      </circle>
                    </g>
                  
                    <g opacity="0">
                        <g> 
                          <rect x="145" y="140" width="50" height="25" rx="5" ry="5" fill="#1d2d50" fill-opacity="0.8" stroke="#39bdd6" stroke-width="1"/>
                          <text x="150" y="157" font-family="Arial, sans-serif" font-size="10" fill="#ffffff">y = 0</text>
                          <animateTransform attributeName="transform" type="translate" values="0,0; 0,-5; 0,0" dur="4s" repeatCount="indefinite" />
                        </g>
                  
                        <g>
                          <rect x="195" y="80" width="60" height="25" rx="5" ry="5" fill="#1d2d50" fill-opacity="0.8" stroke="#39bdd6" stroke-width="1"/>
                          <text x="200" y="97" font-family="Arial, sans-serif" font-size="10" fill="#ffffff">y = 1.0</text>
                          <animateTransform attributeName="transform" type="translate" values="0,0; 0,-5; 0,0" dur="4s" repeatCount="indefinite" begin="1s" />
                        </g>
                  
                        <g> 
                           <rect x="245" y="140" width="50" height="25" rx="5" ry="5" fill="#1d2d50" fill-opacity="0.8" stroke="#39bdd6" stroke-width="1"/>
                          <text x="250" y="157" font-family="Arial, sans-serif" font-size="10" fill="#ffffff">y = 0</text>
                          <animateTransform attributeName="transform" type="translate" values="0,0; 0,-5; 0,0" dur="4s" repeatCount="indefinite" begin="2s" />
                        </g>
                  
                        <g> 
                           <rect x="295" y="200" width="65" height="25" rx="5" ry="5" fill="#1d2d50" fill-opacity="0.8" stroke="#39bdd6" stroke-width="1"/>
                          <text x="300" y="217" font-family="Arial, sans-serif" font-size="10" fill="#ffffff">y = -1.0</text>
                          <animateTransform attributeName="transform" type="translate" values="0,0; 0,-5; 0,0" dur="4s" repeatCount="indefinite" begin="3s" />
                        </g>
                  
                         <g> 
                          <rect x="345" y="140" width="50" height="25" rx="5" ry="5" fill="#1d2d50" fill-opacity="0.8" stroke="#39bdd6" stroke-width="1"/>
                          <text x="350" y="157" font-family="Arial, sans-serif" font-size="10" fill="#ffffff">y = 0</text>
                           <animateTransform attributeName="transform" type="translate" values="0,0; 0,-5; 0,0" dur="4s" repeatCount="indefinite" begin="4s" />
                        </g>
                  
                        <g> 
                          <rect x="395" y="80" width="60" height="25" rx="5" ry="5" fill="#1d2d50" fill-opacity="0.8" stroke="#39bdd6" stroke-width="1"/>
                          <text x="400" y="97" font-family="Arial, sans-serif" font-size="10" fill="#ffffff">y = 1.0</text>
                          <animateTransform attributeName="transform" type="translate" values="0,0; 0,-5; 0,0" dur="4s" repeatCount="indefinite" begin="5s" />
                        </g>
                  
                         <g> 
                          <rect x="445" y="140" width="50" height="25" rx="5" ry="5" fill="#1d2d50" fill-opacity="0.8" stroke="#39bdd6" stroke-width="1"/>
                          <text x="450" y="157" font-family="Arial, sans-serif" font-size="10" fill="#ffffff">y = 0</text>
                          <animateTransform attributeName="transform" type="translate" values="0,0; 0,-5; 0,0" dur="4s" repeatCount="indefinite" begin="6s" />
                        </g>
                  
                       
                        <animate attributeName="opacity" values="0;0;0.7;0.7;0" dur="16s" repeatCount="indefinite" begin="10s" />
                      </g> 
                  
                  </svg>
            </div>
        </div>
                <div class="scroll-down-indicator">Scroll Down â†“</div>
    </section>

    
    <section class="features section" id="features">
        <!-- Problems Section -->
        <div id="problem-section" class="section">
           <h2>The Problems</h2>
           <div id="problem-icons">
              <!-- Boring Stuff -->
              <div class="icon-container">
                  <i class="fa-solid fa-face-meh icon problem-icon"
                     data-original-icon="fa-face-meh"
                     data-clicked-icon="fa-face-grin-beam"
                     title="Feeling Bored"></i>
                  <span class="icon-text">Learning feels sleepy <i class="fa-solid fa-bed"></i></span>
              </div>
              <!-- Teacher Too Busy -->
               <div class="icon-container">
                  <i class="fa-solid fa-person-running icon problem-icon"
                     data-original-icon="fa-person-running"
                     data-clicked-icon="fa-calendar-check"
                     title="Teachers are busy!"></i>
                  <span class="icon-text">Teachers checking same boring assignment <i class="fa-solid fa-hourglass-half"></i></span>
              </div>
              <!-- Copying -->
              <div class="icon-container">
                  <i class="fa-solid fa-copy icon problem-icon"
                     data-original-icon="fa-copy"
                     data-clicked-icon="fa-user-check"
                     title="Just Copying"></i>
                  <span class="icon-text">Just copying homework, Solving same MCQ<i class="fa-regular fa-copy"></i></span>
              </div>
              <!-- Not Listening -->
               <div class="icon-container">
                   <i class="fa-solid fa-ear-listen icon problem-icon"
                      data-original-icon="fa-ear-listen"
                      data-clicked-icon="fa-headphones-simple"
                      title="Hard to Listen"></i>
                   <span class="icon-text">Sitting in lectures, not focusing <i class="fa-solid fa-volume-xmark"></i></span>
              </div>
              <!-- Not Much Fun Making Things -->
              <div class="icon-container">
                  <i class="fa-solid fa-puzzle-piece icon problem-icon"
                     data-original-icon="fa-puzzle-piece"
                     data-clicked-icon="fa-lightbulb"
                     title="Less Fun Making Stuff"></i>
                  <span class="icon-text">Cant showcase what they learn<i class="fa-solid fa-paintbrush"></i></span>
              </div>
           </div>
           <!-- Removed the "You can click" helper text -->
           </div>
  
      <!-- Features Section -->
      <div id="feature-section" class="section">
          <h2>Features</h2>
          <div id="feature-icons">
              <!-- Magic Pictures Lab -->
               <div class="icon-container">
                  <i class="fa-solid fa-wand-magic-sparkles icon feature-icon"
                     data-original-icon="fa-wand-magic-sparkles"
                     data-clicked-icon="fa-gears"
                     title="Magic Picture Lab"></i>
                  <span class="icon-text">Animation while learn <i class="fa-solid fa-film"></i></span>
              </div>
              <!-- Easy Check for Teachers -->
               <div class="icon-container">
                  <i class="fa-solid fa-person-chalkboard icon feature-icon"
                     data-original-icon="fa-person-chalkboard"
                     data-clicked-icon="fa-chart-line"
                     title="Easy Check for Teachers"></i>
                   <span class="icon-text">Instead of checking assignement teachers sees votes and 5 sec animation and also no need for same MCQ question <i class="fa-solid fa-check"></i></span>
              </div>
               <!-- No Copying Allowed! -->
               <div class="icon-container">
                   <i class="fa-solid fa-user-secret icon feature-icon"
                      data-original-icon="fa-user-secret"
                      data-clicked-icon="fa-shield-halved"
                      title="No Copying!"></i>
                   <span class="icon-text">Each animation is different so no copying <i class="fa-solid fa-robot"></i></span>
              </div>
              <!-- See How You're Doing -->
               <div class="icon-container">
                  <i class="fa-solid fa-binoculars icon feature-icon"
                     data-original-icon="fa-binoculars"
                     data-clicked-icon="fa-chart-pie"
                     title="See How You Do"></i>
                   <span class="icon-text">Analytic tool to see student focus<i class="fa-solid fa-magnifying-glass-chart"></i></span>
              </div>
              <!-- Show Off! -->
              <div class="icon-container">
                   <i class="fa-solid fa-share-nodes icon feature-icon"
                      data-original-icon="fa-share-nodes"
                      data-clicked-icon="fa-rocket"
                      title="Show Off!"></i>
                   <span class="icon-text">Student share their creativity boosting other students to learn STEM<i class="fa-solid fa-thumbs-up"></i></span>
              </div>
          </div>
           <!-- Removed the "You can click" helper text -->
      </div>
      <div id="pricing-section" class="section">
          <h2>Helping save upto 100k USD for teachers workload</h2>
      <!-- Pricing Section -->
      <div id="pricing-section" class="section">
          <h2>Flexible Pricing Plans</h2>
          <p class="section-subtitle">Choose the plan that best fits your institution's needs. All plans include API access.</p>
  
          <div class="pricing-cards-container">
  
              <!-- Tier 1: 1000+ Students -->
              <div class="pricing-card enterprise">
                  <h3>Enterprise Scale</h3>
                  <p class="student-count">1000+ Students</p>
                  <div class="price-container">
                      <span class="price-amount">$9</span>
                      <span class="price-unit">/ month*</span>
                  </div>
                  <ul class="features-list">
                      <li>Volume Discounting</li>
                      <li>Dedicated Support Options</li>
                      <li>Custom Integrations Possible</li>
                      <li>Excludes API Calls**</li>
                  </ul>
                  <a href="#contact" class="cta-button">Contact Sales</a>
              </div>
  
              <!-- Tier 2: < 1000 Students (Volume) -->
              <div class="pricing-card volume">
                  <h3>Volume License</h3>
                   <p class="student-count">100 - 999 Students</p>
                  <div class="price-container">
                      <span class="price-amount">$19</span>
                      <span class="price-unit">/ student / month*</span>
                  </div>
                   <ul class="features-list">
                       <li>Great for Larger Schools/Districts</li>
                       <li>Standard Support</li>
                       <li>Excludes API Calls**</li>
                   </ul>
                  <a href="#signup" class="cta-button">Get Started</a>
              </div>
  
              <!-- Tier 3: ~300 Students -->
               <div class="pricing-card classroom featured"> <!-- Highlighted plan -->
                   <h3>Classroom Pack</h3>
                    <p class="student-count">Approx. 300 Students</p>
                   <div class="price-container">
                       <span class="price-amount">$29</span>
                       <span class="price-unit">/ student / month*</span>
                   </div>
                    <ul class="features-list">
                        <li>Ideal for Multiple Classes</li>
                        <li>Easy Setup</li>
                        <li>Excludes API Calls**</li>
                    </ul>
                   <a href="#signup" class="cta-button">Choose Plan</a>
               </div>
  
              <!-- Tier 4: < 100 Students -->
               <div class="pricing-card small-group">
                   <h3>Small Group</h3>
                    <p class="student-count">Under 100 Students</p>
                   <div class="price-container">
                       <span class="price-amount">$39</span>
                       <span class="price-unit">/ student / month*</span>
                   </div>
                    <ul class="features-list">
                        <li>Perfect for Single Classes or Clubs</li>
                        <li>Get Started Quickly</li>
                        <li>Includes API Calls**</li>
                    </ul>
                   <a href="#signup" class="cta-button">Get Started</a>
               </div>
  
          </div>
  
          <p class="pricing-footnote">
              *Billing typically occurs annually or per semester. Contact us for specifics.<br>
              **API Call usage subject to fair use policy or specific quotas $10USD/10 million token.
          </p>
      </div>



   <div class="container">
       <h2 class="section-title animate-on-scroll">Powerful Features</h2>
       <p class="section-subtitle animate-on-scroll">imagine a store provides tools that make STEM concepts come alive through animation</p>
       <div class="features-grid stagger-children">
           <div class="feature-card">
               <div class="icon">
                   <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M9 3L5 7M5 7L9 11M5 7H15C17.2091 7 19 8.79086 19 11V12M15 21L19 17M19 17L15 13M19 17H9C6.79086 17 5 15.2091 5 13V12" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="0s" fill="freeze" />
                           <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="10s" repeatCount="indefinite" additive="sum" />
                       </path>
                   </svg>
               </div>
               <h3>Equation-Based Animation</h3>
               <p>Create visually stunning animations directly from mathematical equations. See abstract concepts come to life.</p>
           </div>
           <div class="feature-card">
               <div class="icon">
                   <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M4 21V14M4 10V3M12 21V12M12 8V3M20 21V16M20 12V3M1 14H7M9 8H15M17 16H23" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="0.2s" fill="freeze" />
                           <animate attributeName="stroke-dashoffset" from="0" to="20" dur="4s" repeatCount="indefinite" />
                       </path>
                   </svg>
               </div>
               <h3>Interactive Controls</h3>
               <p>Manipulate variables in real-time to see how changes affect animations. Perfect for understanding cause and effect.</p>
           </div>
           <div class="feature-card">
               <div class="icon">
                   <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="0.4s" fill="freeze" />
                       </path>
                       <path d="M9 11C11.2091 11 13 9.20914 13 7C13 4.79086 11.2091 3 9 3C6.79086 3 5 4.79086 5 7C5 9.20914 6.79086 11 9 11Z" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="0.6s" fill="freeze" />
                           <animate attributeName="opacity" values="1;0.7;1" dur="3s" repeatCount="indefinite" />
                       </path>
                       <path d="M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="0.8s" fill="freeze" />
                       </path>
                       <path d="M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="1s" fill="freeze" />
                       </path>
                   </svg>
               </div>
               <h3>Social Learning Platform</h3>
               <p>Students share animations, receive feedback, and vote for the best visualizations in a community setting.</p>
           </div>
           <div class="feature-card">
               <div class="icon">
                   <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M4 12V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V12" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="1.2s" fill="freeze" />
                       </path>
                       <path d="M16 6L12 2L8 6" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="1.4s" fill="freeze" />
                       </path>
                       <path d="M12 2V15" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="1.6s" fill="freeze" />
                           <animate attributeName="y2" values="15;12;15" dur="2s" repeatCount="indefinite" />
                       </path>
                   </svg>
               </div>
               <h3>Export & Share</h3>
               <p>Download animations in various formats or share directly to learning platforms and social media.</p>
           </div>
           <div class="feature-card">
               <div class="icon">
                   <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="1.8s" fill="freeze" />
                           <animate attributeName="r" values="10;10.5;10" dur="3s" repeatCount="indefinite" additive="sum" />
                       </path>
                       <path d="M16 10L12.5 13.5L10.5 11.5M12 7V7.01" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="2s" fill="freeze" />
                           <animate attributeName="stroke-width" values="2;3;2" dur="2s" repeatCount="indefinite" />
                       </path>
                   </svg>
               </div>
               <h3>Automated Feedback</h3>
               <p>Built-in analysis compares student work to expected outcomes, providing instant feedback.</p>
           </div>
           <div class="feature-card">
               <div class="icon">
                   <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M4 19.5C4 18.837 4.26339 18.2011 4.73223 17.7322C5.20107 17.2634 5.83696 17 6.5 17H20" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="2.2s" fill="freeze" />
                       </path>
                       <path d="M6.5 2H20V22H6.5C5.83696 22 5.20107 21.7366 4.73223 21.2678C4.26339 20.7989 4 20.163 4 19.5V4.5C4 3.83696 4.26339 3.20107 4.73223 2.73223C5.20107 2.26339 5.83696 2 6.5 2Z" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="2.4s" fill="freeze" />
                       </path>
                       <path d="M8 6H12M8 10H16" stroke="#3BD4CB" stroke-width="2" stroke-linecap="round">
                           <animate attributeName="stroke-dasharray" from="0 100" to="100 100" dur="1.5s" begin="2.6s" fill="freeze" />
                           <animate attributeName="opacity" values="1;0.5;1" dur="3s" repeatCount="indefinite" />
                       </path>
                   </svg>
               </div>
               <h3>Dictionary Integration</h3>
               <p>Look up complex STEM terms instantly with integrated definitions while building animations.</p>
           </div>
       </div>
   </div>
</section>

    <section id="animation-wrapper" >
                    <h2 class="section-title animate-on-scroll">How imagine a store Works</h2>

        <div id="canvas-container">
            <canvas id="busCanvas"></canvas>
        </div>
    </section>


    
    <section class="workflow section" id="workflow">
        <div class="container">
            <h2 class="section-title animate-on-scroll">How imagine a store Works</h2>
            <p class="section-subtitle animate-on-scroll">A simple workflow that transforms complex equations into engaging visual learning experiences</p>
            <div class="workflow-steps stagger-children">
                <div class="step-card">
                    <h3>Input Equations</h3>
                    <p>Enter mathematical equations or select from our extensive library of pre-built STEM concepts.</p>
                </div>
                <div class="step-card">
                    <h3>Customize Animation</h3>
                    <p>Adjust variables, appearance, and animation parameters to highlight specific aspects of the concept.</p>
                </div>
                <div class="step-card">
                    <h3>Share & Grade</h3>
                    <p>Publish animations to the class gallery where peers can vote and teachers can provide feedback.</p>
                </div>
            </div>
        </div>
    </section>
    <section class="testimonials section" id="testimonials">
        <div class="container">
            <h2 class="section-title animate-on-scroll">What Educators & Students Say</h2>
            <p class="section-subtitle animate-on-scroll">Hear from teachers and students who have transformed their STEM learning experience</p>
            <div class="testimonial-grid stagger-children">
                 <div class="testimonial-card">
                     <div class="testimonial-text">
                         "imagine a store has completely transformed how I teach calculus. Students who struggled with visualizing derivatives and integrals now create amazing animations that demonstrate deep understanding."
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="20" cy="20" r="18" fill="#4991E5" stroke="#BAD7F5" stroke-width="2"/>
                                <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#ffffff">SJ</text>
                            </svg>
                        </div>
                         <div class="author-details">
                             <div class="author-name">Dr. Sarah Johnson</div>
                             <div class="author-role">Mathematics Teacher</div>
                        </div>
                    </div>
                </div>
        
                 <div class="testimonial-card">
                     <div class="testimonial-text">
                        "I used to hate physics equations until I started using imagine a store. Creating animations helped me see what the formulas actually mean. Now I'm at the top of my class!"
                    </div>
                    <div class="testimonial-author">
                         <div class="author-avatar">
                            <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="20" cy="20" r="18" fill="#39BDD6" stroke="#BAD7F5" stroke-width="2"/>
                                 <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#ffffff">MC</text>
                            </svg>
                        </div>
                         <div class="author-details">
                             <div class="author-name">Michael Chang</div>
                             <div class="author-role">High School Student</div>
                        </div>
                    </div>
                </div>
                 <div class="testimonial-card">
                     <div class="testimonial-text">
                        "The social aspect of imagine a store is brilliant. My students compete to create the most creative and accurate animations, which has dramatically increased engagement in my chemistry class."
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="20" cy="20" r="18" fill="#3BD4CB" stroke="#BAD7F5" stroke-width="2"/>
                                <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#ffffff">RT</text>
                            </svg>
                        </div>
                         <div class="author-details">
                             <div class="author-name">Prof. Robert Taylor</div>
                             <div class="author-role">Chemistry Department</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer>
        <div class="container">
            <div class="footer-grid">
                <div>
                    <a href="#" class="footer-logo">imagine<span>ASTORE</span></a>
                    <p class="footer-about">Transforming STEM education through interactive animation. Making complex equations and concepts easy to understand visually.</p>
                    <div class="footer-social">
                        <a href="#" class="social-icon" aria-label="Facebook" title="Facebook" rel="noopener noreferrer">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18 2H15C13.6739 2 12.4021 2.52678 11.4645 3.46447C10.5268 4.40215 10 5.67392 10 7V10H7V14H10V22H14V14H17L18 10H14V7C14 6.73478 14.1054 6.48043 14.2929 6.29289C14.4804 6.10536 14.7348 6 15 6H18V2Z" fill="currentColor"/>
                            </svg>
                        </a>
                         <a href="#" class="social-icon" aria-label="Twitter" title="Twitter" rel="noopener noreferrer">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M23 3.01006C22.0424 3.68553 20.9821 4.20217 19.86 4.54006C19.2577 3.84757 18.4573 3.35675 17.567 3.13398C16.6767 2.91122 15.7395 2.96725 14.8821 3.29451C14.0247 3.62177 13.2884 4.20446 12.773 4.96377C12.2575 5.72309 11.9877 6.62239 12 7.54006V8.54006C10.2426 8.58562 8.50127 8.19587 6.93101 7.4055C5.36074 6.61513 4.01032 5.44869 3 4.01006C3 4.01006 -1 13.0101 8 17.0101C5.94053 18.408 3.48716 19.109 1 19.0101C10 24.0101 21 19.0101 21 7.51006C20.9991 7.23151 20.9723 6.95365 20.92 6.68006C21.9406 5.67355 22.6608 4.40277 23 3.01006Z" fill="currentColor"/>
                            </svg>
                        </a>
                         <a href="#" class="social-icon" aria-label="LinkedIn" title="LinkedIn" rel="noopener noreferrer">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16 8C17.5913 8 19.1174 8.63214 20.2426 9.75736C21.3679 10.8826 22 12.4087 22 14V21H18V14C18 13.4696 17.7893 12.9609 17.4142 12.5858C17.0391 12.2107 16.5304 12 16 12C15.4696 12 14.9609 12.2107 14.5858 12.5858C14.2107 12.9609 14 13.4696 14 14V21H10V14C10 12.4087 10.6321 10.8826 11.7574 9.75736C12.8826 8.63214 14.4087 8 16 8Z" fill="currentColor"/>
                                <path d="M6 9H2V21H6V9Z" fill="currentColor"/>
                                <path d="M4 6C5.10457 6 6 5.10457 6 4C6 2.89543 5.10457 2 4 2C2.89543 2 2 2.89543 2 4C2 5.10457 2.89543 6 4 6Z" fill="currentColor"/>
                            </svg>
                        </a>
                         <a href="#" class="social-icon" aria-label="Instagram" title="Instagram" rel="noopener noreferrer">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2C14.717 2 15.056 2.01 16.122 2.06C17.187 2.11 17.912 2.277 18.55 2.525C19.21 2.779 19.766 3.123 20.322 3.678C20.8305 4.1779 21.224 4.78259 21.475 5.45C21.722 6.087 21.89 6.813 21.94 7.878C21.987 8.944 22 9.283 22 12C22 14.717 21.99 15.056 21.94 16.122C21.89 17.187 21.722 17.912 21.475 18.55C21.2247 19.2178 20.8311 19.8226 20.322 20.322C19.822 20.8303 19.2173 21.2238 18.55 21.475C17.913 21.722 17.187 21.89 16.122 21.94C15.056 21.987 14.717 22 12 22C9.283 22 8.944 21.99 7.878 21.94C6.813 21.89 6.088 21.722 5.45 21.475C4.78233 21.2245 4.17753 20.8309 3.678 20.322C3.16941 19.8222 2.77593 19.2175 2.525 18.55C2.277 17.913 2.11 17.187 2.06 16.122C2.013 15.056 2 14.717 2 12C2 9.283 2.01 8.944 2.06 7.878C2.11 6.812 2.277 6.088 2.525 5.45C2.77524 4.78218 3.1688 4.17732 3.678 3.678C4.17767 3.16923 4.78243 2.77573 5.45 2.525C6.088 2.277 6.812 2.11 7.878 2.06C8.944 2.013 9.283 2 12 2ZM12 7C10.6739 7 9.40215 7.52678 8.46447 8.46447C7.52678 9.40215 7 10.6739 7 12C7 13.3261 7.52678 14.5979 8.46447 15.5355C9.40215 16.4732 10.6739 17 12 17C13.3261 17 14.5979 16.4732 15.5355 15.5355C16.4732 14.5979 17 13.3261 17 12C17 10.6739 16.4732 9.40215 15.5355 8.46447C14.5979 7.52678 13.3261 7 12 7ZM18.5 6.75C18.5 6.41848 18.3683 6.10054 18.1339 5.86612C17.8995 5.6317 17.5815 5.5 17.25 5.5C16.9185 5.5 16.6005 5.6317 16.3661 5.86612C16.1317 6.10054 16 6.41848 16 6.75C16 7.08152 16.1317 7.39946 16.3661 7.63388C16.6005 7.8683 16.9185 8 17.25 8C17.5815 8 17.8995 7.8683 18.1339 7.63388C18.3683 7.39946 18.5 7.08152 18.5 6.75ZM12 9C12.7956 9 13.5587 9.31607 14.1213 9.87868C14.6839 10.4413 15 11.2044 15 12C15 12.7956 14.6839 13.5587 14.1213 14.1213C13.5587 14.6839 12.7956 15 12 15C11.2044 15 10.4413 14.6839 9.87868 14.1213C9.31607 13.5587 9 12.7956 9 12C9 11.2044 9.31607 10.4413 9.87868 9.87868C10.4413 9.31607 11.2044 9 12 9Z" fill="currentColor"/>
                            </svg>
                        </a>
                    </div>
                </div>
                <div>
                    <h4 class="footer-heading">Product</h4>
                    <ul class="footer-links">
                        <li><a href="#features">Features</a></li>
                        <li><a href="#">Pricing</a></li>
                        <li><a href="#">Case Studies</a></li>
                        <li><a href="#">Resources</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="footer-heading">Company</h4>
                    <ul class="footer-links">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Blog</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="footer-heading">Support</h4>
                    <ul class="footer-links">
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Documentation</a></li>
                        <li><a href="#">API Reference</a></li>
                        <li><a href="#">Community Forum</a></li>
                    </ul>
                </div>
            </div>
            <!-- Add this inside the footer, before the footer-bottom div -->
<div class="footer-subscribe">
    <h4 class="footer-heading">Stay Updated</h4>
    <form class="subscribe-form">
        <input type="email" placeholder="Your email address" required aria-label="Email address for newsletter">
        <button type="submit" class="button-primary">Subscribe</button>
    </form>
    <p class="subscribe-text">Get the latest updates and STEM teaching resources</p>
</div>
            <div class="footer-bottom">
                <div>Â© 2025 imagine a store. All rights reserved.</div>
                <div class="footer-bottom-links">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>
    </section>

 
    <section class="cta section" id="cta">
        
        <div class="container">
            <h2 class="animate-on-scroll">Ready to Transform STEM Learning?</h2>
            <p class="animate-on-scroll">Join thousands of educators and students who are making abstract concepts visual, interactive, and fun with imagine a store.</p>
            <a href="play.html" class="cta-button animate-on-scroll">Start Free Trial</a>
        </div>
        
    </section>
    
    <!-- Fixed Overlays and Background SVG -->
    <svg class="bg-animation" width="100%" height="100%" viewBox="0 0 1440 900" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg" 
    style="opacity: 0.2;">
        <defs>
            <!-- Enhanced Background Gradients -->
            <radialGradient id="deepSpaceGradient" cx="50%" cy="50%" r="80%">
                <stop offset="0%" stop-color="#1E3A70" stop-opacity="0.9"/> <!-- Richer deep blue center -->
                <stop offset="50%" stop-color="#0E1E3A" stop-opacity="0.85"/>
                <stop offset="100%" stop-color="#050A14" stop-opacity="1"/> <!-- Darker edge -->
                <animate attributeName="r" values="80%;85%;80%" dur="20s" repeatCount="indefinite" />
            </radialGradient>
            
            <linearGradient id="subtleNebula" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#39bdd6" stop-opacity="0.1" />
                <stop offset="50%" stop-color="#4991e5" stop-opacity="0.15" />
                <stop offset="100%" stop-color="#39bdd6" stop-opacity="0.1" />
                <animate attributeName="x1" values="0%;20%;0%" dur="30s" repeatCount="indefinite" />
                <animate attributeName="y1" values="0%;10%;0%" dur="25s" repeatCount="indefinite" />
            </linearGradient>
            
            <radialGradient id="glowEffect" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="#4DD0E1" stop-opacity="0.2"/>
                <stop offset="100%" stop-color="#4DD0E1" stop-opacity="0"/>
                <animate attributeName="cx" values="50%;60%;40%;50%" dur="30s" repeatCount="indefinite" />
                <animate attributeName="cy" values="50%;40%;60%;50%" dur="35s" repeatCount="indefinite" />
            </radialGradient>
    
            <!-- Blueprint/Line Colors -->
            <linearGradient id="blueprintLineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#607D8B" stop-opacity="0.6"/>
                <stop offset="50%" stop-color="#90A4AE" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="#607D8B" stop-opacity="0.6"/>
                <animate attributeName="x1" values="0%;20%;0%" dur="15s" repeatCount="indefinite" />
            </linearGradient>
            
            <!-- Enhanced particle colors with animation -->
            <radialGradient id="particleColor1" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="#4DD0E1" stop-opacity="1"/>
                <stop offset="100%" stop-color="#26C6DA" stop-opacity="0.7"/>
                <animate attributeName="r" values="50%;70%;50%" dur="8s" repeatCount="indefinite" />
            </radialGradient>
            
            <radialGradient id="particleColor2" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="#81C784" stop-opacity="1"/>
                <stop offset="100%" stop-color="#66BB6A" stop-opacity="0.7"/>
                <animate attributeName="r" values="50%;65%;50%" dur="7s" repeatCount="indefinite" />
            </radialGradient>
            
            <radialGradient id="particleColor3" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="#FFD54F" stop-opacity="1"/>
                <stop offset="100%" stop-color="#FFC107" stop-opacity="0.7"/>
                <animate attributeName="r" values="50%;60%;50%" dur="9s" repeatCount="indefinite" />
            </radialGradient>
            
            <radialGradient id="dataPulseGradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="#FFD54F" stop-opacity="1"/>
                <stop offset="100%" stop-color="#FFCA28" stop-opacity="0.7"/>
                <animate attributeName="r" values="50%;70%;50%" dur="3s" repeatCount="indefinite" />
            </radialGradient>
    
            <!-- Enhanced Filters -->
            <filter id="particleGlow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="2.5" result="blur" />
                <feComposite in="SourceGraphic" in2="blur" operator="over" />
            </filter>
            
            <filter id="softBlur" x="-20%" y="-20%" width="140%" height="140%">
                <feGaussianBlur stdDeviation="1" />
            </filter>
            
            <filter id="neonGlow" x="-30%" y="-30%" width="160%" height="160%">
                <feGaussianBlur stdDeviation="3" result="blur" />
                <feFlood flood-color="#39bdd6" flood-opacity="0.7" result="glowColor"/>
                <feComposite in="glowColor" in2="blur" operator="in" result="softGlow"/>
                <feComposite in="SourceGraphic" in2="softGlow" operator="over"/>
            </filter>
    
            <!-- Grid Pattern -->
            <pattern id="blueprintGridDetailed" x="0" y="0" width="120" height="120" patternUnits="userSpaceOnUse">
                <path d="M 120 0 L 0 0 0 120" fill="none" stroke="rgba(176,190,197,0.15)" stroke-width="0.8"/>
                <path d="M 30 0 V 120 M 60 0 V 120 M 90 0 V 120 M 0 30 H 120 M 0 60 H 120 M 0 90 H 120" fill="none" stroke="rgba(176,190,197,0.08)" stroke-width="0.5"/>
                
                <!-- Animated dots at grid intersections -->
                <circle cx="0" cy="0" r="1.2" fill="rgba(73,145,229,0.5)">
                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="5s" repeatCount="indefinite" begin="-1s"/>
                </circle>
                <circle cx="60" cy="60" r="1.2" fill="rgba(73,145,229,0.5)">
                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="5s" repeatCount="indefinite" begin="-2s"/>
                </circle>
                <circle cx="120" cy="120" r="1.2" fill="rgba(73,145,229,0.5)">
                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="5s" repeatCount="indefinite" begin="-3s"/>
                </circle>
                <circle cx="0" cy="120" r="1.2" fill="rgba(73,145,229,0.5)">
                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="5s" repeatCount="indefinite" begin="-4s"/>
                </circle>
                <circle cx="120" cy="0" r="1.2" fill="rgba(73,145,229,0.5)">
                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="5s" repeatCount="indefinite" begin="-5s"/>
                </circle>
            </pattern>
    
            <!-- Reusable Symbols -->
            <symbol id="wireframeCube" viewBox="-50 -50 100 100">
                <path d="M-25,-25 L25,-25 L25,25 L-25,25 Z M-15,-15 L35,-15 L35,35 L-15,35 Z M-25,-25 L-15,-15 M25,-25 L35,-15 M25,25 L35,35 M-25,25 L-15,35" 
                      fill="none" stroke="url(#blueprintLineGradient)" stroke-width="0.9">
                    <animate attributeName="stroke-opacity" values="0.7;1;0.7" dur="8s" repeatCount="indefinite"/>
                </path>
            </symbol>
            
            <symbol id="wireframePyramid" viewBox="-50 -50 100 100">
                <path d="M0,-30 L-25,25 L25,25 Z M0,-30 L0,25 M-25,25 L25,25" 
                      fill="none" stroke="url(#blueprintLineGradient)" stroke-width="0.9">
                    <animate attributeName="stroke-opacity" values="0.7;1;0.7" dur="10s" repeatCount="indefinite"/>
                </path>
            </symbol>
            
            <symbol id="wireframeSphere" viewBox="-50 -50 100 100">
                <circle cx="0" cy="0" r="30" fill="none" stroke="url(#blueprintLineGradient)" stroke-width="0.9">
                    <animate attributeName="stroke-opacity" values="0.7;1;0.7" dur="9s" repeatCount="indefinite"/>
                </circle>
                <ellipse cx="0" cy="0" rx="30" ry="15" fill="none" stroke="url(#blueprintLineGradient)" stroke-width="0.6">
                    <animate attributeName="transform" attributeType="XML" type="rotate" 
                             from="0 0 0" to="360 0 0" dur="20s" repeatCount="indefinite"/>
                </ellipse>
                <ellipse cx="0" cy="0" rx="30" ry="15" fill="none" stroke="url(#blueprintLineGradient)" stroke-width="0.6">
                    <animate attributeName="transform" attributeType="XML" type="rotate" 
                             from="90 0 0" to="450 0 0" dur="25s" repeatCount="indefinite"/>
                </ellipse>
            </symbol>
            
            <symbol id="dnaSegment" viewBox="0 0 20 100">
                <path d="M 10 0 Q 0 10, 10 20 T 10 40 Q 0 50, 10 60 T 10 80 Q 0 90, 10 100" fill="none" stroke="#80CBC4" stroke-width="1.2">
                    <animate attributeName="stroke-opacity" values="0.7;1;0.7" dur="8s" repeatCount="indefinite"/>
                </path>
                <path d="M 10 0 Q 20 10, 10 20 T 10 40 Q 20 50, 10 60 T 10 80 Q 20 90, 10 100" fill="none" stroke="#4DB6AC" stroke-width="1.2">
                    <animate attributeName="stroke-opacity" values="0.7;1;0.7" dur="8s" repeatCount="indefinite" begin="-4s"/>
                </path>
                <!-- Animated base pairs -->
                <line x1="5" y1="10" x2="15" y2="10" stroke="#B2DFDB" stroke-width="1">
                    <animate attributeName="stroke-opacity" values="0.6;1;0.6" dur="4s" repeatCount="indefinite" begin="-0.5s"/>
                </line>
                <line x1="5" y1="30" x2="15" y2="30" stroke="#B2DFDB" stroke-width="1">
                    <animate attributeName="stroke-opacity" values="0.6;1;0.6" dur="4s" repeatCount="indefinite" begin="-1s"/>
                </line>
                <line x1="5" y1="50" x2="15" y2="50" stroke="#B2DFDB" stroke-width="1">
                    <animate attributeName="stroke-opacity" values="0.6;1;0.6" dur="4s" repeatCount="indefinite" begin="-1.5s"/>
                </line>
                <line x1="5" y1="70" x2="15" y2="70" stroke="#B2DFDB" stroke-width="1">
                    <animate attributeName="stroke-opacity" values="0.6;1;0.6" dur="4s" repeatCount="indefinite" begin="-2s"/>
                </line>
                <line x1="5" y1="90" x2="15" y2="90" stroke="#B2DFDB" stroke-width="1">
                    <animate attributeName="stroke-opacity" values="0.6;1;0.6" dur="4s" repeatCount="indefinite" begin="-2.5s"/>
                </line>
            </symbol>
            
            <symbol id="circuitNode" viewBox="0 0 20 20">
                <circle cx="10" cy="10" r="5" fill="#4991e5" opacity="0.7">
                    <animate attributeName="r" values="5;7;5" dur="3s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="3s" repeatCount="indefinite"/>
                </circle>
                <circle cx="10" cy="10" r="2" fill="#39bdd6"/>
            </symbol>
    
            <!-- Shared Animation Styles -->
            <style>
                .drawing-line { stroke-dasharray: 2000; stroke-dashoffset: 2000; }
                .fading-element { animation: fadeCycle 25s infinite ease-in-out; }
                @keyframes fadeCycle {
                    0%, 100% { opacity: 0; }
                    10%, 90% { opacity: 0.6; }
                }
                .slow-drift { animation: slowDrift 80s infinite linear alternate; }
                @keyframes slowDrift {
                    from { transform: translate(0px, 0px); }
                    to { transform: translate(20px, -15px); }
                }
                .medium-drift { animation: mediumDrift 50s infinite linear alternate; }
                @keyframes mediumDrift {
                    from { transform: translate(0px, 0px); }
                    to { transform: translate(-25px, 20px); }
                }
                .fast-drift { animation: fastDrift 30s infinite linear alternate; }
                @keyframes fastDrift {
                    from { transform: translate(0px, 0px); }
                    to { transform: translate(35px, -30px); }
                }
                .pulse-rotate { animation: pulseRotate 15s infinite linear; }
                @keyframes pulseRotate {
                    0% { transform: scale(1) rotate(0deg); opacity: 0.7; }
                    50% { transform: scale(1.1) rotate(180deg); opacity: 1; }
                    100% { transform: scale(1) rotate(360deg); opacity: 0.7; }
                }
                .float-around { animation: floatAround 20s infinite ease-in-out; }
                @keyframes floatAround {
                    0%, 100% { transform: translate(0, 0); }
                    25% { transform: translate(15px, -15px); }
                    50% { transform: translate(-5px, 20px); }
                    75% { transform: translate(-20px, -10px); }
                }
            </style>
        </defs>
    
        <!-- Layer 1: Deep Background with animated gradients -->
        <rect width="100%" height="100%" fill="url(#deepSpaceGradient)">
            <animate attributeName="opacity" values="1;0.9;1" dur="30s" repeatCount="indefinite"/>
        </rect>
        
        <rect width="100%" height="100%" fill="url(#subtleNebula)" opacity="0.7">
            <animateTransform attributeName="transform" type="rotate" from="0 720 450" to="360 720 450" dur="120s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.5;0.8;0.5" dur="60s" repeatCount="indefinite"/>
        </rect>
        
        <!-- Layer 1.5: Animated stellar background -->
        <g class="slow-drift">
            <!-- Add more stars with different animations -->
            <g opacity="0.7">
                <circle cx="150" cy="100" r="0.9" fill="#E0E0E0">
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="5s" repeatCount="indefinite" begin="-1s"/>
                </circle>
                <circle cx="1200" cy="800" r="1.2" fill="#E0E0E0">
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="7s" repeatCount="indefinite" begin="-3s"/>
                </circle>
                <circle cx="800" cy="50" r="0.8" fill="#E0E0E0">
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="6s" repeatCount="indefinite" begin="-2s"/>
                </circle>
                <circle cx="400" cy="850" r="1" fill="#E0E0E0">
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="4s" repeatCount="indefinite" begin="-1.5s"/>
                </circle>
                <circle cx="1350" cy="400" r="0.9" fill="#E0E0E0">
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="8s" repeatCount="indefinite" begin="-4s"/>
                </circle>
                <circle cx="250" cy="300" r="1.1" fill="#E0E0E0">
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="6s" repeatCount="indefinite" begin="-2.5s"/>
                </circle>
                <circle cx="980" cy="720" r="0.8" fill="#E0E0E0">
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="7s" repeatCount="indefinite" begin="-3.5s"/>
                </circle>
                <circle cx="780" cy="250" r="1" fill="#E0E0E0">
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="5s" repeatCount="indefinite" begin="-1.8s"/>
                </circle>
                <circle cx="500" cy="600" r="0.9" fill="#E0E0E0">
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="6s" repeatCount="indefinite" begin="-2.2s"/>
                </circle>
                <circle cx="1150" cy="350" r="1.1" fill="#E0E0E0">
                    <animate attributeName="opacity" values="0.7;1;0.7" dur="8s" repeatCount="indefinite" begin="-4.2s"/>
                </circle>
            </g>
        </g>
        
        <!-- Layer 1.8: Distant cosmic nebulae -->
        <g opacity="0.2" class="medium-drift">
            <ellipse cx="300" cy="200" rx="280" ry="180" fill="url(#glowEffect)">
                <animate attributeName="opacity" values="0.2;0.4;0.2" dur="30s" repeatCount="indefinite"/>
                <animateTransform attributeName="transform" type="rotate" from="0 300 200" to="360 300 200" dur="180s" repeatCount="indefinite"/>
            </ellipse>
            
            <ellipse cx="1100" cy="750" rx="320" ry="200" fill="url(#glowEffect)">
                <animate attributeName="opacity" values="0.2;0.3;0.2" dur="35s" repeatCount="indefinite"/>
                <animateTransform attributeName="transform" type="rotate" from="0 1100 750" to="-360 1100 750" dur="200s" repeatCount="indefinite"/>
            </ellipse>
        </g>
    
        <!-- Layer 2: Structural Layer (Grid & Blueprints) with enhanced animation -->
        <rect width="100%" height="100%" fill="url(#blueprintGridDetailed)" opacity="0.7">
            <animate attributeName="opacity" values="0.7;0.5;0.7" dur="40s" repeatCount="indefinite"/>
        </rect>
        
        <g stroke="url(#blueprintLineGradient)" stroke-width="0.8" fill="none" filter="url(#softBlur)">
            <!-- Animated drawing/fading shapes with enhanced timing -->
            <path d="M 200,200 H 500 V 500 H 200 Z" class="drawing-line" filter="url(#neonGlow)">
                <animate attributeName="stroke-dashoffset" values="2000; 0; 0; 0; 2000" dur="25s" repeatCount="indefinite" begin="-5s"/>
                <animate attributeName="opacity" values="0; 0.9; 0.9; 0; 0" dur="25s" repeatCount="indefinite" begin="-5s" keyTimes="0; 0.2; 0.7; 0.9; 1"/>
            </path>
            
            <circle cx="1100" cy="250" r="150" class="drawing-line" filter="url(#neonGlow)">
                <animate attributeName="stroke-dashoffset" values="2000; 0; 0; 0; 2000" dur="30s" repeatCount="indefinite" begin="-12s"/>
                <animate attributeName="opacity" values="0; 0.8; 0.8; 0; 0" dur="30s" repeatCount="indefinite" begin="-12s" keyTimes="0; 0.15; 0.7; 0.9; 1"/>
            </circle>
            
            <path d="M 100,700 Q 250,600 400,700 T 700,700" class="drawing-line" filter="url(#neonGlow)">
                <animate attributeName="stroke-dashoffset" values="2000; 0; 0; 0; 2000" dur="28s" repeatCount="indefinite" begin="-2s"/>
                <animate attributeName="opacity" values="0; 0.85; 0.85; 0; 0" dur="28s" repeatCount="indefinite" begin="-2s" keyTimes="0; 0.2; 0.7; 0.9; 1"/>
            </path>
            
            <!-- New path - hexagon -->
            <path d="M 1000,400 L 1060,370 L 1120,400 L 1120,460 L 1060,490 L 1000,460 Z" class="drawing-line" filter="url(#neonGlow)">
                <animate attributeName="stroke-dashoffset" values="2000; 0; 0; 0; 2000" dur="32s" repeatCount="indefinite" begin="-18s"/>
                <animate attributeName="opacity" values="0; 0.9; 0.9; 0; 0" dur="32s" repeatCount="indefinite" begin="-18s" keyTimes="0; 0.2; 0.7; 0.9; 1"/>
            </path>
            
            <!-- New path - triangle -->
            <path d="M 350,150 L 450,300 L 250,300 Z" class="drawing-line" filter="url(#neonGlow)">
                <animate attributeName="stroke-dashoffset" values="2000; 0; 0; 0; 2000" dur="22s" repeatCount="indefinite" begin="-8s"/>
                <animate attributeName="opacity" values="0; 0.85; 0.85; 0; 0" dur="22s" repeatCount="indefinite" begin="-8s" keyTimes="0; 0.2; 0.7; 0.9; 1"/>
            </path>
    
            <!-- Enhanced rotating wireframes with more shapes -->
            <use href="#wireframeCube" x="300" y="650" width="70" height="70" filter="url(#neonGlow)">
                <animateTransform attributeName="transform" type="rotate" from="0 335 685" to="360 335 685" dur="40s" repeatCount="indefinite" begin="-8s"/>
                <animate attributeName="opacity" values="0.3; 0.9; 0.3" dur="20s" repeatCount="indefinite"/>
            </use>
            
            <use href="#wireframePyramid" x="800" y="300" width="75" height="75" filter="url(#neonGlow)">
                <animateTransform attributeName="transform" type="rotate" from="0 837.5 337.5" to="360 837.5 337.5" dur="45s" repeatCount="indefinite" begin="-12s"/>
                <animate attributeName="opacity" values="0.4; 0.8; 0.4" dur="22s" repeatCount="indefinite"/>
            </use>
            
            <use href="#wireframeSphere" x="1250" y="550" width="90" height="90" filter="url(#neonGlow)">
                <animateTransform attributeName="transform" type="rotate" from="0 1295 595" to="-360 1295 595" dur="50s" repeatCount="indefinite" begin="-25s"/>
                <animate attributeName="opacity" values="0.3; 0.7; 0.3" dur="25s" repeatCount="indefinite"/>
            </use>
            
            <use href="#wireframeCube" x="600" y="150" width="60" height="60" filter="url(#neonGlow)">
                <animateTransform attributeName="transform" type="rotate" from="0 630 180" to="-360 630 180" dur="35s" repeatCount="indefinite" begin="-15s"/>
                <animate attributeName="opacity" values="0.3; 0.8; 0.3" dur="18s" repeatCount="indefinite"/>
            </use>
        </g>
    
        <!-- Layer 3: Enhanced Dynamic Layer (Data Flow & Bio) -->
        <g>
            <!-- Enhanced Circuit Paths with more complex designs -->
            <path id="dataPath1" d="M50,50 H 250 V 250 H 450 V 100 H 650 V 250 H 850" fill="none" stroke="#37474F" stroke-width="1.8" opacity="0.6" filter="url(#neonGlow)"/>
            
            <path id="dataPath2" d="M1390,850 H 1190 V 650 H 990 V 800 H 790 V 650 H 590" fill="none" stroke="#37474F" stroke-width="1.5" opacity="0.5" filter="url(#neonGlow)"/>
            
            <path id="dataPath3" d="M 50, 400 Q 250, 300, 450, 400 T 850, 400 Q 1050, 500, 1250, 400" fill="none" stroke="#37474F" stroke-width="1.6" opacity="0.7" filter="url(#neonGlow)"/>
            
            <path id="dataPath4" d="M 50, 600 C 200, 500, 300, 700, 450, 600 S 700, 500, 850, 600 S 1100, 700, 1250, 600" fill="none" stroke="#37474F" stroke-width="1.7" opacity="0.6" filter="url(#neonGlow)"/>
            
            <path id="dataPath5" d="M 1300, 200 Q 1100, 150, 900, 200 T 500, 200 Q 300, 250, 100, 200" fill="none" stroke="#37474F" stroke-width="1.5" opacity="0.5" filter="url(#neonGlow)"/>
    
            <!-- Circuit Nodes at intersections -->
            <use href="#circuitNode" x="245" y="245" width="20" height="20"/>
            <use href="#circuitNode" x="445" y="95" width="20" height="20"/>
            <use href="#circuitNode" x="645" y="245" width="20" height="20"/>
            
            <use href="#circuitNode" x="985" y="795" width="20" height="20"/>
            <use href="#circuitNode" x="785" y="645" width="20" height="20"/>
            
            <use href="#circuitNode" x="450" y="395" width="20" height="20"/>
            <use href="#circuitNode" x="850" y="395" width="20" height="20"/>
            
            <use href="#circuitNode" x="450" y="595" width="20" height="20"/>
            <use href="#circuitNode" x="850" y="595" width="20" height="20"/>
            
            <use href="#circuitNode" x="900" y="195" width="20" height="20"/>
            <use href="#circuitNode" x="500" y="195" width="20" height="20"/>
    
            <!-- Enhanced Data Pulses with more variety and animation -->
            <circle r="4" fill="url(#dataPulseGradient)" filter="url(#particleGlow)">
                <animateMotion dur="8s" repeatCount="indefinite" begin="-1s">
                    <mpath href="#dataPath1"/>
                </animateMotion>
                <animate attributeName="r" values="4; 6; 4" dur="1s" repeatCount="indefinite"/>
            </circle>
            
            <circle r="3.5" fill="url(#dataPulseGradient)" filter="url(#particleGlow)">
                <animateMotion dur="8s" repeatCount="indefinite" begin="-5s">
                    <mpath href="#dataPath1"/>
                </animateMotion>
                <animate attributeName="r" values="3.5; 5.5; 3.5" dur="1.2s" repeatCount="indefinite"/>
            </circle>
            
            <circle r="3" fill="url(#dataPulseGradient)" filter="url(#particleGlow)">
                <animateMotion dur="10s" repeatCount="indefinite" begin="-6s">
                    <mpath href="#dataPath2"/>
                </animateMotion>
                <animate attributeName="r" values="3; 5; 3" dur="1.4s" repeatCount="indefinite"/>
            </circle>
            
            <circle r="3.5" fill="url(#dataPulseGradient)" filter="url(#particleGlow)">
                <animateMotion dur="10s" repeatCount="indefinite" begin="-1s">
                    <mpath href="#dataPath2"/>
                </animateMotion>
                <animate attributeName="r" values="3.5; 5.5; 3.5" dur="1.3s" repeatCount="indefinite"/>
            </circle>
            
            <circle r="4" fill="url(#dataPulseGradient)" filter="url(#particleGlow)">
                <animateMotion dur="9s" repeatCount="indefinite" begin="-3s">
                    <mpath href="#dataPath3"/>
                </animateMotion>
                <animate attributeName="r" values="4; 6; 4" dur="0.9s" repeatCount="indefinite"/>
            </circle>
            
            <circle r="3" fill="url(#dataPulseGradient)" filter="url(#particleGlow)">
                <animateMotion dur="9s" repeatCount="indefinite" begin="-7s">
                    <mpath href="#dataPath3"/>
                </animateMotion>
                <animate attributeName="r" values="3; 5; 3" dur="1.1s" repeatCount="indefinite"/>
            </circle>
            
            <circle r="3.5" fill="url(#dataPulseGradient)" filter="url(#particleGlow)">
                <animateMotion dur="12s" repeatCount="indefinite" begin="-2s">
                    <mpath href="#dataPath4"/>
                </animateMotion>
                <animate attributeName="r" values="3.5; 5.5; 3.5" dur="1s" repeatCount="indefinite"/>
            </circle>
            
            <circle r="4" fill="url(#dataPulseGradient)" filter="url(#particleGlow)">
                <animateMotion dur="12s" repeatCount="indefinite" begin="-8s">
                    <mpath href="#dataPath4"/>
                </animateMotion>
                <animate attributeName="r" values="4; 6; 4" dur="1.2s" repeatCount="indefinite"/>
            </circle>
            
            <circle r="3" fill="url(#dataPulseGradient)" filter="url(#particleGlow)">
                <animateMotion dur="11s" repeatCount="indefinite" begin="-4s">
                    <mpath href="#dataPath5"/>
                </animateMotion>
                <animate attributeName="r" values="3; 5; 3" dur="1.3s" repeatCount="indefinite"/>
            </circle>
            
            <circle r="3.5" fill="url(#dataPulseGradient)" filter="url(#particleGlow)">
                <animateMotion dur="11s" repeatCount="indefinite" begin="-9s">
                    <mpath href="#dataPath5"/>
                </animateMotion>
                <animate attributeName="r" values="3.5; 5.5; 3.5" dur="1.1s" repeatCount="indefinite"/>
            </circle>
    
            <!-- Enhanced DNA Helix with more animation -->
            <g transform="translate(900 500) rotate(-20)" class="fading-element" style="animation-delay: -10s;" filter="url(#neonGlow)">
                <use href="#dnaSegment" x="0" y="0" width="18" height="180">
                    <animateTransform attributeName="transform" type="translate" additive="sum" values="0 0; 0 -15; 0 15; 0 0" dur="12s" repeatCount="indefinite"/>
                    <animateTransform attributeName="transform" type="rotate" additive="sum" values="0; 10; -10; 0" dur="15s" repeatCount="indefinite"/>
                </use>
            </g>
            
            <g transform="translate(150 450) rotate(15)" class="fading-element" style="animation-delay: -2s;" filter="url(#neonGlow)">
                <use href="#dnaSegment" x="0" y="0" width="15" height="150">
                    <animateTransform attributeName="transform" type="translate" additive="sum" values="0 0; 8 8; -8 -8; 0 0" dur="14s" repeatCount="indefinite"/>
                    <animateTransform attributeName="transform" type="rotate" additive="sum" values="0; -12; 12; 0" dur="17s" repeatCount="indefinite"/>
                </use>
            </g>
            
            <g transform="translate(500 700) rotate(-10)" class="fading-element" style="animation-delay: -6s;" filter="url(#neonGlow)">
                <use href="#dnaSegment" x="0" y="0" width="16" height="160">
                    <animateTransform attributeName="transform" type="translate" additive="sum" values="0 0; -10 10; 10 -10; 0 0" dur="13s" repeatCount="indefinite"/>
                    <animateTransform attributeName="transform" type="rotate" additive="sum" values="0; 15; -15; 0" dur="16s" repeatCount="indefinite"/>
                </use>
            </g>
            
            <g transform="translate(1300 250) rotate(25)" class="fading-element" style="animation-delay: -8s;" filter="url(#neonGlow)">
                <use href="#dnaSegment" x="0" y="0" width="14" height="140">
                    <animateTransform attributeName="transform" type="translate" additive="sum" values="0 0; 12 -12; -12 12; 0 0" dur="15s" repeatCount="indefinite"/>
                    <animateTransform attributeName="transform" type="rotate" additive="sum" values="0; -8; 8; 0" dur="18s" repeatCount="indefinite"/>
                </use>
            </g>
        </g>
    
        <!-- Layer 4: Enhanced Ambient Particles with more variety -->
        <g filter="url(#particleGlow)">
            <!-- Particle Group 1: Slow floaters with complex paths -->
            <g class="slow-drift">
                <circle cx="100" cy="200" r="3" fill="url(#particleColor1)" opacity="0.8">
                    <animate attributeName="cx" values="100;180;60;140;100" dur="45s" repeatCount="indefinite" begin="-3s"/>
                    <animate attributeName="cy" values="200;160;240;180;200" dur="50s" repeatCount="indefinite" begin="-8s"/>
                    <animate attributeName="r" values="3;4;2.5;3.5;3" dur="20s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.8;1;0.6;1;0.8" dur="15s" repeatCount="indefinite"/>
                </circle>
                
                <circle cx="1300" cy="700" r="4" fill="url(#particleColor2)" opacity="0.7">
                    <animate attributeName="cx" values="1300;1230;1350;1270;1300" dur="60s" repeatCount="indefinite" begin="-15s"/>
                    <animate attributeName="cy" values="700;760;660;730;700" dur="55s" repeatCount="indefinite" begin="-2s"/>
                    <animate attributeName="r" values="4;5;3;4.5;4" dur="25s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.7;0.9;0.5;0.9;0.7" dur="20s" repeatCount="indefinite"/>
                </circle>
                
                <circle cx="700" cy="450" r="2.5" fill="url(#particleColor3)" opacity="0.9">
                    <animate attributeName="cx" values="700;750;670;720;700" dur="38s" repeatCount="indefinite" begin="-22s"/>
                    <animate attributeName="cy" values="450;490;420;470;450" dur="42s" repeatCount="indefinite" begin="-5s"/>
                    <animate attributeName="r" values="2.5;3.5;2;3;2.5" dur="15s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.9;1;0.7;1;0.9" dur="12s" repeatCount="indefinite"/>
                </circle>
            </g>
            
            <!-- Particle Group 2: Medium speed with more erratic movements -->
            <g class="medium-drift">
                <circle cx="500" cy="800" r="3.5" fill="url(#particleColor1)" opacity="0.6">
                    <animate attributeName="cx" values="500;420;580;480;500" dur="40s" repeatCount="indefinite" begin="-10s"/>
                    <animate attributeName="cy" values="800;860;750;830;800" dur="35s" repeatCount="indefinite" begin="-18s"/>
                    <animate attributeName="r" values="3.5;4.5;2.5;4;3.5" dur="18s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.6;0.9;0.4;0.9;0.6" dur="15s" repeatCount="indefinite"/>
                </circle>
                
                <circle cx="1000" cy="100" r="3" fill="url(#particleColor2)" opacity="0.8">
                    <animate attributeName="cx" values="1000;1080;960;1030;1000" dur="32s" repeatCount="indefinite" begin="-1s"/>
                    <animate attributeName="cy" values="100;140;70;120;100" dur="28s" repeatCount="indefinite" begin="-14s"/>
                    <animate attributeName="r" values="3;4;2.5;3.5;3" dur="16s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.8;1;0.6;1;0.8" dur="12s" repeatCount="indefinite"/>
                </circle>
                
                <circle cx="300" cy="600" r="2.5" fill="url(#particleColor3)" opacity="0.7">
                    <animate attributeName="cx" values="300;350;270;320;300" dur="36s" repeatCount="indefinite" begin="-7s"/>
                    <animate attributeName="cy" values="600;640;580;620;600" dur="30s" repeatCount="indefinite" begin="-21s"/>
                    <animate attributeName="r" values="2.5;3.5;2;3;2.5" dur="14s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.7;1;0.5;1;0.7" dur="10s" repeatCount="indefinite"/>
                </circle>
            </g>
            
            <!-- Particle Group 3: Fast movers with pulse effect -->
            <g class="fast-drift">
                <circle cx="850" cy="250" r="2" fill="url(#particleColor1)" opacity="0.9">
                    <animate attributeName="cx" values="850;890;820;870;850" dur="20s" repeatCount="indefinite" begin="-5s"/>
                    <animate attributeName="cy" values="250;220;270;240;250" dur="18s" repeatCount="indefinite" begin="-12s"/>
                    <animate attributeName="r" values="2;3;1.5;2.5;2" dur="8s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.9;1;0.7;1;0.9" dur="6s" repeatCount="indefinite"/>
                </circle>
                
                <circle cx="1200" cy="500" r="2.5" fill="url(#particleColor2)" opacity="0.8">
                    <animate attributeName="cx" values="1200;1240;1170;1220;1200" dur="16s" repeatCount="indefinite" begin="-3s"/>
                    <animate attributeName="cy" values="500;460;530;490;500" dur="15s" repeatCount="indefinite" begin="-9s"/>
                    <animate attributeName="r" values="2.5;3.5;2;3;2.5" dur="10s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.8;1;0.6;1;0.8" dur="7s" repeatCount="indefinite"/>
                </circle>
                
                <circle cx="400" cy="350" r="3" fill="url(#particleColor3)" opacity="0.7">
                    <animate attributeName="cx" values="400;430;380;410;400" dur="18s" repeatCount="indefinite" begin="-6s"/>
                    <animate attributeName="cy" values="350;320;370;340;350" dur="17s" repeatCount="indefinite" begin="-14s"/>
                    <animate attributeName="r" values="3;4;2;3.5;3" dur="12s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.7;0.9;0.5;0.9;0.7" dur="8s" repeatCount="indefinite"/>
                </circle>
            </g>
            
            <!-- Floating energy orbs with glow effect -->
            <g class="float-around">
                <circle cx="600" cy="300" r="8" fill="url(#particleColor1)" opacity="0.2" filter="url(#neonGlow)">
                    <animate attributeName="r" values="8;12;8" dur="8s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.2;0.4;0.2" dur="8s" repeatCount="indefinite"/>
                </circle>
                
                <circle cx="900" cy="650" r="10" fill="url(#particleColor2)" opacity="0.15" filter="url(#neonGlow)">
                    <animate attributeName="r" values="10;15;10" dur="10s" repeatCount="indefinite" begin="-3s"/>
                    <animate attributeName="opacity" values="0.15;0.3;0.15" dur="10s" repeatCount="indefinite" begin="-3s"/>
                </circle>
                
                <circle cx="250" cy="500" r="7" fill="url(#particleColor3)" opacity="0.25" filter="url(#neonGlow)">
                    <animate attributeName="r" values="7;11;7" dur="9s" repeatCount="indefinite" begin="-5s"/>
                    <animate attributeName="opacity" values="0.25;0.35;0.25" dur="9s" repeatCount="indefinite" begin="-5s"/>
                </circle>
                
                <circle cx="1100" cy="200" r="9" fill="url(#particleColor1)" opacity="0.2" filter="url(#neonGlow)">
                    <animate attributeName="r" values="9;14;9" dur="11s" repeatCount="indefinite" begin="-7s"/>
                    <animate attributeName="opacity" values="0.2;0.35;0.2" dur="11s" repeatCount="indefinite" begin="-7s"/>
                </circle>
            </g>
            
            <!-- Pulsing rings that expand and fade -->
            <g>
                <circle cx="720" cy="450" r="5" stroke="url(#particleColor2)" stroke-width="2" fill="none" opacity="0.6">
                    <animate attributeName="r" values="5;100;5" dur="20s" repeatCount="indefinite"/>
                    <animate attributeName="stroke-opacity" values="0.6;0;0.6" dur="20s" repeatCount="indefinite"/>
                    <animate attributeName="stroke-width" values="2;0.5;2" dur="20s" repeatCount="indefinite"/>
                </circle>
                
                <circle cx="720" cy="450" r="5" stroke="url(#particleColor1)" stroke-width="2" fill="none" opacity="0.5">
                    <animate attributeName="r" values="5;80;5" dur="15s" repeatCount="indefinite" begin="-5s"/>
                    <animate attributeName="stroke-opacity" values="0.5;0;0.5" dur="15s" repeatCount="indefinite" begin="-5s"/>
                    <animate attributeName="stroke-width" values="2;0.5;2" dur="15s" repeatCount="indefinite" begin="-5s"/>
                </circle>
                
                <circle cx="720" cy="450" r="5" stroke="url(#particleColor3)" stroke-width="2" fill="none" opacity="0.4">
                    <animate attributeName="r" values="5;60;5" dur="10s" repeatCount="indefinite" begin="-7s"/>
                    <animate attributeName="stroke-opacity" values="0.4;0;0.4" dur="10s" repeatCount="indefinite" begin="-7s"/>
                    <animate attributeName="stroke-width" values="2;0.5;2" dur="10s" repeatCount="indefinite" begin="-7s"/>
                </circle>
            </g>
            
            <!-- Additional small particles scattered throughout -->
            <g class="pulse-rotate">
                <circle cx="150" cy="750" r="1.5" fill="url(#particleColor1)" opacity="0.8"/>
                <circle cx="1050" cy="300" r="1.8" fill="url(#particleColor2)" opacity="0.7"/>
                <circle cx="550" cy="150" r="1.2" fill="url(#particleColor3)" opacity="0.9"/>
                <circle cx="950" cy="800" r="1.4" fill="url(#particleColor1)" opacity="0.8"/>
                <circle cx="1350" cy="550" r="1.6" fill="url(#particleColor2)" opacity="0.7"/>
                <circle cx="250" cy="400" r="1.3" fill="url(#particleColor3)" opacity="0.9"/>
                <circle cx="800" cy="100" r="1.5" fill="url(#particleColor1)" opacity="0.8"/>
                <circle cx="650" cy="850" r="1.7" fill="url(#particleColor2)" opacity="0.7"/>
                <circle cx="350" cy="550" r="1.2" fill="url(#particleColor3)" opacity="0.9"/>
                <circle cx="1150" cy="450" r="1.6" fill="url(#particleColor1)" opacity="0.8"/>
                <circle cx="450" cy="200" r="1.4" fill="url(#particleColor2)" opacity="0.7"/>
                <circle cx="1250" cy="700" r="1.3" fill="url(#particleColor3)" opacity="0.9"/>
            </g>
            
            <!-- Shooting particles that move quickly across screen -->
            <g>
                <circle cx="-50" cy="200" r="2" fill="url(#particleColor1)" opacity="0.9">
                    <animate attributeName="cx" values="-50;1500" dur="6s" repeatCount="indefinite" begin="-2s"/>
                    <animate attributeName="opacity" values="0;0.9;0" dur="6s" repeatCount="indefinite" begin="-2s"/>
                </circle>
                
                <circle cx="-50" cy="600" r="2.5" fill="url(#particleColor2)" opacity="0.8">
                    <animate attributeName="cx" values="-50;1500" dur="8s" repeatCount="indefinite" begin="-5s"/>
                    <animate attributeName="opacity" values="0;0.8;0" dur="8s" repeatCount="indefinite" begin="-5s"/>
                </circle>
                
                <circle cx="1500" cy="300" r="2" fill="url(#particleColor3)" opacity="0.7">
                    <animate attributeName="cx" values="1500;-50" dur="7s" repeatCount="indefinite" begin="-3s"/>
                    <animate attributeName="opacity" values="0;0.7;0" dur="7s" repeatCount="indefinite" begin="-3s"/>
                </circle>
                
                <circle cx="1500" cy="700" r="2.5" fill="url(#particleColor1)" opacity="0.8">
                    <animate attributeName="cx" values="1500;-50" dur="9s" repeatCount="indefinite" begin="-7s"/>
                    <animate attributeName="opacity" values="0;0.8;0" dur="9s" repeatCount="indefinite" begin="-7s"/>
                </circle>
            </g>
        </g>
        
        <!-- Layer 5: Interactive Highlight Effects -->
        <g opacity="0.3" class="float-around" style="animation-delay: -10s;">
            <ellipse cx="720" cy="450" rx="400" ry="300" fill="none" stroke="url(#blueprintLineGradient)" stroke-width="2" filter="url(#softBlur)">
                <animate attributeName="rx" values="400;420;380;410;400" dur="40s" repeatCount="indefinite"/>
                <animate attributeName="ry" values="300;280;320;290;300" dur="45s" repeatCount="indefinite"/>
                <animate attributeName="stroke-opacity" values="0.3;0.6;0.3" dur="20s" repeatCount="indefinite"/>
            </ellipse>
        </g>
    </svg>

    <div id="info">Scroll down to start...</div>
    <div id="scrollInfo">Scroll down</div>
    <script>
        // Select only the icon containers within the problem and feature sections
        const iconContainers = document.querySelectorAll('#problem-icons .icon-container, #feature-icons .icon-container');

        iconContainers.forEach(container => {
            container.addEventListener('click', () => {
                const iconElement = container.querySelector('.icon'); // Find the main icon

                // Ensure we found an icon and it has the necessary data attributes
                if (iconElement && iconElement.dataset.originalIcon && iconElement.dataset.clickedIcon) {
                    const originalIcon = iconElement.dataset.originalIcon;
                    const clickedIcon = iconElement.dataset.clickedIcon;

                    // Check which icon is currently displayed and toggle
                    if (iconElement.classList.contains(originalIcon)) {
                        iconElement.classList.remove(originalIcon);
                        iconElement.classList.add(clickedIcon);
                    } else if (iconElement.classList.contains(clickedIcon)) {
                        iconElement.classList.remove(clickedIcon);
                        iconElement.classList.add(originalIcon);
                    }
                    // Optional: Toggle an active class on the container if needed for styling
                    // container.classList.toggle('is-active');
                }
            });
        });
    </script>
    <script>

        const API_BASE_URL = 'https://sophisticated-twisty-lute.glitch.me';
        const subscribeForm = document.querySelector('.subscribe-form');
        
        if (subscribeForm) {
            subscribeForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const emailInput = this.querySelector('input[type="email"]');
                const email = emailInput.value.trim();

                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert('Please enter a valid email address');
                    return;
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/submit-email`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email }),
                    });

                    const result = await response.json();
                    if (response.ok) {
                        alert('Thank you for subscribing! You\'ll receive updates soon.');
                        emailInput.value = ''; // Clear the input
                    } else {
                        alert(result.message || 'Failed to subscribe. Please try again.');
                    }
                } catch (error) {
                    console.error('Subscription error:', error);
                    alert('An error occurred. Please try again later.');
                }
            });
        }

        document.querySelectorAll('a.button-primary, a.cta-button').forEach(button => {
            button.addEventListener('click', function(e) {
                if (this.getAttribute('href') === 'play.html') {
                    e.preventDefault();
                    window.location.href = 'play.html';
                }
            });
        });

        const menuToggle = document.querySelector('.mobile-menu-toggle');
        const navLinks = document.querySelector('.nav-links');
        const body = document.body;

        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                const isActive = navLinks.classList.toggle('active');
                menuToggle.innerHTML = isActive ? 'âœ•' : 'â˜°'; // Close X vs Burger
                menuToggle.setAttribute('aria-expanded', isActive);
                 // Prevent body scroll when menu is open
                body.style.overflow = isActive ? 'hidden' : '';
            });

            // Close menu if a link is clicked or escape key is pressed
             navLinks.querySelectorAll('a').forEach(link => {
                 link.addEventListener('click', () => {
                      if (navLinks.classList.contains('active')) {
                         navLinks.classList.remove('active');
                         menuToggle.innerHTML = 'â˜°';
                         menuToggle.setAttribute('aria-expanded', 'false');
                         body.style.overflow = '';
                     }
                 });
            });

             // Close menu with Escape key
            window.addEventListener('keydown', (e) => {
                 if (e.key === 'Escape' && navLinks.classList.contains('active')) {
                     navLinks.classList.remove('active');
                     menuToggle.innerHTML = 'â˜°';
                     menuToggle.setAttribute('aria-expanded', 'false');
                     body.style.overflow = '';
                 }
            });
        }

        // --- Header background change on scroll ---
        const header = document.getElementById('site-header');
         if (header) {
             const scrollThreshold = 50; // Pixels to scroll before changing header
             window.addEventListener('scroll', function() {
                 if (window.scrollY > scrollThreshold) {
                     header.classList.add('scrolled');
                 } else {
                      header.classList.remove('scrolled');
                 }
             }, { passive: true }); // Improve scroll performance
         }

         // --- Intersection Observer for Scroll Animations ---
         const observerOptions = {
             root: null, // relative to document viewport
             rootMargin: '0px 0px -10% 0px', // Trigger when element is 10% from bottom edge
             threshold: 0 // Trigger as soon as element enters the margin
        };

        const observerCallback = (entries, observer) => {
             entries.forEach((entry) => { // No need for index here
                if (entry.isIntersecting) {
                    const target = entry.target;

                    // Add visible class to trigger animation
                    target.classList.add('is-visible');

                    // --- Stagger Children Logic ---
                    if (target.classList.contains('stagger-children')) {
                         const children = target.children;
                         for (let i = 0; i < children.length; i++) {
                            // Apply stagger delay inline - ensures it works even if element re-enters view
                            children[i].style.transitionDelay = `${i * 0.1}s`;
                        }
                         // Note: 'is-visible' on parent triggers transition on children due to CSS rules
                    }

                     observer.unobserve(target); // Stop observing after animation triggered once
                }
             });
        };

        const observer = new IntersectionObserver(observerCallback, observerOptions);

         // Observe all elements that need animating
         // Use more specific selectors if needed, e.g., '.section-title', '.feature-card' etc.
         const elementsToAnimate = document.querySelectorAll('.animate-on-scroll, .stagger-children, .feature-card, .step-card, .testimonial-card');
         elementsToAnimate.forEach(el => {
             // Ensure elements start hidden for the animation
             // (Handled by initial CSS opacity/transform)
             observer.observe(el);
         });

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                 const href = this.getAttribute('href');

                // Only act on valid fragment identifiers
                if (href.startsWith('#') && href.length > 1) {
                    try {
                        const targetElement = document.querySelector(href);
                        if (targetElement) {
                            e.preventDefault(); // Prevent default jump

                            // Close mobile menu if open and link is clicked
                             if (navLinks && navLinks.classList.contains('active')) {
                                  navLinks.classList.remove('active');
                                  menuToggle.innerHTML = 'â˜°';
                                  menuToggle.setAttribute('aria-expanded', 'false');
                                  body.style.overflow = '';
                             }

                            const headerHeight = header ? header.offsetHeight : 70; // Get current header height or estimate
                            const elementPosition = targetElement.getBoundingClientRect().top;
                            const offsetPosition = window.pageYOffset + elementPosition - headerHeight;

                             // Use the browser's smooth scroll if available, else jump
                            if ('scrollBehavior' in document.documentElement.style) {
                                window.scrollTo({
                                    top: offsetPosition,
                                    behavior: "smooth"
                                });
                             } else {
                                 window.scrollTo(0, offsetPosition);
                             }
                        }
                    } catch (err) {
                        console.error("Smooth scroll target not found or invalid selector:", href, err);
                        // Allow default behavior for potentially invalid selectors
                    }
                 } else if (href === '#') {
                     e.preventDefault(); // Prevent jumping to top for '#' links
                     window.scrollTo({ top: 0, behavior: 'smooth'}); // Scroll to top smoothly
                 }
                 // Let other links (external, etc.) behave normally
            });
        });
        
        const betaSignup = document.querySelector('.beta-signup');
        if (betaSignup) {
            const betaInput = betaSignup.querySelector('.beta-input');
            const betaButton = betaSignup.querySelector('.beta-button');
            
            betaButton.addEventListener('click', async function(e) {
                // If input is empty or not visible yet, just expand the input field
                if (betaInput.value.trim() === '' || 
                    (window.getComputedStyle(betaInput).width === '0px' || 
                    window.getComputedStyle(betaInput).opacity === '0')) {
                    betaInput.style.width = '180px';
                    betaInput.style.opacity = '1';
                    betaInput.style.padding = 'var(--space-3xs) var(--space-xs)';
                    betaInput.style.transform = 'translateX(0)';
                    betaInput.focus();
                    return;
                }
                
                // Validate email format
                const email = betaInput.value.trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                
                if (!emailRegex.test(email)) {
                    alert('Please enter a valid email address');
                    return;
                }
                
                // Submit the email to the server
                try {
                    const response = await fetch(`${API_BASE_URL}/submit-email`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email }),
                    });

                    const result = await response.json();
                    if (response.ok) {
                        alert('Thank you for joining our beta program! We\'ll be in touch soon.');
                        betaInput.value = ''; // Clear the input
                        
                        // Reset the input field
                        if (window.innerWidth > 768) { // Only collapse on desktop
                            betaInput.style.width = '0';
                            betaInput.style.opacity = '0';
                            betaInput.style.transform = 'translateX(10px)';
                        }
                    } else {
                        alert(result.message || 'Failed to join beta. Please try again.');
                    }
                } catch (error) {
                    console.error('Beta signup error:', error);
                    alert('An error occurred. Please try again later.');
                }
            });
            
            // Make the input expand when focused (for mobile/touch devices)
            betaInput.addEventListener('focus', function() {
                this.style.width = '180px';
                this.style.opacity = '1';
                this.style.padding = 'var(--space-3xs) var(--space-xs)';
                this.style.transform = 'translateX(0)';
            });
        }

        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                const isActive = navLinks.classList.toggle('active');
                menuToggle.innerHTML = isActive ? 'âœ•' : 'â˜°';
                menuToggle.setAttribute('aria-expanded', isActive);
                body.style.overflow = isActive ? 'hidden' : '';
            });

            navLinks.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    if (navLinks.classList.contains('active')) {
                        navLinks.classList.remove('active');
                        menuToggle.innerHTML = 'â˜°';
                        menuToggle.setAttribute('aria-expanded', 'false');
                        body.style.overflow = '';
                    }
                });
            });
        // --- Ensure all buttons open play.html ---
        document.querySelectorAll('a.button-primary, a.cta-button').forEach(button => {
            button.addEventListener('click', function(e) {
                if (this.getAttribute('href') === 'play.html') {
                    e.preventDefault();
                    window.location.href = 'play.html';
                }
            });
        });
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && navLinks.classList.contains('active')) {
                    navLinks.classList.remove('active');
                    menuToggle.innerHTML = 'â˜°';
                    menuToggle.setAttribute('aria-expanded', 'false');
                    body.style.overflow = '';
                }
            });
        }

    </script>
<script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { ParametricGeometry } from 'three/addons/geometries/ParametricGeometry.js';

    // --- Setup ---
    const canvas = document.getElementById('busCanvas');
    const scene = new THREE.Scene();
    const infoElement = document.getElementById('info');
    const scrollInfoElement = document.getElementById('scrollInfo');
    const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 4000); // Increased far plane for taller junction
    
    // IMPORTANT CHANGE: Use alpha: true to make the canvas transparent
    const renderer = new THREE.WebGLRenderer({ 
        canvas: canvas, 
        antialias: true,
        alpha: true    // Make the renderer background transparent
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    
    // Set clear color with 0 alpha (transparent background)
    renderer.setClearColor(0x0A192F, 0); 
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap; // Softer shadows

    // --- OrbitControls Setup ---
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.1;
    controls.enableRotate = true;  // Rotation always allowed
    controls.enableZoom = false;   // Zoom disabled during scroll animation
    controls.enablePan = false;    // Pan disabled during scroll animation
    controls.maxDistance = 1000; // Allow zooming out further in junction view

    // --- All your existing code follows ---
    // --- Control State ---
    let isFullMouseControlActive = false;
    const initialCameraPosition = new THREE.Vector3(24, 50, 60); // Greatly increased height

    const initialCameraTarget = new THREE.Vector3(0, 4, 0); // Focus higher on the bus to see tires better
        camera.position.copy(initialCameraPosition);
    controls.target.copy(initialCameraTarget);
    controls.update(); // IMPORTANT: Sync OrbitControls internal state

    // Helper function to get target distance for a given page
    function getTargetDistanceForPage(pageName) {
         // Ensure scrollAnimationParams is defined before accessing it
        if (typeof scrollAnimationParams !== 'undefined' && scrollAnimationParams.scrollPages[pageName]) {
             return scrollAnimationParams.scrollPages[pageName].dist ?? controls.getDistance();
        }
        return controls.getDistance(); // Fallback
    }

    

    // --- Materials, Bus, Junction, Etc. ---
    const lineMaterial = new THREE.LineBasicMaterial({ color: 0x87CEEB, linewidth: 1.5 });
    const detailLineMaterial = new THREE.LineBasicMaterial({ color: 0x87CEEB, linewidth: 1.0 });
    const headlightMaterial = new THREE.MeshBasicMaterial({ color: 0x87CEEB, wireframe: true });
    const wheelMaterial = new THREE.MeshBasicMaterial({ color: 0xADD8E6, wireframe: true }); // Kept wireframe for wheels
    const robotMaterial = new THREE.LineBasicMaterial({ color: 0xFF4500, linewidth: 1.5 });
    const jointMaterial = new THREE.LineBasicMaterial({ color: 0xADD8E6, linewidth: 1.8 });
    const foodMaterial = new THREE.LineBasicMaterial({ color: 0xADD8E6, linewidth: 1.0 });
    const cookingSurfaceMaterial = new THREE.LineBasicMaterial({ color: 0xADD8E6, linewidth: 1.2 });
    const roadMaterial = new THREE.LineBasicMaterial({ color: 0x0A192F, linewidth: 2.0 }); // Keep for the moving road effect
    const laneMaterial = new THREE.LineBasicMaterial({ color: 0xFFFFFF, linewidth: 1.0 });
    const roadEdgeMaterial = new THREE.LineBasicMaterial({ color: 0xAAAAAA, linewidth: 1.5 });
    const whiteLineMaterial = new THREE.LineBasicMaterial({ color: 0xFFFFFF, linewidth: 1 });
    const yellowLineMaterial = new THREE.LineBasicMaterial({ color: 0x0A192F, linewidth: 1 });
    const curbMaterial = new THREE.LineBasicMaterial({ color: 0x888888, linewidth: 1.5 });
    const poleMaterial = new THREE.MeshStandardMaterial({ color: 0x0A192F, roughness: 0.7 });
    const lightBoxMaterial = new THREE.MeshStandardMaterial({ color: 0x222034 , roughness: 0.5 });
    const lightOffMaterial = new THREE.MeshStandardMaterial({ color: 0x222222, roughness: 0.2, emissive: 0x0A192F });
    const redLightMaterial = new THREE.MeshStandardMaterial({ color: 0xFF0000, roughness: 0.2, emissive: 0x0A192F, emissiveIntensity: 0.8 });
    const yellowLightMaterial = new THREE.MeshStandardMaterial({ color: 0x0A192F, roughness: 0.2, emissive: 0xFFFF00, emissiveIntensity: 0.8 });
    const greenLightMaterial = new THREE.MeshStandardMaterial({ color: 0x00FF00, roughness: 0.2, emissive: 0x00FF00, emissiveIntensity: 0.8 });

    // *** NEW: Solid Pillar Material ***
    const pillarMaterial = new THREE.MeshStandardMaterial({ color: 0x0A192F, roughness: 0.8, metalness: 0.1 }); // Concrete look
    const singleRoadSurfaceMaterial = new THREE.MeshStandardMaterial({
         color: 0x0A192F, // Dark asphalt color
      

         side: THREE.DoubleSide // Render both sides in case of issues
    });
    const junctionGroundRoadMaterial = new THREE.MeshBasicMaterial({ color: 0x0A192F, side: THREE.DoubleSide }); // Slightly darker gray for junction ground
    // *** NEW: Solid Flyover Road Surface Material ***
    const flyoverRoadMaterial = new THREE.MeshStandardMaterial({
         color: 0x0A192F, // Dark asphalt color

         side: THREE.DoubleSide // Render both sides in case of issues
    });

    // *** Ground Material (Matches background) ***
    const groundMaterial = new THREE.MeshBasicMaterial({ color: 0x0A192F, opacity:0 });

    const busColorMaterials = [
        new THREE.LineBasicMaterial({ color: 0xADD8E6, linewidth: 1.5 }), // Original Blue (For main bus)
        // Different materials for junction buses if needed, or use the same line material
        new THREE.LineBasicMaterial({ color: 0xADD8E6, linewidth: 1.5 }), // Orange
        new THREE.LineBasicMaterial({ color: 0x0A192F, linewidth: 1.5 }), // Green
        new THREE.LineBasicMaterial({ color: 0x0A192F, linewidth: 1.5 }), // Yellow
        new THREE.LineBasicMaterial({ color: 0x0A192F, linewidth: 1.5 }), // Pink
        new THREE.LineBasicMaterial({ color: 0x0A192F, linewidth: 1.5 })  // Cyan
    ];

    // --- Bus Group and Dimensions (Unchanged) ---
    const busGroup = new THREE.Group(); scene.add(busGroup); const busLength = 8; const busWidth = 2.5; const busHeight = 3.5; const floorY = 0.4; const roofY = busHeight; 
    const wheelRadius = 0.5;
     const wheelWidth = 0.3; const halfL = busLength / 2; const halfW = busWidth / 2; const frontAxleX = -halfL * 0.7; const rearAxle1X = halfL * 0.35; const rearAxle2X = halfL * 0.7; const allLinePoints = []; const detailLinePoints = [];        // --- Geometry Generation Functions (unchanged) ---
    function addCurvePoints(curve, segments, pointArray) { const points = curve.getPoints(segments); for (let i = 0; i < points.length - 1; i++) { pointArray.push(points[i], points[i + 1]); } }

    function addRectangle(x1, y1, x2, y2, z, pointArray) { pointArray.push(new THREE.Vector3(x1, y1, z)); pointArray.push(new THREE.Vector3(x2, y1, z)); pointArray.push(new THREE.Vector3(x2, y1, z)); pointArray.push(new THREE.Vector3(x2, y2, z)); pointArray.push(new THREE.Vector3(x2, y2, z)); pointArray.push(new THREE.Vector3(x1, y2, z)); pointArray.push(new THREE.Vector3(x1, y2, z)); pointArray.push(new THREE.Vector3(x1, y1, z)); }
    function addRectangleYZ(x, y1, z1, y2, z2, pointArray) { pointArray.push(new THREE.Vector3(x, y1, z1)); pointArray.push(new THREE.Vector3(x, y1, z2)); pointArray.push(new THREE.Vector3(x, y1, z2)); pointArray.push(new THREE.Vector3(x, y2, z2)); pointArray.push(new THREE.Vector3(x, y2, z2)); pointArray.push(new THREE.Vector3(x, y2, z1)); pointArray.push(new THREE.Vector3(x, y2, z1)); pointArray.push(new THREE.Vector3(x, y1, z1)); }
    function addCircleOutline(centerX, centerY, centerZ, radiusX, radiusY, segments, rotation, pointArray) { const points = []; for (let i = 0; i <= segments; i++) { const angle = (i / segments) * Math.PI * 2 + rotation; points.push(new THREE.Vector3( centerX + radiusX * Math.cos(angle), centerY + radiusY * Math.sin(angle), centerZ )); } for (let i = 0; i < points.length - 1; i++) { pointArray.push(points[i], points[i+1]); } pointArray.push(points[points.length-1], points[0]); }
    function addCircleOutlineYZ(centerX, centerY, centerZ, radiusY, radiusZ, segments, pointArray) { const points = []; for (let i = 0; i <= segments; i++) { const angle = (i / segments) * Math.PI * 2; points.push(new THREE.Vector3( centerX, centerY + radiusY * Math.sin(angle), centerZ + radiusZ * Math.cos(angle) )); } for (let i = 0; i < points.length - 1; i++) { pointArray.push(points[i], points[i+1]); } pointArray.push(points[points.length-1], points[0]); }
    function addGridYZ(x, y1, z1, y2, z2, rowsCount, colsCount, pointArray) { const width = z2 - z1; const height = y2 - y1; for (let i = 0; i <= rowsCount; i++) { const y = y1 + (height * i / rowsCount); pointArray.push(new THREE.Vector3(x, y, z1)); pointArray.push(new THREE.Vector3(x, y, z2)); } for (let i = 0; i <= colsCount; i++) { const z = z1 + (width * i / colsCount); pointArray.push(new THREE.Vector3(x, y1, z)); pointArray.push(new THREE.Vector3(x, y2, z)); } }
    function addLine(x1, y1, z1, x2, y2, z2, pointArray) { pointArray.push(new THREE.Vector3(x1, y1, z1)); pointArray.push(new THREE.Vector3(x2, y2, z2)); }
    function generateBezierCurve(points, closed = false) { const curve = new THREE.CatmullRomCurve3(points); curve.closed = closed; return curve; } // Using CatmullRom for smoother curves

    // --- Pillar Function (Solid Mesh) ---
    function createPillar(x, yBase, z, height, group) { if (height < 0.5) return; const pillarRadiusBottom = 1; const pillarRadiusTop = 1.2; const pillarGeo = new THREE.CylinderGeometry(pillarRadiusTop, pillarRadiusBottom, height, 12); const pillar = new THREE.Mesh(pillarGeo, pillarMaterial); pillar.position.set(x, yBase + height / 2, z); pillar.castShadow = true; group.add(pillar); }
    
    // Create a static road group instead of moving road
    const staticRoadGroup = new THREE.Group();
    scene.add(staticRoadGroup);
    const restaurantGroup = new THREE.Group();



// --- Create Custom Infinity Sign Track ---
const roadGroup = new THREE.Group();

// Define the track parameters
const trackWidth = 40;
const trackScale = 10;
const trackRadius = 15;
const roadY = 0.11;

// Calculate the path for an infinity sign
const trackPath = [];
const numSegments = 200;

// Parametric equation for an infinity symbol
for (let i = 0; i <= numSegments; i++) {
const t = (i / numSegments) * 2 * Math.PI;
const sinT = Math.sin(t);
const cosT = Math.cos(t);
const scaleFactor = trackScale / (1 + cosT * cosT);
const x = scaleFactor * sinT * trackRadius;
const z = scaleFactor * sinT * cosT * trackRadius;
trackPath.push(new THREE.Vector3(x, roadY, z));
}

// Create the track curve for animation
const trackCurve = new THREE.CatmullRomCurve3(trackPath, true, 'centripetal');
trackCurve.closed = true;

// Generate the visual track
const trackEdgePoints = [];
const numPathPoints = 500;
const trackOuterPoints = [];
const trackInnerPoints = [];

for (let i = 0; i < numPathPoints; i++) {
const t = i / numPathPoints;
const point = trackCurve.getPointAt(t);
const tangent = trackCurve.getTangentAt(t).normalize();
const normal = new THREE.Vector3(0, 1, 0);
const binormal = new THREE.Vector3().crossVectors(tangent, normal).normalize();

const halfWidth = trackWidth / 2;
const innerPoint = point.clone().addScaledVector(binormal, -halfWidth);
const outerPoint = point.clone().addScaledVector(binormal, halfWidth);

trackInnerPoints.push(innerPoint);
trackOuterPoints.push(outerPoint);

if (i > 0) {
    trackEdgePoints.push(trackOuterPoints[i - 1], trackOuterPoints[i]);
    trackEdgePoints.push(trackInnerPoints[i - 1], trackInnerPoints[i]);
}
}

// Close the loop
trackEdgePoints.push(trackOuterPoints[numPathPoints - 1], trackOuterPoints[0]);
trackEdgePoints.push(trackInnerPoints[numPathPoints - 1], trackInnerPoints[0]);

// Create edge geometry
const trackEdgeGeometry = new THREE.BufferGeometry().setFromPoints(trackEdgePoints);
const trackEdges = new THREE.LineSegments(trackEdgeGeometry, roadEdgeMaterial);
roadGroup.add(trackEdges);

// Create the center lane line (dashed)
const lanePoints = [];
const dashLength = 2;
const gapLength = 3;
let accumulatedLength = 0;
let isDrawing = true;

for (let i = 0; i < numPathPoints; i++) {
const t = i / numPathPoints;
const point = trackCurve.getPointAt(t);

if (i > 0) {
    const prevPoint = trackCurve.getPointAt((i-1) / numPathPoints);
    const segmentLength = point.distanceTo(prevPoint);
    accumulatedLength += segmentLength;

    if (isDrawing && accumulatedLength > dashLength) {
        lanePoints.push(prevPoint, point);
        isDrawing = false;
        accumulatedLength = 0;
    } else if (!isDrawing && accumulatedLength > gapLength) {
        isDrawing = true;
        accumulatedLength = 0;
    }
}
}

const laneGeometry = new THREE.BufferGeometry().setFromPoints(lanePoints);
const laneLine = new THREE.LineSegments(laneGeometry, laneMaterial);
roadGroup.add(laneLine);

// Create the road surface
const roadSurfaceShape = new THREE.Shape();

roadSurfaceShape.moveTo(trackOuterPoints[0].x, trackOuterPoints[0].z);

for (let i = 1; i < trackOuterPoints.length; i++) {
roadSurfaceShape.lineTo(trackOuterPoints[i].x, trackOuterPoints[i].z);
}
roadSurfaceShape.lineTo(trackOuterPoints[0].x, trackOuterPoints[0].z);

const holePath = new THREE.Path();
holePath.moveTo(trackInnerPoints[0].x, trackInnerPoints[0].z);
for (let i = trackInnerPoints.length - 1; i > 0; i--) {
holePath.lineTo(trackInnerPoints[i].x, trackInnerPoints[i].z);
}
holePath.lineTo(trackInnerPoints[0].x, trackInnerPoints[0].z);
roadSurfaceShape.holes.push(holePath);

const roadSurfaceGeometry = new THREE.ShapeGeometry(roadSurfaceShape);
const roadSurface = new THREE.Mesh(roadSurfaceGeometry, singleRoadSurfaceMaterial);
roadSurface.rotation.x = -Math.PI / 2;
roadSurface.position.y = roadY - 0.002;

staticRoadGroup.add(roadGroup);

// --- Bus Animation Logic ---
let t = 0;
const speed = 0.9; // Adjust speed as needed
let previousMatrix = new THREE.Matrix4(); // Track previous orientation
previousMatrix.identity(); // Initialize as identity matrix

function animateBus() {
// Increment t for smooth movement
t = (t + speed) % 1;

// Get position and tangent
const position = trackCurve.getPointAt(t);
const tangent = trackCurve.getTangentAt(t).normalize();

// Update bus position
// bus.position.copy(position);

// Compute Frenet-Serret frame for consistent orientation
const up = new THREE.Vector3(0, 1, 0);
let normal = new THREE.Vector3().crossVectors(tangent, up).normalize();
if (normal.lengthSq() < 0.0001) {
    // Handle case where tangent is parallel to up
    normal.set(1, 0, 0);
}
const binormal = new THREE.Vector3().crossVectors(tangent, normal).normalize();
normal = new THREE.Vector3().crossVectors(binormal, tangent).normalize();

// Create orientation matrix
const matrix = new THREE.Matrix4();
matrix.makeBasis(normal, binormal, tangent);

// Smooth orientation by interpolating with previous matrix
const prevQuat = new THREE.Quaternion().setFromRotationMatrix(previousMatrix);
const newQuat = new THREE.Quaternion().setFromRotationMatrix(matrix);
newQuat.slerp(prevQuat, 0.9); // Interpolate to prevent sudden flips

// Apply smoothed orientation to bus
// bus.quaternion.copy(newQuat);

// Update previous matrix
previousMatrix.makeRotationFromQuaternion(newQuat);

// Continue animation
requestAnimationFrame(animateBus);
}

// Start animation
animateBus();

    // --- Bus Geometry Construction (unchanged - kept for brevity) ---
    // [Your existing bus geometry generation code remains here]
    // ... (Assume all the addLine, addRectangle, etc. calls for the bus are here) ...
    const bottomFrontCornerX = -halfL; const bottomFrontCornerY = floorY + 0.1; const topFrontCornerX = -halfL; const topFrontCornerY = roofY * 0.75; const topFrontPeakX = -halfL * 0.15; const topFrontPeakY = roofY; const topRearCornerX = halfL * 0.98; const topRearCornerY = roofY * 0.90; const bottomRearCornerX = halfL; const bottomRearCornerY = floorY;
    for (let side = 0; side < 2; side++) { const z = (side === 0) ? halfW : -halfW; const zSign = (side === 0) ? 1 : -1; const bottomFront = new THREE.Vector3(bottomFrontCornerX * 0.95, bottomFrontCornerY, z); const bottomRear = new THREE.Vector3(bottomRearCornerX, bottomRearCornerY, z); const topRear = new THREE.Vector3(topRearCornerX, topRearCornerY, z); const topFrontUpper = new THREE.Vector3(topFrontPeakX, topFrontPeakY, z); const topFrontLower = new THREE.Vector3(topFrontCornerX, topFrontCornerY, z); const roofCurve = new THREE.CatmullRomCurve3([ topRear, topFrontUpper ]); addCurvePoints(roofCurve, 30, allLinePoints); const frontTopCurve = new THREE.CatmullRomCurve3([ topFrontUpper, new THREE.Vector3(-halfL * 0.93, roofY * 0.9, z), topFrontLower ]); addCurvePoints(frontTopCurve, 10, allLinePoints); const frontPillarCurve = new THREE.CatmullRomCurve3([ topFrontLower, new THREE.Vector3(-halfL * 1.02, floorY + 0.5, z), bottomFront ]); addCurvePoints(frontPillarCurve, 8, allLinePoints); const wheelArchRadius = wheelRadius + 0.1; const frontArchStartX = frontAxleX - wheelArchRadius; const frontArchEndX = frontAxleX + wheelArchRadius; const rearArch1StartX = rearAxle1X - wheelArchRadius; const rearArch1EndX = rearAxle1X + wheelArchRadius; const rearArch2StartX = rearAxle2X - wheelArchRadius; const rearArch2EndX = rearAxle2X + wheelArchRadius; allLinePoints.push(bottomFront, new THREE.Vector3(frontArchStartX, floorY, z)); allLinePoints.push(new THREE.Vector3(frontArchEndX, floorY, z), new THREE.Vector3(rearArch1StartX, floorY, z)); if (rearArch1EndX < rearArch2StartX) { allLinePoints.push(new THREE.Vector3(rearArch1EndX, floorY, z), new THREE.Vector3(rearArch2StartX, floorY, z)); } allLinePoints.push(new THREE.Vector3(rearArch2EndX, floorY, z), bottomRear); allLinePoints.push(bottomRear, topRear); const windowTopY = roofY * 0.88; const windowBottomY = floorY + 1.3; const windowRearX = halfL * 0.9; const windowFrontX = topFrontCornerX + 0.2; addRectangle(windowFrontX, windowBottomY, windowRearX, windowTopY, z, allLinePoints); const compartmentBottomY = floorY - 0.05; const compartmentTopY = floorY + 0.6; addRectangle(frontArchEndX + 0.1, compartmentBottomY, rearArch1StartX - 0.1, compartmentTopY, z, allLinePoints); if (rearArch1EndX < rearArch2StartX) { addRectangle(rearArch1EndX + 0.1, compartmentBottomY, rearArch2StartX - 0.1, compartmentTopY, z, allLinePoints); } addRectangle(rearArch2EndX + 0.1, compartmentBottomY, halfL * 0.95, compartmentTopY, z, allLinePoints); if (side === 1) { const doorWidth = 0.9; const doorFrontX = frontArchEndX + 0.1; const doorRearX = doorFrontX + doorWidth; const doorTopY = windowBottomY - 0.05; const doorBottomY = floorY; addRectangle(doorFrontX, doorBottomY, doorRearX, doorTopY, z, allLinePoints); detailLinePoints.push(new THREE.Vector3(doorRearX - 0.15, (doorTopY+doorBottomY)/2, z)); detailLinePoints.push(new THREE.Vector3(doorRearX - 0.05, (doorTopY+doorBottomY)/2, z)); } const headlightSideY = floorY + 0.4; const taillightSideY = floorY + 0.6; allLinePoints.push(new THREE.Vector3(bottomFrontCornerX * 0.98, headlightSideY - 0.1, z)); allLinePoints.push(new THREE.Vector3(bottomFrontCornerX * 0.98, headlightSideY + 0.1, z)); allLinePoints.push(new THREE.Vector3(bottomRearCornerX * 0.98, taillightSideY - 0.1, z)); allLinePoints.push(new THREE.Vector3(bottomRearCornerX * 0.98, taillightSideY + 0.1, z)); const mirrorY = floorY + 1.7; const mirrorBaseX = topFrontCornerX + 0.1; const mirrorBaseZ = zSign * (halfW + 0.05); const mirrorOuterX = mirrorBaseX - 0.15; const mirrorOuterZ = zSign * (halfW + 0.35); const mirrorTopY = mirrorY + 0.25; const mirrorBottomY = mirrorY - 0.25; const mirrorThickness = 0.05; allLinePoints.push(new THREE.Vector3(mirrorBaseX, mirrorY, mirrorBaseZ)); allLinePoints.push(new THREE.Vector3(mirrorBaseX, mirrorTopY + 0.1, mirrorBaseZ)); allLinePoints.push(new THREE.Vector3(mirrorBaseX, mirrorTopY + 0.1, mirrorBaseZ)); allLinePoints.push(new THREE.Vector3(mirrorOuterX, mirrorTopY, mirrorOuterZ)); allLinePoints.push(new THREE.Vector3(mirrorOuterX, mirrorTopY, mirrorOuterZ)); allLinePoints.push(new THREE.Vector3(mirrorOuterX, mirrorBottomY, mirrorOuterZ)); allLinePoints.push(new THREE.Vector3(mirrorOuterX, mirrorBottomY, mirrorOuterZ)); allLinePoints.push(new THREE.Vector3(mirrorBaseX, mirrorBottomY - 0.1, mirrorBaseZ)); allLinePoints.push(new THREE.Vector3(mirrorBaseX, mirrorBottomY - 0.1, mirrorBaseZ)); allLinePoints.push(new THREE.Vector3(mirrorBaseX, mirrorY, mirrorBaseZ)); addRectangleYZ(mirrorOuterX - mirrorThickness/2, mirrorBottomY, mirrorOuterZ, mirrorTopY, mirrorOuterZ, allLinePoints); addRectangleYZ(mirrorOuterX + mirrorThickness/2, mirrorBottomY, mirrorOuterZ, mirrorTopY, mirrorOuterZ, allLinePoints); allLinePoints.push(new THREE.Vector3(mirrorOuterX - mirrorThickness/2, mirrorTopY, mirrorOuterZ)); allLinePoints.push(new THREE.Vector3(mirrorOuterX + mirrorThickness/2, mirrorTopY, mirrorOuterZ)); allLinePoints.push(new THREE.Vector3(mirrorOuterX - mirrorThickness/2, mirrorBottomY, mirrorOuterZ)); allLinePoints.push(new THREE.Vector3(mirrorOuterX + mirrorThickness/2, mirrorBottomY, mirrorOuterZ)); const glassX = mirrorOuterX - mirrorThickness / 2 - 0.01; addRectangleYZ(glassX, mirrorBottomY + 0.02, mirrorOuterZ, mirrorTopY - 0.02, mirrorOuterZ, detailLinePoints); }
    allLinePoints.push(new THREE.Vector3(topFrontCornerX, topFrontCornerY, halfW)); allLinePoints.push(new THREE.Vector3(topFrontCornerX, topFrontCornerY, -halfW)); allLinePoints.push(new THREE.Vector3(bottomFrontCornerX*0.95, bottomFrontCornerY, halfW)); allLinePoints.push(new THREE.Vector3(bottomFrontCornerX*0.95, bottomFrontCornerY, -halfW)); allLinePoints.push(new THREE.Vector3(topRearCornerX, topRearCornerY, halfW)); allLinePoints.push(new THREE.Vector3(topRearCornerX, topRearCornerY, -halfW)); allLinePoints.push(new THREE.Vector3(bottomRearCornerX, bottomRearCornerY, halfW)); allLinePoints.push(new THREE.Vector3(bottomRearCornerX, bottomRearCornerY, -halfW)); allLinePoints.push(new THREE.Vector3(topFrontPeakX, topFrontPeakY, halfW)); allLinePoints.push(new THREE.Vector3(topFrontPeakX, topFrontPeakY, -halfW));
    const frontFaceX = bottomFrontCornerX; const frontBumperBottomY = floorY - 0.15; const frontBumperTopY = floorY + 0.15; const frontBumperWidth = halfW * 1.05; addRectangleYZ(frontFaceX, frontBumperBottomY, -frontBumperWidth, frontBumperTopY, frontBumperWidth, allLinePoints); allLinePoints.push(new THREE.Vector3(frontFaceX, frontBumperTopY, frontBumperWidth)); allLinePoints.push(new THREE.Vector3(bottomFrontCornerX*0.95, bottomFrontCornerY, halfW)); allLinePoints.push(new THREE.Vector3(frontFaceX, frontBumperTopY, -frontBumperWidth)); allLinePoints.push(new THREE.Vector3(bottomFrontCornerX*0.95, bottomFrontCornerY, -halfW)); allLinePoints.push(new THREE.Vector3(frontFaceX, frontBumperBottomY, frontBumperWidth)); allLinePoints.push(new THREE.Vector3(bottomFrontCornerX*0.95, floorY, halfW)); allLinePoints.push(new THREE.Vector3(frontFaceX, frontBumperBottomY, -frontBumperWidth)); allLinePoints.push(new THREE.Vector3(bottomFrontCornerX*0.95, floorY, -halfW)); const lipY = frontBumperBottomY - 0.05; const lipX = frontFaceX + 0.05; const lipWidth = frontBumperWidth * 0.9; addRectangleYZ(lipX, lipY, -lipWidth, frontBumperBottomY, lipWidth, detailLinePoints); detailLinePoints.push(new THREE.Vector3(lipX, frontBumperBottomY, lipWidth)); detailLinePoints.push(new THREE.Vector3(frontFaceX, frontBumperBottomY, frontBumperWidth)); detailLinePoints.push(new THREE.Vector3(lipX, frontBumperBottomY, -lipWidth)); detailLinePoints.push(new THREE.Vector3(frontFaceX, frontBumperBottomY, -frontBumperWidth)); detailLinePoints.push(new THREE.Vector3(lipX, lipY, lipWidth)); detailLinePoints.push(new THREE.Vector3(frontFaceX, frontBumperBottomY, frontBumperWidth)); detailLinePoints.push(new THREE.Vector3(lipX, lipY, -lipWidth)); detailLinePoints.push(new THREE.Vector3(frontFaceX, frontBumperBottomY, -frontBumperWidth)); const fogLightY = frontBumperBottomY + 0.1; const fogLightZ = halfW * 0.6; addCircleOutlineYZ(frontFaceX - 0.01, fogLightY, fogLightZ, 0.08, 0.08, 12, detailLinePoints); addCircleOutlineYZ(frontFaceX - 0.01, fogLightY, -fogLightZ, 0.08, 0.08, 12, detailLinePoints); const towHookY = frontBumperBottomY + 0.05; const towHookZ = halfW * 0.3; addRectangleYZ(frontFaceX - 0.01, towHookY, towHookZ - 0.05, towHookY + 0.05, towHookZ + 0.05, detailLinePoints); addRectangleYZ(frontFaceX - 0.01, towHookY, -towHookZ - 0.05, towHookY + 0.05, -towHookZ + 0.05, detailLinePoints); const grilleBottomY = frontBumperTopY + 0.05; const grilleTopY = floorY + 0.8; const grilleWidth = halfW * 0.8; const grilleX = frontFaceX - 0.02; addRectangleYZ(grilleX, grilleBottomY, -grilleWidth, grilleTopY, grilleWidth, allLinePoints); addGridYZ(grilleX - 0.01, grilleBottomY, -grilleWidth, grilleTopY, grilleWidth, 5, 10, detailLinePoints); const emblemY = (grilleBottomY + grilleTopY) / 2; addCircleOutlineYZ(grilleX - 0.02, emblemY, 0, 0.15, 0.15, 16, allLinePoints); addCircleOutlineYZ(grilleX - 0.03, emblemY, 0, 0.10, 0.10, 12, detailLinePoints); const headlightY = floorY + 0.5; const headlightZ = halfW * 0.7; const headlightOuterRadius = 0.25; const headlightInnerRadius = 0.18; const indicatorWidth = 0.15; const indicatorHeight = 0.1; const indicatorY = headlightY; const indicatorZ = headlightZ + headlightOuterRadius + 0.05; addCircleOutlineYZ(frontFaceX - 0.01, headlightY, headlightZ, headlightOuterRadius, headlightOuterRadius * 0.8, 16, allLinePoints); addCircleOutlineYZ(frontFaceX - 0.01, headlightY, -headlightZ, headlightOuterRadius, headlightOuterRadius * 0.8, 16, allLinePoints); addCircleOutlineYZ(frontFaceX - 0.02, headlightY, headlightZ, headlightInnerRadius, headlightInnerRadius * 0.8, 12, detailLinePoints); addCircleOutlineYZ(frontFaceX - 0.02, headlightY, -headlightZ, headlightInnerRadius, headlightInnerRadius * 0.8, 12, detailLinePoints); addRectangleYZ(frontFaceX - 0.01, indicatorY - indicatorHeight/2, indicatorZ, indicatorY + indicatorHeight/2, indicatorZ + indicatorWidth, allLinePoints); addRectangleYZ(frontFaceX - 0.01, indicatorY - indicatorHeight/2, -indicatorZ, indicatorY + indicatorHeight/2, -indicatorZ - indicatorWidth, allLinePoints); addRectangleYZ(frontFaceX - 0.02, indicatorY - indicatorHeight/2 + 0.01, indicatorZ + 0.01, indicatorY + indicatorHeight/2 - 0.01, indicatorZ + indicatorWidth - 0.01, detailLinePoints); addRectangleYZ(frontFaceX - 0.02, indicatorY - indicatorHeight/2 + 0.01, -indicatorZ - 0.01, indicatorY + indicatorHeight/2 - 0.01, -indicatorZ - indicatorWidth + 0.01, detailLinePoints); const windshieldBottomY = grilleTopY + 0.1; const windshieldTopY = topFrontCornerY; const windshieldBottomWidth = halfW * 0.95; const windshieldTopWidth = halfW * 0.85; const windshieldX = topFrontCornerX; allLinePoints.push(new THREE.Vector3(windshieldX, windshieldBottomY, windshieldBottomWidth)); allLinePoints.push(new THREE.Vector3(windshieldX, windshieldTopY, windshieldTopWidth)); allLinePoints.push(new THREE.Vector3(windshieldX, windshieldTopY, -windshieldTopWidth)); allLinePoints.push(new THREE.Vector3(windshieldX, windshieldBottomY, -windshieldBottomWidth)); allLinePoints.push(new THREE.Vector3(windshieldX, windshieldBottomY, -windshieldBottomWidth)); allLinePoints.push(new THREE.Vector3(windshieldX, windshieldBottomY, windshieldBottomWidth)); const inset = 0.04; detailLinePoints.push(new THREE.Vector3(windshieldX - 0.01, windshieldBottomY + inset, windshieldBottomWidth - inset)); detailLinePoints.push(new THREE.Vector3(windshieldX - 0.01, windshieldTopY - inset, windshieldTopWidth - inset)); detailLinePoints.push(new THREE.Vector3(windshieldX - 0.01, windshieldTopY - inset, -windshieldTopWidth + inset)); detailLinePoints.push(new THREE.Vector3(windshieldX - 0.01, windshieldBottomY + inset, -windshieldBottomWidth + inset)); detailLinePoints.push(new THREE.Vector3(windshieldX - 0.01, windshieldBottomY + inset, -windshieldBottomWidth + inset)); detailLinePoints.push(new THREE.Vector3(windshieldX - 0.01, windshieldBottomY + inset, windshieldBottomWidth - inset)); detailLinePoints.push(new THREE.Vector3(windshieldX - 0.01, windshieldBottomY + inset, 0)); detailLinePoints.push(new THREE.Vector3(windshieldX - 0.01, windshieldTopY - inset, 0)); const wiperBaseY = windshieldBottomY + 0.05; const wiperPivotZ = halfW * 0.4; const wiperLength = 0.8; const wiperAngle = Math.PI * 0.8; const wiperThickness = 0.03; const wiperRXEnd = windshieldX - 0.02; const wiperRYEnd = wiperBaseY + wiperLength * Math.sin(wiperAngle); const wiperRZEnd = -wiperPivotZ + wiperLength * Math.cos(wiperAngle); allLinePoints.push(new THREE.Vector3(windshieldX - 0.02, wiperBaseY, -wiperPivotZ)); allLinePoints.push(new THREE.Vector3(wiperRXEnd, wiperRYEnd, wiperRZEnd)); detailLinePoints.push(new THREE.Vector3(wiperRXEnd, wiperRYEnd - wiperThickness/2, wiperRZEnd)); detailLinePoints.push(new THREE.Vector3(wiperRXEnd, wiperRYEnd + wiperThickness/2, wiperRZEnd)); const wiperLXEnd = windshieldX - 0.02; const wiperLYEnd = wiperBaseY + wiperLength * Math.sin(Math.PI - wiperAngle); const wiperLZEnd = wiperPivotZ + wiperLength * Math.cos(Math.PI - wiperAngle); allLinePoints.push(new THREE.Vector3(windshieldX - 0.02, wiperBaseY, wiperPivotZ)); allLinePoints.push(new THREE.Vector3(wiperLXEnd, wiperLYEnd, wiperLZEnd)); detailLinePoints.push(new THREE.Vector3(wiperLXEnd, wiperLYEnd - wiperThickness/2, wiperLZEnd)); detailLinePoints.push(new THREE.Vector3(wiperLXEnd, wiperLYEnd + wiperThickness/2, wiperLZEnd)); const markerLightY = topFrontPeakY - 0.05; const markerLightX = topFrontPeakX - 0.1; const markerLightZPositions = [-halfW * 0.7, -halfW * 0.3, halfW * 0.3, halfW * 0.7]; markerLightZPositions.forEach(zPos => { addCircleOutlineYZ(markerLightX, markerLightY, zPos, 0.05, 0.05, 8, detailLinePoints); }); const plateY = frontBumperTopY - 0.05; const plateHeight = 0.15; const plateWidth = 0.3; addRectangleYZ(frontFaceX - 0.01, plateY - plateHeight/2, -plateWidth/2, plateY + plateHeight/2, plateWidth/2, detailLinePoints);
    const acWidth = halfW * 0.7; const acLength = busLength * 0.3; const acHeight = 0.25; const acY = topFrontPeakY + 0.02; const acXStart = -acLength / 2; const acXEnd = acLength / 2; addRectangle(acXStart, acY, acXEnd, acY + acHeight, acWidth, allLinePoints); addRectangle(acXStart, acY, acXEnd, acY + acHeight, -acWidth, allLinePoints); allLinePoints.push(new THREE.Vector3(acXStart, acY + acHeight, acWidth)); allLinePoints.push(new THREE.Vector3(acXStart, acY + acHeight, -acWidth)); allLinePoints.push(new THREE.Vector3(acXEnd, acY + acHeight, acWidth)); allLinePoints.push(new THREE.Vector3(acXEnd, acY + acHeight, -acWidth)); allLinePoints.push(new THREE.Vector3(acXStart, acY, acWidth)); allLinePoints.push(new THREE.Vector3(acXStart, acY, -acWidth)); allLinePoints.push(new THREE.Vector3(acXEnd, acY, acWidth)); allLinePoints.push(new THREE.Vector3(acXEnd, acY, -acWidth)); addCircleOutline((acXStart+acXEnd)/2, acY + acHeight, 0, 0.15, 0.15, 12, 0, detailLinePoints);
    const rearFaceX = bottomRearCornerX; const rearWindowTopY = roofY * 0.9; const rearWindowBottomY = floorY + 1.5; addRectangleYZ(rearFaceX, rearWindowBottomY, -halfW * 0.7, rearWindowTopY, halfW * 0.7, allLinePoints); addRectangleYZ(rearFaceX, floorY - 0.1, -halfW*0.9, floorY + 0.1, halfW*0.9, allLinePoints); addRectangleYZ(rearFaceX-0.01, floorY + 0.5, halfW*0.7, floorY + 0.8, halfW*0.9, allLinePoints); addRectangleYZ(rearFaceX-0.01, floorY + 0.5, -halfW*0.7, floorY + 0.8, -halfW*0.9, allLinePoints);
    const busLineGeometry = new THREE.BufferGeometry().setFromPoints(allLinePoints);
     const busLines = new THREE.LineSegments(busLineGeometry, lineMaterial); busGroup.add(busLines);
      const detailLineGeometry = new THREE.BufferGeometry().setFromPoints(detailLinePoints); const detailLines = new THREE.LineSegments(detailLineGeometry, detailLineMaterial); busGroup.add(detailLines);
    const wheelGeo = new THREE.TorusGeometry(wheelRadius, wheelWidth * 0.4, 8, 24); const wheelY = wheelRadius + floorY*0.5;
    const wheelsData = [ { x: frontAxleX, z: halfW + wheelWidth/2 }, { x: frontAxleX, z: -(halfW + wheelWidth/2) }, { x: rearAxle1X, z: halfW + wheelWidth/2 }, { x: rearAxle1X, z: -(halfW + wheelWidth/2) }, { x: rearAxle2X, z: halfW + wheelWidth/2 }, { x: rearAxle2X, z: -(halfW + wheelWidth/2) } ];
    wheelsData.forEach(wPos => { const wheel = new THREE.Mesh(wheelGeo, wheelMaterial); wheel.position.set(wPos.x, wheelY, wPos.z); busGroup.add(wheel); const hubGeo = new THREE.CircleGeometry(wheelRadius * 0.9, 16); const hub = new THREE.Mesh(hubGeo, wheelMaterial); hub.position.set(wPos.x, wheelY, wPos.z); busGroup.add(hub); for (let i = 0; i < 6; i++) { const angle = i * Math.PI / 3; const spokeLength = wheelRadius * 0.7; const startPoint = new THREE.Vector3( wPos.x, wheelRadius + floorY*0.5 + wheelRadius * 0.3 * Math.sin(angle), wPos.z + wheelRadius * 0.3 * Math.cos(angle) ); const endPoint = new THREE.Vector3( wPos.x, wheelRadius + floorY*0.5 + spokeLength * Math.sin(angle), wPos.z + spokeLength * Math.cos(angle) ); const spokePoints = []; spokePoints.push(startPoint, endPoint); const spokeGeometry = new THREE.BufferGeometry().setFromPoints(spokePoints); const spoke = new THREE.LineSegments(spokeGeometry, lineMaterial); busGroup.add(spoke); } addCircleOutline(wPos.x, wheelY, wPos.z + (wPos.z > 0 ? wheelWidth*0.4 : -wheelWidth*0.4), wheelRadius * 0.4, wheelRadius * 0.4, 12, 0, detailLinePoints); addCircleOutline(wPos.x, wheelY, wPos.z + (wPos.z > 0 ? -wheelWidth*0.4 : wheelWidth*0.4), wheelRadius * 0.4, wheelRadius * 0.4, 12, 0, detailLinePoints); for (let i = 0; i < 5; i++) { const angle = i * (Math.PI * 2 / 5); const spokeEndX = wPos.x + wheelRadius * 0.8 * Math.cos(angle); const spokeEndY = wheelY + wheelRadius * 0.8 * Math.sin(angle); detailLinePoints.push(new THREE.Vector3(wPos.x, wheelY, wPos.z)); detailLinePoints.push(new THREE.Vector3(spokeEndX, spokeEndY, wPos.z)); } });
    const headlightGlowGeo = new THREE.SphereGeometry(0.05, 8, 8); const glowMaterial = new THREE.MeshBasicMaterial({ color: 0xFFFFFF, wireframe: false }); const glowOffset = 0.03; busGroup.add(new THREE.Mesh(headlightGlowGeo, glowMaterial).translateX(frontFaceX - glowOffset).translateY(headlightY).translateZ(headlightZ)); busGroup.add(new THREE.Mesh(headlightGlowGeo, glowMaterial).translateX(frontFaceX - glowOffset).translateY(headlightY).translateZ(-headlightZ));
    const cookingSurfaceGroup = new THREE.Group(); const cookingSurfaceWidth = 1.2; const cookingSurfaceLength = 1.2; const cookingSurfaceY = floorY + 1.5; const cookingSurfaceX = halfL * 0.3; const cookingSurfacePoints = []; addRectangle(cookingSurfaceX - cookingSurfaceLength/2, cookingSurfaceY, cookingSurfaceX + cookingSurfaceLength/2, cookingSurfaceY, cookingSurfaceWidth/2, cookingSurfacePoints); addRectangle(cookingSurfaceX - cookingSurfaceLength/2, cookingSurfaceY, cookingSurfaceX + cookingSurfaceLength/2, cookingSurfaceY, -cookingSurfaceWidth/2, cookingSurfacePoints); cookingSurfacePoints.push(new THREE.Vector3(cookingSurfaceX - cookingSurfaceLength/2, cookingSurfaceY, cookingSurfaceWidth/2)); cookingSurfacePoints.push(new THREE.Vector3(cookingSurfaceX - cookingSurfaceLength/2, cookingSurfaceY, -cookingSurfaceWidth/2)); cookingSurfacePoints.push(new THREE.Vector3(cookingSurfaceX + cookingSurfaceLength/2, cookingSurfaceY, cookingSurfaceWidth/2)); cookingSurfacePoints.push(new THREE.Vector3(cookingSurfaceX + cookingSurfaceLength/2, cookingSurfaceY, -cookingSurfaceWidth/2)); addCircleOutline(cookingSurfaceX - cookingSurfaceLength/4, cookingSurfaceY, 0, 0.2, 0.2, 16, 0, cookingSurfacePoints); addCircleOutline(cookingSurfaceX + cookingSurfaceLength/4, cookingSurfaceY, 0, 0.2, 0.2, 16, 0, cookingSurfacePoints); const cookingSurfaceGeometry = new THREE.BufferGeometry().setFromPoints(cookingSurfacePoints); const cookingSurface = new THREE.LineSegments(cookingSurfaceGeometry, cookingSurfaceMaterial); cookingSurfaceGroup.add(cookingSurface); busGroup.add(cookingSurfaceGroup);
    function createFoodItem(x, y, z, size) { const foodPoints = []; addCircleOutline(x, y, z, size, size * 0.8, 12, 0, foodPoints); const foodGeometry = new THREE.BufferGeometry().setFromPoints(foodPoints); return new THREE.LineSegments(foodGeometry, foodMaterial); }
    const foodItems = [ createFoodItem(cookingSurfaceX - 0.3, cookingSurfaceY + 0.02, 0, 0.15), createFoodItem(cookingSurfaceX + 0.3, cookingSurfaceY + 0.02, 0, 0.12), ]; const foodItemsGroup = new THREE.Group(); foodItems.forEach(food => { foodItemsGroup.add(food); }); busGroup.add(foodItemsGroup);
    function createRoboticArm(isLeft) { const armGroup = new THREE.Group(); const armColor = 0x666677; const jointColor = 0xADD8E6; const toolColor = 0xDDDDDD; const baseColor = 0x444455; const armMat = new THREE.MeshBasicMaterial({ color: armColor, wireframe: true, }); const jointMat = new THREE.MeshBasicMaterial({ color: jointColor, wireframe: true, }); const toolMat = new THREE.MeshBasicMaterial({ color: toolColor, wireframe: true, }); const baseMat = new THREE.MeshBasicMaterial({ color: baseColor, wireframe: true, }); const baseX = isLeft ? 0.000 : 2.700; const baseY = 0.900; const baseZ = 0; const basePlateGeo = new THREE.CylinderGeometry(0.5, 0.5, 0.1, 16); const basePlateMesh = new THREE.Mesh(basePlateGeo, baseMat); basePlateMesh.position.set(baseX, baseY + 0.05, 0); armGroup.add(basePlateMesh); const baseColumnGeo = new THREE.CylinderGeometry(0.3, 0.35, 0.6, 12); const baseColumnMesh = new THREE.Mesh(baseColumnGeo, armMat); baseColumnMesh.position.set(baseX, baseY + 0.1 + 0.3, 0); armGroup.add(baseColumnMesh); const platformGroup = new THREE.Group(); platformGroup.position.set(baseX, baseY + 0.1 + 0.6, 0); armGroup.add(platformGroup); const platformDiskGeo = new THREE.CylinderGeometry(0.38, 0.38, 0.15, 16); const platformDiskMesh = new THREE.Mesh(platformDiskGeo, baseMat); platformDiskMesh.position.y = 0.075; platformGroup.add(platformDiskMesh); const shoulderMountGeo = new THREE.BoxGeometry(0.3, 0.3, 0.4); const shoulderMountMesh = new THREE.Mesh(shoulderMountGeo, armMat); shoulderMountMesh.position.y = 0.15 + 0.15; platformGroup.add(shoulderMountMesh); const shoulderPivotGeo = new THREE.CylinderGeometry(0.18, 0.18, 0.5, 12); const shoulderPivotMesh = new THREE.Mesh(shoulderPivotGeo, jointMat); shoulderPivotMesh.position.y = shoulderMountMesh.position.y; shoulderPivotMesh.rotation.z = Math.PI / 2; platformGroup.add(shoulderPivotMesh); const upperArmGroup = new THREE.Group(); upperArmGroup.position.copy(shoulderPivotMesh.position); platformGroup.add(upperArmGroup); const upperArmLength = 1.5; const upperArmCoreGeo = new THREE.BoxGeometry(0.2, upperArmLength, 0.2); upperArmCoreGeo.translate(0, upperArmLength / 2, 0); const upperArmCoreMesh = new THREE.Mesh(upperArmCoreGeo, armMat); upperArmGroup.add(upperArmCoreMesh); const upperArmPlateGeo = new THREE.BoxGeometry(0.05, upperArmLength * 0.8, 0.25); const upperArmPlate1 = new THREE.Mesh(upperArmPlateGeo, armMat); upperArmPlate1.position.set(0.125, upperArmLength / 2, 0); upperArmGroup.add(upperArmPlate1); const upperArmPlate2 = upperArmPlate1.clone(); upperArmPlate2.position.x = -0.125; upperArmGroup.add(upperArmPlate2); const elbowJointGroup = new THREE.Group(); elbowJointGroup.position.y = upperArmLength; upperArmGroup.add(elbowJointGroup); const elbowConnectorGeo = new THREE.BoxGeometry(0.25, 0.25, 0.3); const elbowConnectorMesh = new THREE.Mesh(elbowConnectorGeo, armMat); elbowJointGroup.add(elbowConnectorMesh); const elbowPivotGeo = new THREE.CylinderGeometry(0.15, 0.15, 0.4, 10); const elbowPivotMesh = new THREE.Mesh(elbowPivotGeo, jointMat); elbowPivotMesh.rotation.z = Math.PI / 2; elbowJointGroup.add(elbowPivotMesh); const forearmGroup = new THREE.Group(); elbowJointGroup.add(forearmGroup); const forearmLength = 1.2; const forearmCoreGeo = new THREE.BoxGeometry(0.15, forearmLength, 0.15); forearmCoreGeo.translate(0, forearmLength / 2, 0); const forearmCoreMesh = new THREE.Mesh(forearmCoreGeo, armMat); forearmGroup.add(forearmCoreMesh); const forearmDetailGeo = new THREE.BoxGeometry(0.2, forearmLength * 0.6, 0.2); const forearmDetailMesh = new THREE.Mesh(forearmDetailGeo, jointMat); forearmDetailMesh.position.y = forearmLength * 0.5; forearmGroup.add(forearmDetailMesh); const wristJointGroup = new THREE.Group(); wristJointGroup.position.y = forearmLength; forearmGroup.add(wristJointGroup); const wristHousingGeo = new THREE.CylinderGeometry(0.16, 0.16, 0.25, 12); const wristHousingMesh = new THREE.Mesh(wristHousingGeo, armMat); wristHousingMesh.position.y = 0.125; wristHousingMesh.rotation.x = Math.PI / 2; wristJointGroup.add(wristHousingMesh); const wristPivotGeo = new THREE.CylinderGeometry(0.1, 0.1, 0.3, 10); const wristPivotMesh = new THREE.Mesh(wristPivotGeo, jointMat); wristPivotMesh.position.y = 0.125; wristPivotMesh.rotation.x = Math.PI / 2; wristJointGroup.add(wristPivotMesh); const handGroup = new THREE.Group(); handGroup.position.y = 0.125; wristJointGroup.add(handGroup); const handMountGeo = new THREE.BoxGeometry(0.1, 0.15, 0.1); const handMountMesh = new THREE.Mesh(handMountGeo, jointMat); handMountMesh.position.y = 0.075; handGroup.add(handMountMesh); const toolHolder = new THREE.Group(); toolHolder.position.y = 0.15; handGroup.add(toolHolder); if (isLeft) { const handleGeo = new THREE.CylinderGeometry(0.04, 0.04, 0.3, 8); handleGeo.translate(0, 0.15, 0); const handleMesh = new THREE.Mesh(handleGeo, armMat); toolHolder.add(handleMesh); const bladeConnectorGeo = new THREE.BoxGeometry(0.06, 0.04, 0.04); const bladeConnectorMesh = new THREE.Mesh(bladeConnectorGeo, jointMat); bladeConnectorMesh.position.y = 0.3; toolHolder.add(bladeConnectorMesh); const bladeGeo = new THREE.BoxGeometry(0.35, 0.02, 0.25); const bladeMesh = new THREE.Mesh(bladeGeo, toolMat); bladeMesh.position.y = 0.3 + 0.02; bladeMesh.position.z = 0.1; toolHolder.add(bladeMesh); } else { const handleGeo = new THREE.CylinderGeometry(0.05, 0.04, 0.25, 8); handleGeo.translate(0, 0.125, 0); const handleMesh = new THREE.Mesh(handleGeo, armMat); toolHolder.add(handleMesh); const forkBaseGeo = new THREE.BoxGeometry(0.15, 0.05, 0.08); const forkBaseMesh = new THREE.Mesh(forkBaseGeo, jointMat); forkBaseMesh.position.y = 0.25; toolHolder.add(forkBaseMesh); const tineLength = 0.35; const tineGeo = new THREE.BoxGeometry(0.025, tineLength, 0.025); tineGeo.translate(0, tineLength / 2, 0); const tine1 = new THREE.Mesh(tineGeo, toolMat); tine1.position.set(-0.05, 0.25 + tineLength / 2, 0); toolHolder.add(tine1); const tine2 = new THREE.Mesh(tineGeo, toolMat); tine2.position.set(0.05, 0.25 + tineLength / 2, 0); toolHolder.add(tine2); } armGroup.userData = { platform: platformGroup, upperArm: upperArmGroup, forearm: forearmGroup, hand: handGroup, toolHolder: toolHolder }; return armGroup; }
    const leftRoboticArm = createRoboticArm(true); busGroup.add(leftRoboticArm); const rightRoboticArm = createRoboticArm(false); busGroup.add(rightRoboticArm); rightRoboticArm.userData.forearm.rotation.x = -Math.PI * 0.75; leftRoboticArm.userData.forearm.rotation.x = -Math.PI * 0.75;
    const steamParticles = new THREE.Group(); const steamMat = new THREE.MeshBasicMaterial({ color: 0xFFFFFF, wireframe: true, transparent: true, opacity: 0.6 }); for (let i = 0; i < 20; i++) { const size = 0.02 + Math.random() * 0.04; const steamGeo = new THREE.SphereGeometry(size, 4, 3); const particle = new THREE.Mesh(steamGeo, steamMat.clone()); const radius = 0.4 * Math.sqrt(Math.random()); const angle = Math.random() * Math.PI * 2; particle.position.set( cookingSurfaceX + radius * Math.cos(angle), cookingSurfaceY + 0.05 + Math.random() * 0.2, radius * Math.sin(angle) ); particle.userData = { originalY: particle.position.y, speed: 0.01 + Math.random() * 0.03, offset: Math.random() * 10 }; steamParticles.add(particle); } busGroup.add(steamParticles);
    busGroup.scale.set(6, 6, 6); // Changed from 2,2,2

    // --- Scroll Animation Parameters ---
    const cookingSurfaceTarget = new THREE.Vector3(cookingSurfaceX * busGroup.scale.x, (cookingSurfaceY + 0.5) * busGroup.scale.y, 0); // Adjusted for larger bus scale
    
    
    const scrollAnimationParams = {
currentScrollY: 0,
scrollPages: {
    straightRoad:   { start: 0,    end: 0.2,  dist: 80 }, // Fixed distance value
    zoomToBus:      { start: 0.2,  end: 0.35, dist: 40 }, // Fixed closer distance
    zoomToFunction: { start: 0.35, end: 0.5,  dist: 20 }, // Even closer
    panToJunction:  { start: 0.5,  end: 0.8,  dist: 120 }, // Pull back for junction view
    fullJunction:   { start: 0.7,  end: 0.98, dist: 300 }  // Wide view of junction
},
currentAnimationPage: 'straightRoad'
};
    // --- Junction Setup ---
    const junctionGroup = new THREE.Group(); scene.add(junctionGroup); junctionGroup.visible = false;
    const groundGroup = new THREE.Group(); const nsFlyoverGroup = new THREE.Group(); const ewFlyoverGroup = new THREE.Group(); const neFlyoverGroup = new THREE.Group(); const nwFlyoverGroup = new THREE.Group(); const seFlyoverGroup = new THREE.Group(); const swFlyoverGroup = new THREE.Group(); const nsUTurnGroup = new THREE.Group(); const ewUTurnGroup = new THREE.Group(); const pillarGroup = new THREE.Group(); // Specific group for pillars
    const junctionBusGroup = new THREE.Group();
    junctionGroup.add( groundGroup, nsFlyoverGroup, ewFlyoverGroup, neFlyoverGroup, nwFlyoverGroup, seFlyoverGroup, swFlyoverGroup, nsUTurnGroup, ewUTurnGroup, pillarGroup /* junctionBusGroup added later */ );

    // --- Junction Parameters ---
    const junctionRoadWidth = 30; const laneWidth = junctionRoadWidth / 4; const intersectionSize = junctionRoadWidth * 3; const junctionRoadLength = 300; // Reduced length slightly to fit view better
    const curbOffset = 0.15; const sidewalkWidth = 3; const cornerRadius = laneWidth * 300; const halfIntersection = intersectionSize / 2; const halfRoadWidth = junctionRoadWidth / 2;

    // *** Define 6 distinct and MUCH HIGHER flyover heights ***
    const h_ew_uturn = 30;      // Lowest U-Turn (Still significantly above ground)
    const h_ns_straight = 46;   // North-South Straight
    const h_ew_straight = 75;   // East-West Straight (clearly above NS)
    const h_ne_sw_turn = 98;    // NorthEast / SouthWest Turns
    const h_nw_se_turn = 110;    // NorthWest / SouthEast Turns
    const h_ns_uturn = 130;      // Highest U-Turn (Very high!)

    const flyoverWidth = 24; // Width of the flyover road surface
    const rampStartZ = 1000; // How far back the ramps start
    const flyoverLength = junctionRoadLength + rampStartZ;
    const pillarSpacing = 199; // Distance between pillars along the curve
    const guardrailHeight = 1.0;
    const turnRadius = 95; // Radius for turning flyovers

    // --- Junction Ground ---
    const groundSize = 1200; // Adjusted ground size
    const groundGeometry = new THREE.PlaneGeometry(groundSize, groundSize);
    const ground = new THREE.Mesh(groundGeometry, groundMaterial); // Use the basic material
    ground.rotation.x = -Math.PI / 2;
    // ground.receiveShadow = true; // Ground can receive shadows from pillars/flyovers
    groundGroup.add(ground);

    // --- Ground markings using lines (Unchanged) ---
    const roadEdgePoints = []; const whiteLinePoints = []; const yellowLinePoints = []; const curbPoints = [];
    function addGroundRoadSegment(axis, sign, length) { const y = 0.05; const startOffset = halfIntersection; const endOffset = startOffset + length; if (axis === 'z') { const z1 = sign * startOffset; const z2 = sign * endOffset; addLine(halfRoadWidth, y, z1, halfRoadWidth, y, z2, roadEdgePoints); addLine(-halfRoadWidth, y, z1, -halfRoadWidth, y, z2, roadEdgePoints); addLine(laneWidth, y, z1, laneWidth, y, z2, whiteLinePoints); addLine(-laneWidth, y, z1, -laneWidth, y, z2, whiteLinePoints); for (let i = 0; i < length; i += 8) { const dashStart = sign * (startOffset + i); const dashEnd = sign * (startOffset + i + 4); if (Math.abs(dashEnd) < Math.abs(endOffset)) { addLine(0, y, dashStart, 0, y, dashEnd, yellowLinePoints); } } addLine(-halfRoadWidth, y, z1 - sign*0.2, halfRoadWidth, y, z1 - sign*0.2, whiteLinePoints); const crossWalkZ = sign * (startOffset - 5); const crossWalkEndZ = crossWalkZ - sign * sidewalkWidth * 1.2; for(let i=-halfRoadWidth; i<=halfRoadWidth; i+= 1.5) { addLine(i, y, crossWalkZ, i, y, crossWalkEndZ, whiteLinePoints); } } else { const x1 = sign * startOffset; const x2 = sign * endOffset; addLine(x1, y, halfRoadWidth, x2, y, halfRoadWidth, roadEdgePoints); addLine(x1, y, -halfRoadWidth, x2, y, -halfRoadWidth, roadEdgePoints); addLine(x1, y, laneWidth, x2, y, laneWidth, whiteLinePoints); addLine(x1, y, -laneWidth, x2, y, -laneWidth, whiteLinePoints); for (let i = 0; i < length; i += 8) { const dashStart = sign * (startOffset + i); const dashEnd = sign * (startOffset + i + 4); if (Math.abs(dashEnd) < Math.abs(endOffset)) { addLine(dashStart, y, 0, dashEnd, y, 0, yellowLinePoints); } } addLine(x1 - sign*0.2, y, -halfRoadWidth, x1 - sign*0.2, y, halfRoadWidth, whiteLinePoints); const crossWalkX = sign * (startOffset - 5); const crossWalkEndX = crossWalkX - sign * sidewalkWidth * 1.2; for(let i=-halfRoadWidth; i<=halfRoadWidth; i+= 1.5) { addLine(crossWalkX, y, i, crossWalkEndX, y, i, whiteLinePoints); } } }
    const ie = halfIntersection; const re = halfRoadWidth; const iy = 0.05; addLine(re, iy, ie, ie, iy, re, roadEdgePoints); addLine(-re, iy, ie, -ie, iy, re, roadEdgePoints); addLine(-re, iy, -ie, -ie, iy, -re, roadEdgePoints); addLine(re, iy, -ie, ie, iy, -re, roadEdgePoints); addLine(ie, iy, re, ie, iy, -re, roadEdgePoints); addLine(-ie, iy, re, -ie, iy, -re, roadEdgePoints); addLine(re, iy, ie, -re, iy, ie, roadEdgePoints); addLine(re, iy, -ie, -re, iy, -ie, roadEdgePoints);
    addGroundRoadSegment('z', 1, junctionRoadLength); addGroundRoadSegment('z', -1, junctionRoadLength); addGroundRoadSegment('x', 1, junctionRoadLength); addGroundRoadSegment('x', -1, junctionRoadLength);
    const curbY = 0.1; const segs = 10; function addCornerCurb(centerX, centerZ, radius, startAngle, endAngle, segments) { const y = curbY; const points = []; for (let i = 0; i <= segments; i++) { const angle = startAngle + (endAngle - startAngle) * (i / segments); points.push(new THREE.Vector3( centerX + radius * Math.cos(angle), y, centerZ + radius * Math.sin(angle) )); } for (let i = 0; i < points.length - 1; i++) { curbPoints.push(points[i], points[i + 1]); } }
    const curbRad = halfRoadWidth + curbOffset; const sidewalkRad = curbRad + sidewalkWidth; addCornerCurb(halfIntersection, halfIntersection, curbRad, Math.PI * 1.0, Math.PI * 1.5, segs); addCornerCurb(-halfIntersection, halfIntersection, curbRad, Math.PI * 1.5, Math.PI * 2.0, segs); addCornerCurb(-halfIntersection, -halfIntersection, curbRad, Math.PI * 0.0, Math.PI * 0.5, segs); addCornerCurb(halfIntersection, -halfIntersection, curbRad, Math.PI * 0.5, Math.PI * 1.0, segs);
    const roadEdgeGeometry = new THREE.BufferGeometry().setFromPoints(roadEdgePoints); const roadEdgeLines = new THREE.LineSegments(roadEdgeGeometry, roadEdgeMaterial); groundGroup.add(roadEdgeLines);
    const whiteLineGeometry = new THREE.BufferGeometry().setFromPoints(whiteLinePoints); const whiteLines = new THREE.LineSegments(whiteLineGeometry, whiteLineMaterial); groundGroup.add(whiteLines);
    const yellowLineGeometry = new THREE.BufferGeometry().setFromPoints(yellowLinePoints); const yellowLines = new THREE.LineSegments(yellowLineGeometry, yellowLineMaterial); groundGroup.add(yellowLines);
    const curbGeometry = new THREE.BufferGeometry().setFromPoints(curbPoints); const curbLines = new THREE.LineSegments(curbGeometry, curbMaterial); groundGroup.add(curbLines);

    // --- Flyover Creation ---

    // *** MODIFIED Function to create solid flyover surfaces ***
    function createFlyoverSurface(curve, segments, width, material, group) {
        const points = curve.getPoints(segments);
        const vertices = [];
        const normals = [];
        const uvs = [];
        const indices = [];

        const halfWidth = width / 2;

        for (let i = 0; i < points.length; i++) {
            const t = i / (points.length - 1); // Parameter along the curve
            const p = points[i];
            const tangent = curve.getTangentAt(t).normalize();
            const normal = new THREE.Vector3(0, 1, 0); // Assuming flyover is mostly flat locally
            const binormal = new THREE.Vector3().crossVectors(tangent, normal).normalize(); // Points sideways

            const vLeft = p.clone().addScaledVector(binormal, -halfWidth);
            const vRight = p.clone().addScaledVector(binormal, halfWidth);

            vertices.push(vLeft.x, vLeft.y, vLeft.z);
            vertices.push(vRight.x, vRight.y, vRight.z);

            // Simple normals pointing up
            normals.push(0, 1, 0);
            normals.push(0, 1, 0);

            // Basic UVs
            uvs.push(0, t); // Left edge UV
            uvs.push(1, t); // Right edge UV
        }

        // Create indices for triangles
        for (let i = 0; i < points.length - 1; i++) {
            const i0 = i * 2;     // Current left
            const i1 = i0 + 1;    // Current right
            const i2 = i0 + 2;    // Next left
            const i3 = i0 + 3;    // Next right

            indices.push(i0, i1, i2); // Triangle 1
            indices.push(i1, i3, i2); // Triangle 2
        }

        const geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
        geometry.setAttribute('normal', new THREE.Float32BufferAttribute(normals, 3));
        geometry.setAttribute('uv', new THREE.Float32BufferAttribute(uvs, 2));
        geometry.setIndex(indices);

        const surface = new THREE.Mesh(geometry, material);
        surface.castShadow = true;
        surface.receiveShadow = true; // Flyover surface receives shadows
        group.add(surface);

        // Add lane markings on the surface (optional)
        const centerLinePoints = [];
        const dashLength = 5;
        const gapLength = 5;
        let distanceAlong = 0;
        for (let i=0; i < points.length -1; i++) {
            const p1 = points[i];
            const p2 = points[i+1];
            const segmentLength = p1.distanceTo(p2);
            const numDashes = Math.floor(segmentLength / (dashLength + gapLength));

            for (let j=0; j< numDashes; j++) {
                 const startT = (distanceAlong + j * (dashLength+gapLength)) / curve.getLength();
                 const endT = (distanceAlong + j * (dashLength+gapLength) + dashLength) / curve.getLength();
                 if (endT <= 1.0) {
                     centerLinePoints.push( curve.getPointAt(startT).add(new THREE.Vector3(0, 0.1, 0)) ); // Offset slightly above surface
                     centerLinePoints.push( curve.getPointAt(endT).add(new THREE.Vector3(0, 0.1, 0)) );
                 }
            }
             distanceAlong += segmentLength;

        }
         if (centerLinePoints.length > 0) {
             const centerLineGeom = new THREE.BufferGeometry().setFromPoints(centerLinePoints);
             const centerLine = new THREE.LineSegments(centerLineGeom, whiteLineMaterial);
             group.add(centerLine);
         }


        // Add guardrails and pillars
        addGuardrails(points, width, guardrailHeight, group);
        addPillarsAlongCurve(points, width, pillarGroup); // Add pillars to the dedicated pillarGroup

        return curve; // Return the original curve for bus pathing
    }


    function addGuardrails(points, width, railHeight, group) {
        const railPoints = [];
        const railOffset = width / 2 + 0.2; // Place guardrails slightly outside the road width
        const postSpacing = 5; // How many curve points between posts

        for (let side = -1; side <= 1; side += 2) {
            const currentSidePoints = [];
            // Generate rail path points
            for (let i = 0; i < points.length; i++) {
                const p = points[i];
                const tangent = (i < points.length - 1)
                    ? points[i+1].clone().sub(p)
                    : p.clone().sub(points[i-1]);
                tangent.normalize();
                const normal = new THREE.Vector3(0, 1, 0);
                const binormal = new THREE.Vector3().crossVectors(tangent, normal).normalize();

                const railBase = p.clone().addScaledVector(binormal, side * railOffset);
                currentSidePoints.push(railBase);
            }

            // Add line segments for top and bottom rails
             for (let i = 0; i < currentSidePoints.length - 1; i++) {
                const p1Base = currentSidePoints[i];
                const p2Base = currentSidePoints[i+1];
                const p1Top = p1Base.clone().add(new THREE.Vector3(0, railHeight, 0));
                const p2Top = p2Base.clone().add(new THREE.Vector3(0, railHeight, 0));

                railPoints.push(p1Base, p2Base); // Bottom rail segment
                railPoints.push(p1Top, p2Top);   // Top rail segment

                // Add vertical posts periodically
                if (i % postSpacing === 0) {
                     railPoints.push(p1Base, p1Top);
                }
             }
             // Add last post
             if (currentSidePoints.length > 0) {
                 const lastBase = currentSidePoints[currentSidePoints.length - 1];
                 const lastTop = lastBase.clone().add(new THREE.Vector3(0, railHeight, 0));
                  if ((currentSidePoints.length - 1) % postSpacing === 0) {
                      railPoints.push(lastBase, lastTop);
                  }
             }
        }
        if (railPoints.length > 0) {
            const railGeometry = new THREE.BufferGeometry().setFromPoints(railPoints);
            const railObj = new THREE.LineSegments(railGeometry, detailLineMaterial); // Use a lighter material
            group.add(railObj);
        }
    }


    function addPillarsAlongCurve(points, width, pillarGroupRef) {
         let distanceSpaced = 0;
        const basePillarY = 0.1; // Start pillars slightly above ground plane y=0

        for (let i = 1; i < points.length; i++) {
             const p0 = points[i-1];
             const p1 = points[i];
             distanceSpaced += p0.distanceTo(p1);

             if (distanceSpaced >= pillarSpacing) {
                 const point = p1; // Place pillar at the end of the segment
                 const pillarHeight = point.y - basePillarY; // Height from basePillarY to flyover point

                 if (pillarHeight > 1.0) { // Only add pillars if flyover is sufficiently high
                    // Place pillars slightly offset from center using binormal
                    const tangent = p1.clone().sub(p0).normalize();
                    const normal = new THREE.Vector3(0, 1, 0);
                    const binormal = new THREE.Vector3().crossVectors(tangent, normal).normalize();
                    const pillarOffset = width * 0.3; // Offset pillars slightly inward

                    createPillar(point.x + binormal.x * pillarOffset, basePillarY, point.z + binormal.z * pillarOffset, pillarHeight, pillarGroupRef);
                    createPillar(point.x - binormal.x * pillarOffset, basePillarY, point.z - binormal.z * pillarOffset, pillarHeight, pillarGroupRef);
                }
                distanceSpaced = 0; // Reset spacing counter
             }
        }
    }

    // Define entry/exit points (adjusted for new heights)
    const entryOffset = 30;
    const northEntry = new THREE.Vector3(0, 0.1, -rampStartZ); // Start ramps slightly above ground
    const southEntry = new THREE.Vector3(0, 0.1, rampStartZ);
    const eastEntry = new THREE.Vector3(rampStartZ, 0.1, 0);
    const westEntry = new THREE.Vector3(-rampStartZ, 0.1, 0);

    // Adjusted turn entry/exit points
    const turnRampFactor = 0.7; // Make turn ramps slightly shorter
    const northEntryE_Turn = new THREE.Vector3(entryOffset, 0.1, -rampStartZ * turnRampFactor);
    const northEntryW_Turn = new THREE.Vector3(-entryOffset, 0.1, -rampStartZ * turnRampFactor);
    const southEntryE_Turn = new THREE.Vector3(entryOffset, 0.1, rampStartZ * turnRampFactor);
    const southEntryW_Turn = new THREE.Vector3(-entryOffset, 0.1, rampStartZ * turnRampFactor);
    const eastEntryN_Turn = new THREE.Vector3(rampStartZ * turnRampFactor, 0.1, -entryOffset);
    const eastEntryS_Turn = new THREE.Vector3(rampStartZ * turnRampFactor, 0.1, entryOffset);
    const westEntryN_Turn = new THREE.Vector3(-rampStartZ * turnRampFactor, 0.1, -entryOffset);
    const westEntryS_Turn = new THREE.Vector3(-rampStartZ * turnRampFactor, 0.1, entryOffset);

    // U-Turn entry/exit points (further out)
    const uTurnOffset = entryOffset * 1.5;
    const uTurnRampFactor = 0.9;
    const northUTurnEntry = new THREE.Vector3(-uTurnOffset, 0.1, -rampStartZ * uTurnRampFactor);
    const southUTurnEntry = new THREE.Vector3(uTurnOffset, 0.1, rampStartZ * uTurnRampFactor);
    const eastUTurnEntry = new THREE.Vector3(rampStartZ * uTurnRampFactor, 0.1, uTurnOffset);
    const westUTurnEntry = new THREE.Vector3(-rampStartZ * uTurnRampFactor, 0.1, -uTurnOffset);


    // --- Generate Flyover Paths with NEW HEIGHTS and Solid Surfaces ---
    const curveSegments = 150; // More segments for smoother solid roads

    // 1. NS Straight (Height: h_ns_straight = 30)
    const nsCurve = generateBezierCurve([
        northEntry,
        new THREE.Vector3(0, h_ns_straight * 0.6, -rampStartZ * 0.4), // Control points adjusted for height
        new THREE.Vector3(0, h_ns_straight, 0),                       // Peak height
        new THREE.Vector3(0, h_ns_straight * 0.6, rampStartZ * 0.4),
        southEntry
    ]);
    const nsFlyoverPath = createFlyoverSurface(nsCurve, curveSegments, flyoverWidth, flyoverRoadMaterial, nsFlyoverGroup);

    // 2. EW Straight (Height: h_ew_straight = 45)
    const ewCurve = generateBezierCurve([
        westEntry,
        new THREE.Vector3(-rampStartZ * 0.4, h_ew_straight * 0.6, 0),
        new THREE.Vector3(0, h_ew_straight, 0),                     // Peak height
        new THREE.Vector3(rampStartZ * 0.4, h_ew_straight * 0.6, 0),
        eastEntry
    ]);
    const ewFlyoverPath = createFlyoverSurface(ewCurve, curveSegments, flyoverWidth, flyoverRoadMaterial, ewFlyoverGroup);

    // 3. NE Turn (Height: h_ne_sw_turn = 60)
    const neCurve = generateBezierCurve([
        northEntryE_Turn,
        new THREE.Vector3(northEntryE_Turn.x, h_ne_sw_turn * 0.4/1, -rampStartZ * 0.3), // Intermediate control points
        new THREE.Vector3(turnRadius * 0.7, h_ne_sw_turn/2, -turnRadius * 0.7),      // Mid-turn point at height
        new THREE.Vector3(rampStartZ * 0.3, h_ne_sw_turn * 0.4/1, eastEntryN_Turn.z),
        eastEntryN_Turn
    ]);
    const neFlyoverPath = createFlyoverSurface(neCurve, curveSegments, flyoverWidth, flyoverRoadMaterial, neFlyoverGroup);

    // 4. SW Turn (Height: h_ne_sw_turn = 60) - Mirror of NE
     const swCurve = generateBezierCurve([
        southEntryW_Turn,
        new THREE.Vector3(southEntryW_Turn.x, h_ne_sw_turn * 0.4, rampStartZ * 0.3),
        new THREE.Vector3(-turnRadius * 0.7, h_ne_sw_turn, turnRadius * 0.7),
        new THREE.Vector3(-rampStartZ * 0.3, h_ne_sw_turn * 0.4, westEntryS_Turn.z),
        westEntryS_Turn
    ]);
    const swFlyoverPath = createFlyoverSurface(swCurve, curveSegments, flyoverWidth, flyoverRoadMaterial, swFlyoverGroup);

    // 5. NW Turn (Height: h_nw_se_turn = 75)
    const nwCurve = generateBezierCurve([
        northEntryW_Turn,
        new THREE.Vector3(northEntryW_Turn.x, h_nw_se_turn/1 * 0.4, -rampStartZ * 0.3),
        new THREE.Vector3(-turnRadius * 0.7, h_nw_se_turn/1, -turnRadius * 0.7), // Different height
        new THREE.Vector3(-rampStartZ * 0.3, h_nw_se_turn * 0.4, westEntryN_Turn.z),
        westEntryN_Turn
    ]);
    const nwFlyoverPath = createFlyoverSurface(nwCurve, curveSegments, flyoverWidth, flyoverRoadMaterial, nwFlyoverGroup);

    // 6. SE Turn (Height: h_nw_se_turn = 75) - Mirror of NW
    const seCurve = generateBezierCurve([
        southEntryE_Turn,
        new THREE.Vector3(100,  h_nw_se_turn, rampStartZ * 0.3),
        new THREE.Vector3(turnRadius * 0.7, h_nw_se_turn/1, turnRadius * 0.7),
        new THREE.Vector3(rampStartZ * 0.3, h_nw_se_turn * 1, eastEntryS_Turn.z),
        eastEntryS_Turn
    ]);
    const seFlyoverPath = createFlyoverSurface(seCurve, curveSegments, flyoverWidth, flyoverRoadMaterial, seFlyoverGroup);

    // 7. NS U-Turn (Height: h_ns_uturn = 90) - Highest
    const nsUTurnCurve = generateBezierCurve([
        northUTurnEntry, // Start from North, going South initially
        new THREE.Vector3(northUTurnEntry.x - 80, h_ns_uturn * 0.5, -rampStartZ * 0.4), // Wider control point
        new THREE.Vector3(-turnRadius * 1.4, h_ns_uturn, 0), // Apex of U-turn (wider radius)
        new THREE.Vector3(southUTurnEntry.x + 80, h_ns_uturn * 0.5, rampStartZ * 0.4),
        southUTurnEntry // End going North
    ]);
    const nsUTurnPath = createFlyoverSurface(nsUTurnCurve, curveSegments + 20, flyoverWidth, flyoverRoadMaterial, nsUTurnGroup); // More segments for U-turn

    // 8. EW U-Turn (Height: h_ew_uturn = 15) - Lowest elevated
    const ewUTurnCurve = generateBezierCurve([
        eastUTurnEntry, // Start from East, going West initially
        new THREE.Vector3(rampStartZ * 0.4, h_ew_uturn * 0.5, eastUTurnEntry.z + 80),
        new THREE.Vector3(0, h_ew_uturn, turnRadius * 1.4), // Apex of U-turn
        new THREE.Vector3(-rampStartZ * 0.4, h_ew_uturn * 0.5, westUTurnEntry.z - 80),
        westUTurnEntry // End going East
    ]);
    const ewUTurnPath = createFlyoverSurface(ewUTurnCurve, curveSegments + 20, flyoverWidth, flyoverRoadMaterial, ewUTurnGroup);


    // --- Traffic Lights (Unchanged) ---
    const trafficLights = [];
    function createTrafficLight(x, z, rotationY) { const lightGroup = new THREE.Group(); lightGroup.position.set(x, 0, z); lightGroup.rotation.y = rotationY; const poleHeight = 6; const armLength = 8; const lightBoxSize = new THREE.Vector3(0.6, 1.8, 0.6); const lightRadius = 0.25; const poleGeo = new THREE.CylinderGeometry(0.2, 0.25, poleHeight, 8); const pole = new THREE.Mesh(poleGeo, poleMaterial); pole.position.y = poleHeight / 2; pole.castShadow = true; lightGroup.add(pole); const armGeo = new THREE.CylinderGeometry(0.15, 0.15, armLength, 8); const arm = new THREE.Mesh(armGeo, poleMaterial); arm.rotation.z = Math.PI / 2; arm.position.set(armLength / 2, poleHeight - 0.2, 0); arm.castShadow = true; lightGroup.add(arm); const box = new THREE.Mesh(new THREE.BoxGeometry(lightBoxSize.x, lightBoxSize.y, lightBoxSize.z), lightBoxMaterial); box.position.set(armLength - lightBoxSize.x*1.5, poleHeight - lightBoxSize.y / 2 - 0.3, 0); box.castShadow = true; lightGroup.add(box); const lightGeo = new THREE.SphereGeometry(lightRadius, 16, 8); const redLight = new THREE.Mesh(lightGeo, lightOffMaterial.clone()); redLight.position.set(box.position.x, box.position.y + lightBoxSize.y/2 - 0.4, box.position.z + lightBoxSize.z / 2 + 0.01); redLight.castShadow = true; const yellowLight = new THREE.Mesh(lightGeo, lightOffMaterial.clone()); yellowLight.position.set(redLight.position.x, redLight.position.y - 0.5, redLight.position.z); yellowLight.castShadow = true; const greenLight = new THREE.Mesh(lightGeo, lightOffMaterial.clone()); greenLight.position.set(redLight.position.x, redLight.position.y - 1.0, redLight.position.z); greenLight.castShadow = true; lightGroup.add(redLight, yellowLight, greenLight); groundGroup.add(lightGroup); return { group: lightGroup, red: redLight, yellow: yellowLight, green: greenLight }; }
    const lightPosOffset = halfIntersection + laneWidth;
    trafficLights.push(createTrafficLight(halfRoadWidth + curbOffset + sidewalkWidth, -lightPosOffset, 0));
    trafficLights.push(createTrafficLight(-(halfRoadWidth + curbOffset + sidewalkWidth), lightPosOffset, Math.PI));
    trafficLights.push(createTrafficLight(lightPosOffset, halfRoadWidth + curbOffset + sidewalkWidth, -Math.PI / 2));
    trafficLights.push(createTrafficLight(-lightPosOffset, -(halfRoadWidth + curbOffset + sidewalkWidth), Math.PI / 2));

    // --- Junction Buses ---
    function createJunctionBus(colorIndex) {
        const busCopy = busGroup.clone(true); // Clone the original bus group
         busCopy.scale.set(4, 4, 4); // *** Use a smaller scale for junction buses ***

         // Traverse and apply the specified color to the main lines
         const targetMaterial = busColorMaterials[colorIndex % busColorMaterials.length];
         busCopy.traverse(child => {
             // Change main line color
             if (child.isLineSegments && child.material === lineMaterial) {
                 child.material = targetMaterial;
             }
             // Optionally change detail line color (can keep original or match main)
             // if (child.isLineSegments && child.material === detailLineMaterial) {
             //    child.material = new THREE.LineBasicMaterial({ color: targetMaterial.color.clone().multiplyScalar(0.8) }); // Slightly darker detail
             // }

             // Optionally change wheel color
             // if (child.isMesh && child.material === wheelMaterial) {
             //     child.material = new THREE.MeshBasicMaterial({ color: 0x333333, wireframe: true }); // Darker wheels
             // }

             // Remove internal components if desired for performance (robotic arms, food, steam)
             if (child === leftRoboticArm || child === rightRoboticArm || child === foodItemsGroup || child === steamParticles || child === cookingSurfaceGroup) {
                // child.visible = false; // Or remove completely: busCopy.remove(child);
             }

             // Ensure cloned meshes also cast shadows if needed
             if (child.isMesh) {
                 child.castShadow = true;
                 // child.receiveShadow = true; // Bus surface could receive shadow
             }
         });
        busCopy.rotation.set(0, 0, 0); // Reset rotation
        return busCopy;
    }

    function createBusesForPath(path, count, colorIndex = 0, baseSpeed = 0.00005) {
        const pathLength = path.getLength(); // Get path length for speed scaling later if needed
        for (let i = 0; i < count; i++) {
            const bus = createJunctionBus(colorIndex); // Pass color index

            const progress = Math.random(); // Start buses at random points
            const speed = baseSpeed + Math.random() * baseSpeed * 0.08; // Add some speed variation

            bus.userData = {
                path: path,
                speed: speed,
                progress: progress,
                // No cooking surface needed for simplified junction buses
            };

            const position = path.getPointAt(progress);
            const tangent = path.getTangentAt(progress); // Normalized tangent vector

            // *** Offset bus slightly above the flyover surface ***
             const surfaceOffset = 0.3; // Adjust as needed based on bus model base
             position.y += surfaceOffset;

            bus.position.copy(position);

            // Orient bus along the path tangent
            const lookAtPos = position.clone().add(tangent); // Point slightly ahead
            bus.lookAt(lookAtPos);
            // Adjust lookAt rotation if necessary (often needs +PI/2 or -PI/2 depending on model orientation)
             // IMPORTANT: Adjust this angle if your bus model faces a different direction by default
            bus.rotation.y += Math.PI / 2; // Assuming bus model's front is along its local +X axis

            junctionBusGroup.add(bus);
        }
    }

    // Add buses to paths (use appropriate colors)
    createBusesForPath(nsFlyoverPath, 1, 1, 0.0015); // NS Straight (Orange)
    // createBusesForPath(ewFlyoverPath, 3, 2, 0.0005); // EW Straight (Green)
    createBusesForPath(neFlyoverPath, 1, 1, 0.0008); // NE Turn (Orange)
    createBusesForPath(swFlyoverPath, 1, 1, 0.0008); // SW Turn (Orange)
    createBusesForPath(nwFlyoverPath, 1, 1, 0.0007); // NW Turn (Green)
    createBusesForPath(seFlyoverPath, 1, 1, 0.0007); // SE Turn (Green)
    createBusesForPath(nsUTurnPath, 1, 1, 0.0004);   // NS U-Turn (Yellow)
    createBusesForPath(ewUTurnPath, 1, 1, 0.0009);   // EW U-Turn (Pink)

    // Add some ground-level buses (use distinct colors)
    const groundBusY = 0.5; // Y position for ground buses (low enough to be under flyovers)
    const groundPathNS = new THREE.LineCurve3( new THREE.Vector3(laneWidth, groundBusY, -junctionRoadLength * 0.8), new THREE.Vector3(laneWidth, groundBusY, junctionRoadLength * 0.8) );
    const groundPathSN = new THREE.LineCurve3( new THREE.Vector3(-laneWidth, groundBusY, junctionRoadLength * 0.8), new THREE.Vector3(-laneWidth, groundBusY, -junctionRoadLength * 0.8) );
    const groundPathEW = new THREE.LineCurve3( new THREE.Vector3(-junctionRoadLength * 0.8, groundBusY, -laneWidth), new THREE.Vector3(junctionRoadLength * 0.8, groundBusY, -laneWidth) );
    const groundPathWE = new THREE.LineCurve3( new THREE.Vector3(junctionRoadLength * 0.8, groundBusY, laneWidth), new THREE.Vector3(-junctionRoadLength * 0.8, groundBusY, laneWidth) );

    createBusesForPath(groundPathNS, 1, 0, 0.0015); // Cyan
    createBusesForPath(groundPathSN, 1, 0, 0.0016); // Cyan
    createBusesForPath(groundPathEW, 1, 0, 0.0014); // Blue (original)
    createBusesForPath(groundPathWE, 1, 0, 0.0015); // Blue (original)
    junctionGroup.add(junctionBusGroup); // Add the group containing all junction buses


    // --- Lighting (Adjusted) ---
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.9); // Increased ambient slightly
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5); // Increased directional intensity significantly
    directionalLight.position.set(50, 150, 70); // Higher and further light source for large structure
    directionalLight.castShadow = true;
    directionalLight.shadow.mapSize.width = 2048; // Increase shadow map resolution
    directionalLight.shadow.mapSize.height = 2048;
    directionalLight.shadow.camera.near = 10;    // Adjust shadow camera frustum
    directionalLight.shadow.camera.far = 500;
    directionalLight.shadow.camera.left = -250;
    directionalLight.shadow.camera.right = 250;
    directionalLight.shadow.camera.top = 250;
    directionalLight.shadow.camera.bottom = -250;
    directionalLight.shadow.bias = -0.001; // Adjust shadow bias if needed (prevents shadow acne)
    // scene.add(directionalLight);
    // const shadowCamHelper = new THREE.CameraHelper(directionalLight.shadow.camera); // Optional: Visualize shadow frustum
    // scene.add(shadowCamHelper);

    // Optional: Hemisphere light for softer overall lighting
    const hemiLight = new THREE.HemisphereLight( 0xffffbb, 0x0A192F, 0.5 ); // Sky color, Ground color (background), Intensity
    // scene.add( hemiLight );   

    // --- Resize Handler ---
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    });

    let lastScrollY = 0;
let isAtBottom = false;
let isScrollingUp = false;

// Replace the existing scroll event listener with this one
window.addEventListener('scroll', () => {
// Detect scroll direction
isScrollingUp = window.scrollY < lastScrollY;

// Store current scroll position for next comparison
lastScrollY = window.scrollY;

// Update animation parameters
scrollAnimationParams.currentScrollY = window.scrollY;

// Calculate if we're at the bottom of the page
const maxScroll = document.body.scrollHeight - window.innerHeight;
const scrollProgress = maxScroll > 0 ? Math.min(Math.max(scrollAnimationParams.currentScrollY / maxScroll, 0), 1) : 0;

// Check if we're at the bottom (or very close)
const bottomThreshold = 0.95;
const wasAtBottom = isAtBottom;
isAtBottom = scrollProgress >= bottomThreshold;

// If we were at the bottom and now scrolling up, force manual camera reset
if (wasAtBottom && isScrollingUp) {
    console.log("Scrolling up from bottom - resetting camera");
    
    // Force exit full mouse control mode
    isFullMouseControlActive = false;
    controls.enableZoom = false;
    controls.enablePan = false;
    
    // Reset camera to a known good position
    camera.position.copy(initialCameraPosition);
    controls.target.copy(initialCameraTarget);
    controls.update();
    
    // Update UI
    infoElement.textContent = "Scrolling back up from bottom";
    scrollInfoElement.textContent = "Scroll to animate, drag to look";
}
});



    // --- Animation Functions ---
    // Animate Main Bus components (Food, Steam, Arms) - Unchanged
    function animateFood(time) { foodItemsGroup.children.forEach((food, index) => { const yBase = cookingSurfaceY + 0.02; if (index === 0) { food.position.y = yBase + Math.max(0, Math.sin(time * 1.5 * 2)) * 0.1; food.rotation.z += Math.max(0, Math.sin(time * 1.5 * 2)) * 0.1; } else { food.position.x = cookingSurfaceX + 0.3 + Math.sin(time * 2.5 + index) * 0.02; food.position.z = Math.cos(time * 2.5 + index) * 0.02; } }); }
    function animateSteam(time) { steamParticles.children.forEach(particle => { particle.position.y += particle.userData.speed; particle.position.x += Math.sin(time * 2 + particle.userData.offset) * 0.002; particle.position.z += Math.cos(time * 2 + particle.userData.offset) * 0.002; const life = (particle.position.y - particle.userData.originalY) / 0.8; particle.material.opacity = Math.max(0, 0.6 * (1 - life)); if (life > 1) { const radius = 0.4 * Math.sqrt(Math.random()); const angle = Math.random() * Math.PI * 2; particle.position.set( cookingSurfaceX + radius * Math.cos(angle), cookingSurfaceY + 0.05 + Math.random() * 0.1, radius * Math.sin(angle) ); particle.userData.originalY = particle.position.y; particle.material.opacity = 0.6; } }); }
    const robotArmParams = { leftArm: { platformRotation: { min: -Math.PI/4, max: Math.PI/4 }, upperArmRotation: { min: -Math.PI/6, max: Math.PI/6 }, forearmRotation: { min: -Math.PI, max: -Math.PI/2 - Math.PI/4 }, handRotation: { min: -Math.PI/4, max: Math.PI/4 }, phases: { platform: 0, upperArm: 2, forearm: 4, hand: 6 } }, rightArm: { platformRotation: { min: -Math.PI/4, max: Math.PI/4 }, upperArmRotation: { min: -Math.PI/6, max: Math.PI/6 }, forearmRotation: { min: -Math.PI, max: -Math.PI/2 - Math.PI/4 }, handRotation: { min: -Math.PI/4, max: Math.PI/4 }, phases: { platform: 1, upperArm: 3, forearm: 5, hand: 7 } }, speed: 2.5 };
    function animateRoboticArms(time) { leftRoboticArm.userData.platform.rotation.y = oscillate(time, robotArmParams.leftArm.platformRotation.min, robotArmParams.leftArm.platformRotation.max, robotArmParams.leftArm.phases.platform, robotArmParams.speed); leftRoboticArm.userData.upperArm.rotation.x = oscillate(time, robotArmParams.leftArm.upperArmRotation.min, robotArmParams.leftArm.upperArmRotation.max, robotArmParams.leftArm.phases.upperArm, robotArmParams.speed); leftRoboticArm.userData.forearm.rotation.x = oscillate(time, robotArmParams.leftArm.forearmRotation.min, robotArmParams.leftArm.forearmRotation.max, robotArmParams.leftArm.phases.forearm, robotArmParams.speed); leftRoboticArm.userData.hand.rotation.z = oscillate(time, robotArmParams.leftArm.handRotation.min, robotArmParams.leftArm.handRotation.max, robotArmParams.leftArm.phases.hand, robotArmParams.speed); rightRoboticArm.userData.platform.rotation.y = oscillate(time, robotArmParams.rightArm.platformRotation.min, robotArmParams.rightArm.platformRotation.max, robotArmParams.rightArm.phases.platform, robotArmParams.speed); rightRoboticArm.userData.upperArm.rotation.x = oscillate(time, robotArmParams.rightArm.upperArmRotation.min, robotArmParams.rightArm.upperArmRotation.max, robotArmParams.rightArm.phases.upperArm, robotArmParams.speed); rightRoboticArm.userData.forearm.rotation.x = oscillate(time, robotArmParams.rightArm.forearmRotation.min, robotArmParams.rightArm.forearmRotation.max, robotArmParams.rightArm.phases.forearm, robotArmParams.speed); rightRoboticArm.userData.hand.rotation.z = oscillate(time, robotArmParams.rightArm.handRotation.min, robotArmParams.rightArm.handRotation.max, robotArmParams.rightArm.phases.hand, robotArmParams.speed); }
    function oscillate(time, min, max, phaseOffset, speed) { const center = (max + min) / 2; const amplitude = (max - min) / 2; return center + amplitude * Math.sin(time * speed + phaseOffset); }

    // NEW: Animate Main Bus (Moving Bus, Static Oval Road)
    const busState = { moving: true, progress: 0, speed: 0.0005, startTime: null };
    function animateBusAndRoad(time) {
        if (busState.startTime === null) {
            busState.startTime = time;
        }
        
        if (busState.moving) {
            // Update the bus position along the oval track
            busState.progress += busState.speed;
            if (busState.progress > 1) busState.progress %= 1;
            
            // Get the position and orientation on the track
            const position = trackCurve.getPointAt(busState.progress);
            const tangent = trackCurve.getTangentAt(busState.progress).normalize();
            
            // Adjust position height for the road surface
            position.y += floorY * 1.5;
            
            // Apply position to bus
            busGroup.position.copy(position);
            
            // Orient bus along track
            const lookAtPoint = position.clone().add(tangent);
            busGroup.lookAt(lookAtPoint);
            busGroup.rotation.y += Math.PI / 2; // Adjust based on bus model orientation
            
            // Rotate wheels based on movement
            const wheelRotationSpeed = 0.1; // Adjust speed
            busGroup.traverse(child => {
                if (child.isMesh && (child.geometry.type === 'TorusGeometry' || child.geometry.type === 'CircleGeometry')) {
                    child.rotation.z -= wheelRotationSpeed;
                }
            });
        }
    }

    // Animate Junction Buses (Moving Buses) - Adjusted for new orientation/positioning
    const tempBusPos = new THREE.Vector3();
    const tempBusLookAt = new THREE.Vector3();
    function animateJunctionBuses(deltaTime, time) {
        const surfaceOffset = 0.3; // Same offset as used in creation
        const wheelRotationSpeed = 0.25; // Adjust wheel speed as needed

        junctionBusGroup.children.forEach(bus => {
            if (!bus.userData || !bus.userData.path) return;

            // Update progress
            bus.userData.progress += bus.userData.speed; // Speed is per frame/update here
            if (bus.userData.progress >= 1.0) {
                bus.userData.progress %= 1.0; // Wrap progress
            } else if (bus.userData.progress < 0) {
                bus.userData.progress = 1.0 + (bus.userData.progress % 1.0); // Handle negative wrap if speed reversed
            }

            // Get new position and tangent from the curve
            const path = bus.userData.path;
            path.getPointAt(bus.userData.progress, tempBusPos);
            const tangent = path.getTangentAt(bus.userData.progress); // Normalized tangent

            // Apply surface offset
            tempBusPos.y += surfaceOffset;

            // Update bus position
            bus.position.copy(tempBusPos);

            // Update bus orientation
            tempBusLookAt.copy(tempBusPos).add(tangent); // Look slightly ahead along the tangent
            bus.lookAt(tempBusLookAt);
            bus.rotation.y += Math.PI / 2; // Re-apply orientation correction

            // Animate wheels on junction buses
             bus.traverse(child => {
                if (child.isMesh && child.geometry && (child.geometry.type === 'TorusGeometry' || child.geometry.type === 'CircleGeometry')) {
                    child.rotation.z -= wheelRotationSpeed; // Rotate forward
                }
             });
        });
    }

    // Animate Traffic Lights (Unchanged)
    function animateTrafficLights(deltaTime) { const time = Date.now() / 1000; const cycleDuration = 15; const greenTime = 0.4; const yellowTime = 0.1; const cycleProgress = (time % cycleDuration) / cycleDuration; const nsGreenStart = 0; const nsYellowStart = nsGreenStart + greenTime; const nsRedStart = nsYellowStart + yellowTime; const ewGreenStart = nsRedStart; const ewYellowStart = ewGreenStart + greenTime; const ewRedStart = ewYellowStart + yellowTime; trafficLights.forEach((light, index) => { light.red.material = lightOffMaterial; light.yellow.material = lightOffMaterial; light.green.material = lightOffMaterial; let currentGreenStart, currentYellowStart, currentRedStart; if (index === 0 || index === 1) { currentGreenStart = nsGreenStart; currentYellowStart = nsYellowStart; currentRedStart = nsRedStart; } else { currentGreenStart = ewGreenStart; currentYellowStart = ewYellowStart; currentRedStart = ewRedStart; } if (cycleProgress >= currentGreenStart && cycleProgress < currentYellowStart) { light.green.material = greenLightMaterial; } else if (cycleProgress >= currentYellowStart && cycleProgress < currentRedStart) { light.yellow.material = yellowLightMaterial; } else { const isInRedBeforeWrap = currentGreenStart > currentRedStart && cycleProgress < currentGreenStart && cycleProgress >= currentRedStart - 1.0; const isInRedAfterStart = cycleProgress >= currentRedStart; if (isInRedAfterStart || isInRedBeforeWrap) { light.red.material = redLightMaterial; } else { if (index === 0 || index === 1) { if(cycleProgress >= ewGreenStart) light.red.material = redLightMaterial; } else { if(cycleProgress < ewGreenStart) light.red.material = redLightMaterial; } } } }); }


    // --- Camera Update Logic (Unchanged logic, targets might shift due to scene scale) ---
    const tempTarget = new THREE.Vector3();
    const vec3Lerp = (v1, v2, t, out) => out.copy(v1).lerp(v2, t); // Helper


    function updateCameraAndControls(time) {
const maxScroll = document.body.scrollHeight - window.innerHeight;
const scrollProgress = maxScroll > 0 ? Math.min(Math.max(scrollAnimationParams.currentScrollY / maxScroll, 0), 1) : 0;
const activationThreshold = 0.98;

// Store previous scroll progress to detect direction
const prevScrollProgress = scrollAnimationParams.prevScrollProgress || scrollProgress;
const isScrollingUp = scrollProgress < prevScrollProgress;

// Save current scroll progress for next frame
scrollAnimationParams.prevScrollProgress = scrollProgress;

// Always get the current bus position
const currentBusPosition = busGroup.position.clone();

// Default target is the current bus position
let targetLookAt = currentBusPosition.clone();
let targetDistance = scrollAnimationParams.scrollPages.straightRoad.dist;
let lerpFactor = 0.08;
let currentPage = 'straightRoad';
let showBus = true;
let showRoad = true;
let showJunction = false;

// Minimum Y-coordinate to prevent looking below road level
const minimumTargetY = 10;

// If user has scrolled to the bottom and is now scrolling back up,
// ensure we reset to proper animation state
if (isScrollingUp && scrollProgress < activationThreshold) {
    // Disable full mouse control when scrolling back up
    if (isFullMouseControlActive) {
        isFullMouseControlActive = false;
        controls.enableZoom = false;
        controls.enablePan = false;
        infoElement.textContent = "Scrolling back up through animation";
        scrollInfoElement.textContent = "Scroll to animate, drag to look";
    }
}

if (!isFullMouseControlActive) {
    // Normal scroll animation path
    if (scrollProgress <= scrollAnimationParams.scrollPages.straightRoad.end) {
        targetLookAt = currentBusPosition.clone();
        targetLookAt.y = Math.max(targetLookAt.y, minimumTargetY);
        targetDistance = scrollAnimationParams.scrollPages.straightRoad.dist;
        currentPage = 'straightRoad';
        
    } else if (scrollProgress <= scrollAnimationParams.scrollPages.zoomToBus.end) {
        targetLookAt = currentBusPosition.clone();
        targetLookAt.y = Math.max(targetLookAt.y, minimumTargetY);
        
        const t = normalize(scrollProgress, scrollAnimationParams.scrollPages.zoomToBus.start, scrollAnimationParams.scrollPages.zoomToBus.end);
        targetDistance = lerp(scrollAnimationParams.scrollPages.straightRoad.dist, scrollAnimationParams.scrollPages.zoomToBus.dist, t);
        currentPage = 'zoomToBus';
        
    } else if (scrollProgress <= scrollAnimationParams.scrollPages.zoomToFunction.end) {
        const t = normalize(scrollProgress, scrollAnimationParams.scrollPages.zoomToFunction.start, scrollAnimationParams.scrollPages.zoomToFunction.end);
        
        const cookingSurfaceRelative = new THREE.Vector3(
            currentBusPosition.x + (cookingSurfaceX * busGroup.scale.x), 
            Math.max(currentBusPosition.y + ((cookingSurfaceY + 0.5) * busGroup.scale.y), minimumTargetY),
            currentBusPosition.z
        );
        
        vec3Lerp(currentBusPosition, cookingSurfaceRelative, t, targetLookAt);
        targetDistance = lerp(scrollAnimationParams.scrollPages.zoomToBus.dist, scrollAnimationParams.scrollPages.zoomToFunction.dist, t);
        currentPage = 'zoomToFunction';
        
    } else if (scrollProgress <= scrollAnimationParams.scrollPages.panToJunction.end) {
        const t = normalize(scrollProgress, scrollAnimationParams.scrollPages.panToJunction.start, scrollAnimationParams.scrollPages.panToJunction.end);
        
        const cookingSurfaceRelative = new THREE.Vector3(
            currentBusPosition.x + (cookingSurfaceX * busGroup.scale.x), 
            Math.max(currentBusPosition.y + ((cookingSurfaceY + 0.5) * busGroup.scale.y), minimumTargetY),
            currentBusPosition.z
        );
        
        const junctionViewTarget = new THREE.Vector3(
            currentBusPosition.x, 
            Math.max(currentBusPosition.y + 50, minimumTargetY),
            currentBusPosition.z
        );
        
        vec3Lerp(cookingSurfaceRelative, junctionViewTarget, t, targetLookAt);
        targetDistance = lerp(scrollAnimationParams.scrollPages.zoomToFunction.dist, scrollAnimationParams.scrollPages.panToJunction.dist, t);
        currentPage = 'panToJunction';
        showJunction = t > 0.5;
        
    } else if (scrollProgress < activationThreshold) {
        const t = normalize(scrollProgress, scrollAnimationParams.scrollPages.fullJunction.start, activationThreshold);
        
        const startPoint = new THREE.Vector3(
            currentBusPosition.x, 
            Math.max(currentBusPosition.y + 50, minimumTargetY),
            currentBusPosition.z
        );
        
        const finalViewPoint = new THREE.Vector3(
            0,
            Math.max(80, minimumTargetY),
            0
        );
        
        vec3Lerp(startPoint, finalViewPoint, t, targetLookAt);
        
        targetDistance = lerp(scrollAnimationParams.scrollPages.panToJunction.dist, scrollAnimationParams.scrollPages.fullJunction.dist, t);
        currentPage = 'fullJunction';
        showJunction = true;
    } else {
        // Reached activation threshold
        if (!isFullMouseControlActive) {
            isFullMouseControlActive = false;
            controls.enableZoom = true;
            controls.enablePan = false;
            infoElement.textContent = "Scroll complete. Use mouse to explore.";
            scrollInfoElement.textContent = "Full mouse control active";
            console.log("Full mouse control activated");
            
            // Set a safe initial position for the free camera mode
            controls.target.copy(new THREE.Vector3(50, Math.max(50, minimumTargetY), 0));
            // camera.position.set(100, 450, 100);
            // controls.update();
        }
        currentPage = 'fullJunction';
        showJunction = true;
    }

    // Only update camera if not in full mouse control mode
    if (!isFullMouseControlActive) {
        // Use a faster lerp factor to keep up with the bus movement
        controls.target.lerp(targetLookAt, lerpFactor * 2);
        
        // Calculate new position based on distance
        const currentDirection = new THREE.Vector3().subVectors(camera.position, controls.target).normalize();
        camera.position.copy(controls.target).addScaledVector(currentDirection, targetDistance);
        
        controls.enableZoom = false;
        controls.enablePan = false;

        if (currentPage !== scrollAnimationParams.currentAnimationPage) {
            scrollAnimationParams.currentAnimationPage = currentPage;
            updateInfoText(currentPage);
        }
        scrollInfoElement.textContent = "Scroll to animate path, drag mouse to look";
    }
}

busGroup.visible = showBus;
staticRoadGroup.visible = showRoad;
junctionGroup.visible = showJunction;
}


    // --- Helper Functions ---
    function normalize(value, min, max) { if (max - min === 0) return 0; return Math.max(0, Math.min(1, (value - min) / (max - min))); }
    function lerp(a, b, t) { return a + (b - a) * t; }
    function updateInfoText(currentPage) { switch (currentPage) { case 'straightRoad': infoElement.textContent = "Scroll: Bus on road / Drag: Look"; break; case 'zoomToBus': infoElement.textContent = "Scroll: Zooming to bus / Drag: Look"; break; case 'zoomToFunction': infoElement.textContent = "Scroll: Examining cooking area / Drag: Look"; break; case 'panToJunction': infoElement.textContent = "Scroll: Transitioning to junction / Drag: Look"; break; case 'fullJunction': infoElement.textContent = "Scroll: Viewing flyover junction / Drag: Look"; break; } }

    // --- Animation Loop ---
    const clock = new THREE.Clock();
    function animate() {
        requestAnimationFrame(animate);

        const time = clock.getElapsedTime();
        const deltaTime = clock.getDelta(); // Use delta time for frame-rate independent animations

        updateCameraAndControls(time);
        if (busGroup.visible) {
            animateFood(time);
            animateSteam(time);
            animateRoboticArms(time);
            if (busState.moving) {
                animateBusAndRoad(time);
            }
         }

        if (junctionGroup.visible) {
            animateJunctionBuses(deltaTime, time); // Pass deltaTime
            animateTrafficLights(deltaTime); // Pass deltaTime
        }

        controls.update(); // Update OrbitControls
        renderer.render(scene, camera);
    }

    // --- Start ---
    animate();
    updateInfoText(scrollAnimationParams.currentAnimationPage);
    infoElement.textContent = "Scroll down to start animation, drag mouse to look around";

// --- Materials ---
// No changes to materials, as linewidth and colors are pixel-based or aesthetic
const restaurantWireframeMaterial = new THREE.LineBasicMaterial({ color: 0x87CEEB, linewidth: 1 }); // Cyan for restaurant
const femaleWireframeBlue = new THREE.MeshBasicMaterial({
color: 0x99ddff, // Lighter blue for figures
wireframe: true,
wireframeLinewidth: 1
});
const lampLightMaterial = new THREE.MeshBasicMaterial({
color: 0x39bdd6, // Yellow light
wireframe: true,
wireframeLinewidth: 2 // Slightly thicker
});

// --- Helper Function to create Wireframe Objects ---
// No changes needed, as scaling is handled in geometry and position parameters
function createWireframe(geometry, material, position = { x: 0, y: 0, z: 0 }, rotation = { x: 0, y: 0, z: 0 }, scale = { x: 1, y: 1, z: 1 }) {
const edges = new THREE.EdgesGeometry(geometry);
const line = new THREE.LineSegments(edges, material);
line.position.set(position.x, position.y, position.z);
line.rotation.set(rotation.x, rotation.y, rotation.z);
line.scale.set(scale.x, scale.y, scale.z);
return line;
}

// --- Restaurant Geometry ---
// Layer 0: Base / Ground
const baseGeo = new THREE.BoxGeometry(50, 2, 40); // 5, 0.2, 4 -> 50, 2, 40
const baseWire = createWireframe(baseGeo, restaurantWireframeMaterial, { x: 0, y: 1, z: 0 }); // y: 0.1 -> 1
restaurantGroup.add(baseWire);

// Layer 1: Main Shop Floor
const shopFloorGeo = new THREE.BoxGeometry(40, 25, 30); // 4, 2.5, 3 -> 40, 25, 30
const shopFloorWire = createWireframe(shopFloorGeo, restaurantWireframeMaterial, { x: 0, y: 14.5, z: 0 }); // y: 1.45 -> 14.5
restaurantGroup.add(shopFloorWire);

// Layer 1 Details: Counter
const counterGeo = new THREE.BoxGeometry(38, 2, 8); // 3.8, 0.2, 0.8 -> 38, 2, 8
const counterWire = createWireframe(counterGeo, restaurantWireframeMaterial, { x: 0, y: 8, z: 19 }); // y: 0.8 -> 8, z: 1.9 -> 19
restaurantGroup.add(counterWire);

// Layer 1 Details: Stools
const stoolSeatGeo = new THREE.CylinderGeometry(3, 3, 1, 12); // 0.3, 0.3, 0.1 -> 3, 3, 1
const stoolLegGeo = new THREE.CylinderGeometry(0.5, 0.5, 6, 8); // 0.05, 0.05, 0.6 -> 0.5, 0.5, 6
const stool1 = new THREE.Group();
stool1.add(createWireframe(stoolSeatGeo, restaurantWireframeMaterial, { x: 0, y: 6.5, z: 0 })); // y: 0.65 -> 6.5
stool1.add(createWireframe(stoolLegGeo, restaurantWireframeMaterial, { x: 0, y: 3, z: 0 })); // y: 0.3 -> 3
stool1.position.set(-10, 0, 24); // x: -1 -> -10, z: 2.4 -> 24
restaurantGroup.add(stool1);
const stool2 = stool1.clone();
stool2.position.set(10, 0, 24); // x: 1 -> 10, z: 2.4 -> 24
restaurantGroup.add(stool2);

// Layer 2: Slanted Roof & Mid Section
const roofGeo = new THREE.BoxGeometry(42, 1.5, 32); // 4.2, 0.15, 3.2 -> 42, 1.5, 32
const roofWire = createWireframe(roofGeo, restaurantWireframeMaterial, { x: 0, y: 28, z: 0 }, { x: Math.PI / 7, y: 0, z: 0 }); // y: 2.8 -> 28
restaurantGroup.add(roofWire);

const midSectionGeo = new THREE.BoxGeometry(35, 15, 28); // 3.5, 1.5, 2.8 -> 35, 15, 28
const midSectionWire = createWireframe(midSectionGeo, restaurantWireframeMaterial, { x: 0, y: 34.5, z: -1 }); // y: 3.45 -> 34.5, z: -0.1 -> -1
restaurantGroup.add(midSectionWire);

// Layer 3: Upper Section & Signage Area
const upperSectionGeo = new THREE.BoxGeometry(30, 25, 25); // 3, 2.5, 2.5 -> 30, 25, 25
const upperSectionWire = createWireframe(upperSectionGeo, restaurantWireframeMaterial, { x: 2, y: 54.5, z: -2 }); // x: 0.2 -> 2, y: 5.45 -> 54.5, z: -0.2 -> -2
restaurantGroup.add(upperSectionWire);

// Layer 4: Top Clutter Area
const topClutterGeo = new THREE.BoxGeometry(25, 15, 20); // 2.5, 1.5, 2 -> 25, 15, 20
const topClutterWire = createWireframe(topClutterGeo, restaurantWireframeMaterial, { x: -3, y: 74.5, z: -5 }); // x: -0.3 -> -3, y: 7.45 -> 74.5, z: -0.5 -> -5
restaurantGroup.add(topClutterWire);

// --- Create Signage ---
const signageGroup = new THREE.Group();
restaurantGroup.add(signageGroup);

// Horizontal Sign
const hSignGeo = new THREE.BoxGeometry(32, 7, 1.5); // 3.2, 0.7, 0.15 -> 32, 7, 1.5
const hSignWire = createWireframe(hSignGeo, restaurantWireframeMaterial, { x: 0, y: 40, z: 13 }); // y: 4.0 -> 40, z: 1.3 -> 13
signageGroup.add(hSignWire);

// Vertical Sign
const vSignGeo = new THREE.BoxGeometry(5, 35, 1.5); // 0.5, 3.5, 0.15 -> 5, 35, 1.5
const vSignWire = createWireframe(vSignGeo, restaurantWireframeMaterial, { x: -22.5, y: 30, z: 0 }); // x: -2.25 -> -22.5, y: 3.0 -> 30
signageGroup.add(vSignWire);

// Advanced Ramen Bowl Sign
const ramenSignGroup = new THREE.Group();
ramenSignGroup.name = "ramenSign";
signageGroup.add(ramenSignGroup);
ramenSignGroup.position.set(2, 54, 11); // x: 0.2 -> 2, y: 5.4 -> 54, z: 1.1 -> 11

// Bowl using LatheGeometry
const points = [];
for (let i = 0; i < 10; i++) {
points.push(new THREE.Vector2(Math.sin(i * 0.2) * 8 + 3, (i - 5) * 1)); // x: 0.8 -> 8, 0.3 -> 3, y: 0.1 -> 1
}
const bowlShapeGeo = new THREE.LatheGeometry(points, 16);
const bowlShapeWire = createWireframe(bowlShapeGeo, restaurantWireframeMaterial, { x: 0, y: 0, z: 0 });
ramenSignGroup.add(bowlShapeWire);

// Simplified Noodles
const noodleGeo = new THREE.BoxGeometry(1, 5, 1); // 0.1, 0.5, 0.1 -> 1, 5, 1
ramenSignGroup.add(createWireframe(noodleGeo, restaurantWireframeMaterial, { x: -2, y: 3, z: 0 }, { z: 0.2 })); // x: -0.2 -> -2, y: 0.3 -> 3
ramenSignGroup.add(createWireframe(noodleGeo, restaurantWireframeMaterial, { x: 0, y: 4, z: 1 }, { z: -0.1 })); // y: 0.4 -> 4, z: 0.1 -> 1
ramenSignGroup.add(createWireframe(noodleGeo, restaurantWireframeMaterial, { x: 2, y: 3.5, z: -1 }, { z: 0.15 })); // x: 0.2 -> 2, y: 0.35 -> 3.5, z: -0.1 -> -1

// Chopsticks
const chopstickGeo = new THREE.BoxGeometry(0.5, 12, 0.5); // 0.05, 1.2, 0.05 -> 0.5, 12, 0.5
const chopstick1Wire = createWireframe(chopstickGeo, restaurantWireframeMaterial, { x: 2, y: 7, z: 0 }, { z: -Math.PI / 6 }); // x: 0.2 -> 2, y: 0.7 -> 7
const chopstick2Wire = createWireframe(chopstickGeo, restaurantWireframeMaterial, { x: -2, y: 7, z: 0 }, { z: Math.PI / 6 }); // x: -0.2 -> -2, y: 0.7 -> 7
ramenSignGroup.add(chopstick1Wire);
ramenSignGroup.add(chopstick2Wire);

// --- Create Side Details & Clutter ---
const sideClutterGroup = new THREE.Group();
restaurantGroup.add(sideClutterGroup);

// Arcade Machine 1
const arcade1Geo = new THREE.BoxGeometry(8, 18, 8); // 0.8, 1.8, 0.8 -> 8, 18, 8
const arcade1Wire = createWireframe(arcade1Geo, restaurantWireframeMaterial, { x: 24, y: 11, z: 5 }); // x: 2.4 -> 24, y: 1.1 -> 11, z: 0.5 -> 5
sideClutterGroup.add(arcade1Wire);
const arcade1ScreenGeo = new THREE.BoxGeometry(6, 7, 1); // 0.6, 0.7, 0.1 -> 6, 7, 1
const arcade1ScreenWire = createWireframe(arcade1ScreenGeo, restaurantWireframeMaterial, { x: 24, y: 15, z: 9.5 }); // x: 2.4 -> 24, y: 1.5 -> 15, z: 0.95 -> 9.5
sideClutterGroup.add(arcade1ScreenWire);

// Arcade Machine 2
const arcade2Geo = new THREE.BoxGeometry(7, 15, 7); // 0.7, 1.5, 0.7 -> 7, 15, 7
const arcade2Wire = createWireframe(arcade2Geo, restaurantWireframeMaterial, { x: 23.5, y: 34.5, z: -1 }); // x: 2.35 -> 23.5, y: 3.45 -> 34.5, z: -0.1 -> -1
sideClutterGroup.add(arcade2Wire);

// Various Clutter Boxes
const clutterBoxGeo = new THREE.BoxGeometry(6, 4, 5); // 0.6, 0.4, 0.5 -> 6, 4, 5
sideClutterGroup.add(createWireframe(clutterBoxGeo, restaurantWireframeMaterial, { x: 15, y: 60, z: -14 })); // x: 1.5 -> 15, y: 6.0 -> 60, z: -1.4 -> -14
sideClutterGroup.add(createWireframe(clutterBoxGeo, restaurantWireframeMaterial, { x: -13, y: 70, z: -17 }, { y: 0.2 }, { x: 12, y: 8, z: 10 })); // x: -1.3 -> -13, y: 7.0 -> 70, z: -1.7 -> -17, scale: 1.2, 0.8, 1 -> 12, 8, 10
sideClutterGroup.add(createWireframe(new THREE.BoxGeometry(10, 8, 3), restaurantWireframeMaterial, { x: 5, y: 68, z: 8 })); // 1, 0.8, 0.3 -> 10, 8, 3, x: 0.5 -> 5, y: 6.8 -> 68, z: 0.8 -> 8

// Screen / Panel
const screenGeo = new THREE.PlaneGeometry(15, 8); // 1.5, 0.8 -> 15, 8
const screenWire = createWireframe(screenGeo, restaurantWireframeMaterial, { x: 2, y: 55, z: 10.5 }); // x: 0.2 -> 2, y: 5.5 -> 55, z: 1.05 -> 10.5
sideClutterGroup.add(screenWire);

// Rooftop Antenna Dish
const dishGroup = new THREE.Group();
dishGroup.name = "antennaDish";
sideClutterGroup.add(dishGroup);
dishGroup.position.set(8, 80, -8); // x: 0.8 -> 8, y: 8.0 -> 80, z: -0.8 -> -8

const dishGeo = new THREE.CylinderGeometry(6, 6, 0.5, 16); // 0.6, 0.6, 0.05 -> 6, 6, 0.5
const dishWire = createWireframe(dishGeo, restaurantWireframeMaterial, { x: 0, y: 3, z: 0 }, { x: Math.PI / 3, y: 0, z: -0.2 }); // y: 0.3 -> 3
dishGroup.add(dishWire);
const dishMountGeo = new THREE.CylinderGeometry(0.5, 0.5, 5, 8); // 0.05, 0.05, 0.5 -> 0.5, 0.5, 5
const dishMountWire = createWireframe(dishMountGeo, restaurantWireframeMaterial, { x: 0, y: 0, z: 0 });
dishGroup.add(dishMountWire);

// --- Create Street Lamp ---
const lampGroup = new THREE.Group();
restaurantGroup.add(lampGroup);
lampGroup.position.set(-35, 0, 10); // x: -3.5 -> -35, z: 1 -> 10
const lampPoleGeo = new THREE.CylinderGeometry(1, 1.5, 70, 12); // 0.1, 0.15, 7 -> 1, 1.5, 70
const lampPoleWire = createWireframe(lampPoleGeo, restaurantWireframeMaterial, { x: 0, y: 35, z: 0 }); // y: 3.5 -> 35
lampGroup.add(lampPoleWire);
const lampArmGeo = new THREE.BoxGeometry(12, 1, 1); // 1.2, 0.1, 0.1 -> 12, 1, 1
const lampArmWire = createWireframe(lampArmGeo, restaurantWireframeMaterial, { x: 6, y: 65, z: 0 }); // x: 0.6 -> 6, y: 6.5 -> 65
lampGroup.add(lampArmWire);

// Lamp Lights
const lampSphereGeo = new THREE.SphereGeometry(5, 16, 8); // 0.5 -> 5
const lampSphere1 = new THREE.Mesh(lampSphereGeo, lampLightMaterial);
lampSphere1.position.set(11, 65, 0); // x: 1.1 -> 11, y: 6.5 -> 65
lampSphere1.name = "lampLight1";
lampGroup.add(lampSphere1);

const lampSphere2 = new THREE.Mesh(lampSphereGeo, lampLightMaterial.clone());
lampSphere2.position.set(11, 55, 0); // x: 1.1 -> 11, y: 5.5 -> 55
lampSphere2.name = "lampLight2";
lampGroup.add(lampSphere2);

// Small signs attached to lamp pole
const lampSignGeo = new THREE.BoxGeometry(6, 4, 0.5); // 0.6, 0.4, 0.05 -> 6, 4, 0.5
lampGroup.add(createWireframe(lampSignGeo, restaurantWireframeMaterial, { x: 2, y: 50, z: 0 }, { y: -0.3 })); // x: 0.2 -> 2, y: 5.0 -> 50
lampGroup.add(createWireframe(lampSignGeo, restaurantWireframeMaterial, { x: 2, y: 42, z: 0 }, { y: -0.3 }, { x: 8, y: 11, z: 10 })); // x: 0.2 -> 2, y: 4.2 -> 42, scale: 0.8, 1.1, 1 -> 8, 11, 10
lampGroup.add(createWireframe(lampSignGeo, restaurantWireframeMaterial, { x: 2, y: 34, z: 0 }, { y: -0.3 }, { x: 11, y: 9, z: 10 })); // x: 0.2 -> 2, y: 3.4 -> 34, scale: 1.1, 0.9, 1 -> 11, 9, 10

// --- Advanced Female Figure Creation ---
function createAdvancedFemaleModel(material) {
const figureGroup = new THREE.Group();

// Head
const headGeo = new THREE.SphereGeometry(2.5, 32, 24); // 0.25 -> 2.5
const head = new THREE.Mesh(headGeo, material);
head.position.y = 23; // 2.3 -> 23
head.name = "head";
figureGroup.add(head);

// Neck
const neckGeo = new THREE.CylinderGeometry(0.7, 0.9, 1.5, 16); // 0.07, 0.09, 0.15 -> 0.7, 0.9, 1.5
const neck = new THREE.Mesh(neckGeo, material);
neck.position.y = 21.5; // 2.15 -> 21.5
neck.name = "neck";
figureGroup.add(neck);

// Torso
function torsoParametric(u, v, target) {
    const waistRatio = 0.7;
    const bustSize = 3; // 0.3 -> 3
    const width = 3.5; // 0.35 -> 3.5
    const height = 8; // 0.8 -> 8
    const depth = 2.5; // 0.25 -> 2.5
    const y = height * (0.5 - v);
    let widthModifier = 1;
    if (v > 0.3 && v < 0.7) {
        widthModifier = waistRatio + (0.5 - Math.abs(v - 0.5)) * (1 - waistRatio) * 2;
    }
    const theta = u * Math.PI * 2;
    let xRadius = width * widthModifier;
    let zRadius = depth;
    if (v < 0.3 && (theta > Math.PI * 1.5 || theta < Math.PI * 0.5)) {
        const bustFactor = Math.cos(theta) * (0.3 - v) / 0.3;
        if (bustFactor > 0) {
            zRadius += bustFactor * bustSize;
        }
    }
    target.set(
        xRadius * Math.sin(theta),
        y,
        zRadius * Math.cos(theta)
    );
}
const torsoGeo = new ParametricGeometry(torsoParametric, 32, 32);
const torso = new THREE.Mesh(torsoGeo, material);
torso.position.y = 16.5; // 1.65 -> 16.5
torso.name = "torso";
figureGroup.add(torso);

// Hips/Lower Torso
function hipsParametric(u, v, target) {
    const width = 4; // 0.4 -> 4
    const height = 4; // 0.4 -> 4
    const depth = 2.5; // 0.25 -> 2.5
    const y = height * (0.5 - v);
    const widthModifier = 0.8 + v * 0.4;
    const theta = u * Math.PI * 2;
    const xRadius = width * widthModifier;
    const zRadius = depth * (0.8 + 0.2 * Math.cos(theta) * Math.cos(theta));
    target.set(
        xRadius * Math.sin(theta),
        y,
        zRadius * Math.cos(theta)
    );
}
const hipsGeo = new ParametricGeometry(hipsParametric, 24, 16);
const hips = new THREE.Mesh(hipsGeo, material);
hips.position.y = 10.5; // 1.05 -> 10.5
hips.name = "hips";
figureGroup.add(hips);

// Arms
function createArm(isLeft) {
    const armGroup = new THREE.Group();
    armGroup.name = isLeft ? "leftArm" : "rightArm";
    const side = isLeft ? -1 : 1;

    // Upper arm
    const upperArmGeo = new THREE.CylinderGeometry(0.7, 0.6, 4, 16); // 0.07, 0.06, 0.4 -> 0.7, 0.6, 4
    const upperArm = new THREE.Mesh(upperArmGeo, material);
    upperArm.position.set(side * 4.5, -2, 0); // x: 0.45 -> 4.5, y: -0.2 -> -2
    upperArm.rotation.z = side * Math.PI * 0.05;
    upperArm.name = "upperArm";
    armGroup.add(upperArm);

    // Elbow joint
    const elbowGeo = new THREE.SphereGeometry(0.65, 16, 12); // 0.065 -> 0.65
    const elbow = new THREE.Mesh(elbowGeo, material);
    const elbowYPosition = -4; // -0.4 -> -4
    elbow.position.set(side * 4.8, elbowYPosition, 0); // x: 0.48 -> 4.8
    elbow.name = "elbow";
    armGroup.add(elbow);

    // Lower arm
    const lowerArmHeight = 4.5; // 0.45 -> 4.5
    const lowerArmGeo = new THREE.CylinderGeometry(0.6, 0.5, lowerArmHeight, 16); // 0.06, 0.05 -> 0.6, 0.5
    lowerArmGeo.translate(0, -lowerArmHeight / 2, 0);
    const lowerArm = new THREE.Mesh(lowerArmGeo, material);
    lowerArm.position.set(side * 4.8, elbowYPosition, 0); // x: 0.48 -> 4.8
    lowerArm.name = "lowerArm";
    armGroup.add(lowerArm);

    // Wrist & Hand
    const handGeo = new THREE.SphereGeometry(0.55, 16, 12); // 0.055 -> 0.55
    handGeo.scale(1, 0.7, 0.5);
    const hand = new THREE.Mesh(handGeo, material);
    const handYPosition = elbowYPosition - lowerArmHeight;
    hand.position.set(side * 5.3, handYPosition - 0.2, 0.2); // x: 0.53 -> 5.3, y: -0.02 -> -0.2, z: 0.02 -> 0.2
    hand.name = "hand";
    armGroup.add(hand);

    // Fingers hint
    for (let i = 0; i < 4; i++) {
        const fingerGeo = new THREE.CylinderGeometry(0.1, 0.1, 0.8, 3); // 0.01, 0.01, 0.08 -> 0.1, 0.1, 0.8
        const finger = new THREE.Mesh(fingerGeo, material);
        const angle = -Math.PI / 6 + (i * Math.PI / 6);
        finger.position.set(
            side * 5.3 + side * Math.sin(angle) * 0.7, // x: 0.53 -> 5.3, 0.07 -> 0.7
            handYPosition - 0.6 - Math.cos(angle) * 0.7, // y: -0.06 -> -0.6, 0.07 -> 0.7
            0.5 // 0.05 -> 0.5
        );
        finger.rotation.x = Math.PI / 2;
        armGroup.add(finger);
    }

    armGroup.position.y = 18.5; // 1.85 -> 18.5
    return armGroup;
}

const leftArm = createArm(true);
const rightArm = createArm(false);
figureGroup.add(leftArm);
figureGroup.add(rightArm);

// Legs
function createLeg(isLeft) {
    const legGroup = new THREE.Group();
    legGroup.name = isLeft ? "leftLeg" : "rightLeg";
    const side = isLeft ? -1 : 1;

    // Upper leg
    function thighParametric(u, v, target) {
        const height = 5.5; // 0.55 -> 5.5
        const topRadius = 1.2; // 0.12 -> 1.2
        const bottomRadius = 0.8; // 0.08 -> 0.8
        const y = height * (0.5 - v);
        const radius = topRadius * (1 - v) + bottomRadius * v;
        const curve = 0.15 * Math.sin(v * Math.PI); // 0.015 -> 0.15
        const theta = u * Math.PI * 2;
        const xRadius = radius * (0.9 + 0.1 * Math.cos(theta));
        const zRadius = radius * (0.9 + 0.2 * Math.sin(theta));
        target.set(
            side * (xRadius * Math.sin(theta) + curve),
            y,
            zRadius * Math.cos(theta)
        );
    }
    const thighGeo = new ParametricGeometry(thighParametric, 16, 16);
    const thigh = new THREE.Mesh(thighGeo, material);
    thigh.position.set(side * 2.2, -2.8, 0); // x: 0.22 -> 2.2, y: -0.28 -> -2.8
    thigh.name = "thigh";
    legGroup.add(thigh);

    // Knee joint
    const kneeGeo = new THREE.SphereGeometry(0.7, 16, 12); // 0.07 -> 0.7
    const knee = new THREE.Mesh(kneeGeo, material);
    const kneeYPosition = -5.6; // -0.56 -> -5.6
    knee.position.set(side * 2.2, kneeYPosition, 0); // x: 0.22 -> 2.2
    knee.name = "knee";
    legGroup.add(knee);

    // Lower leg
    const calfHeight = 6; // 0.6 -> 6
    const calfGeo = new THREE.CylinderGeometry(0.7, 0.5, calfHeight, 16); // 0.07, 0.05 -> 0.7, 0.5
    calfGeo.translate(0, -calfHeight / 2, 0);
    const calf = new THREE.Mesh(calfGeo, material);
    calf.position.set(side * 2.2, kneeYPosition, 0); // x: 0.22 -> 2.2
    calf.name = "calf";
    legGroup.add(calf);

    // Ankle and foot
    const ankleGeo = new THREE.SphereGeometry(0.5, 12, 8); // 0.05 -> 0.5
    const ankle = new THREE.Mesh(ankleGeo, material);
    const ankleYPosition = kneeYPosition - calfHeight;
    ankle.position.set(side * 2.2, ankleYPosition, 0); // x: 0.22 -> 2.2
    ankle.name = "ankle";
    legGroup.add(ankle);

    const footGeo = new THREE.SphereGeometry(0.6, 16, 8); // 0.06 -> 0.6
    footGeo.scale(1, 0.4, 2);
    const foot = new THREE.Mesh(footGeo, material);
    foot.position.set(side * 2.2, ankleYPosition - 0.5, 0.8); // x: 0.22 -> 2.2, y: -0.05 -> -0.5, z: 0.08 -> 0.8
    foot.name = "foot";
    legGroup.add(foot);

    legGroup.position.y = 10; // 1.0 -> 10
    return legGroup;
}

const leftLeg = createLeg(true);
const rightLeg = createLeg(false);
figureGroup.add(leftLeg);
figureGroup.add(rightLeg);

return figureGroup;
}

// Create two female figures
console.log("Creating advanced female figures...");
const femaleFigure1 = createAdvancedFemaleModel(femaleWireframeBlue);
femaleFigure1.position.set(40, 1, 35); // x: 4 -> 40, y: 0.1 -> 1, z: 3.5 -> 35
femaleFigure1.rotation.y = -Math.PI / 5;
femaleFigure1.scale.set(1.2, 1.2, 1.2); // Relative scale unchanged
femaleFigure1.name = "figure1";


const femaleFigure2 = createAdvancedFemaleModel(femaleWireframeBlue.clone());
femaleFigure2.position.set(-35, 1, 40); // x: -3.5 -> -35, y: 0.1 -> 1, z: 4 -> 40
femaleFigure2.rotation.y = Math.PI / 3;
femaleFigure2.name = "figure2";

// --- Animation Loop ---
const maxScroll = Math.max(1, document.body.scrollHeight - window.innerHeight);
const figure1_initial_z = 35; // 3.5 -> 35
const figure2_initial_z = 40; // 4.0 -> 40

function animate1() {
requestAnimationFrame(animate1);

const elapsedTime = clock.getElapsedTime();
const deltaTime = clock.getDelta();

// Restaurant Animations
const ramenSign = scene.getObjectByName("ramenSign");
if (ramenSign) { ramenSign.rotation.y = elapsedTime * 0.5; }
const antennaDish = scene.getObjectByName("antennaDish");
if (antennaDish) { antennaDish.rotation.y = elapsedTime * 0.8; }
const lampLight1 = scene.getObjectByName("lampLight1");
if (lampLight1) {
    const pulse = (Math.sin(elapsedTime * 3) + 1) / 2;
    lampLight1.material.color.setHSL(0.54, 0.68, pulse * 0.5 + 0.2);
    lampLight1.material.wireframeLinewidth = pulse * 2 + 1;
}
const lampLight2 = scene.getObjectByName("lampLight2");
if (lampLight2) {
    const pulse = (Math.sin(elapsedTime * 3 + Math.PI / 2) + 1) / 2;
    lampLight2.material.color.setHSL(0.54, 0.68, pulse * 0.5 + 0.2);
    lampLight2.material.wireframeLinewidth = pulse * 2 + 1;
}

const walkSpeed = 3.0;
const walkAmplitude = 7; // 0.7 -> 7
const armSwingAmplitude = 10; // 1.0 -> 10
const headTurnAmplitude = 8; // 0.8 -> 8
const torsoTwistAmplitude = 3; // 0.3 -> 3
const kneeBendAmplitude = 14; // 1.4 -> 14
const elbowBendAmplitude = 12; // 1.2 -> 12
const walkDistance = 20; // 2.0 -> 20
const walkCycleSpeed = 1.0;

// Figure 1 Animations
const fig1 = scene.getObjectByName("figure1");
if (fig1) {
    fig1.position.z = figure1_initial_z + Math.sin(elapsedTime * walkCycleSpeed) * walkDistance;
    const head1 = fig1.getObjectByName("head");
    if (head1) {
        head1.rotation.y = Math.sin(elapsedTime * 0.6) * headTurnAmplitude;
        head1.rotation.x = Math.cos(elapsedTime * 0.5) * 0.3;
    }
    const torso1 = fig1.getObjectByName("torso");
    if (torso1) { torso1.rotation.y = Math.sin(elapsedTime * 0.8) * torsoTwistAmplitude; }
    const leftLegGroup = fig1.getObjectByName("leftLeg");
    if (leftLegGroup) {
        const legAngle = Math.sin(elapsedTime * walkSpeed) * walkAmplitude;
        leftLegGroup.rotation.x = legAngle;
        const calf = leftLegGroup.getObjectByName("calf");
        if (calf) {
            const bendFactor = Math.max(0, Math.sin(elapsedTime * walkSpeed));
            calf.rotation.x = bendFactor * -kneeBendAmplitude;
        }
    }
    const rightLegGroup = fig1.getObjectByName("rightLeg");
    if (rightLegGroup) {
        const legAngle = Math.cos(elapsedTime * walkSpeed) * walkAmplitude * -1;
        rightLegGroup.rotation.x = legAngle;
        const calf = rightLegGroup.getObjectByName("calf");
        if (calf) {
            const bendFactor = Math.max(0, Math.cos(elapsedTime * walkSpeed) * -1);
            calf.rotation.x = bendFactor * -kneeBendAmplitude;
        }
    }
    const leftArmGroup = fig1.getObjectByName("leftArm");
    if (leftArmGroup) {
        const armAngle = Math.cos(elapsedTime * walkSpeed) * armSwingAmplitude;
        leftArmGroup.rotation.x = armAngle;
        const lowerArm = leftArmGroup.getObjectByName("lowerArm");
        if (lowerArm) {
            const bendFactor = Math.max(0, Math.cos(elapsedTime * walkSpeed));
            lowerArm.rotation.x = bendFactor * elbowBendAmplitude;
        }
    }
    const rightArmGroup = fig1.getObjectByName("rightArm");
    if (rightArmGroup) {
        const armAngle = Math.sin(elapsedTime * walkSpeed) * armSwingAmplitude;
        rightArmGroup.rotation.x = armAngle;
        const lowerArm = rightArmGroup.getObjectByName("lowerArm");
        if (lowerArm) {
            const bendFactor = Math.max(0, Math.sin(elapsedTime * walkSpeed));
            lowerArm.rotation.x = bendFactor * elbowBendAmplitude;
        }
    }
}

// Figure 2 Animations
const fig2 = scene.getObjectByName("figure2");
if (fig2) {
    const head2 = fig2.getObjectByName("head");
    if (head2) {
        head2.rotation.y = Math.cos(elapsedTime * 0.55) * headTurnAmplitude;
        head2.rotation.x = Math.sin(elapsedTime * 0.45) * 0.35;
    }
    const torso2 = fig2.getObjectByName("torso");
    if (torso2) { torso2.rotation.y = Math.cos(elapsedTime * 0.7) * torsoTwistAmplitude; }
    const leftArm2 = fig2.getObjectByName("leftArm");
    if (leftArm2) { leftArm2.rotation.x = Math.cos(elapsedTime * walkSpeed + 0.5) * armSwingAmplitude; }
    const rightArm2 = fig2.getObjectByName("rightArm");
    if (rightArm2) { rightArm2.rotation.x = Math.sin(elapsedTime * walkSpeed + 0.5) * armSwingAmplitude; }
    const leftLeg2 = fig2.getObjectByName("leftLeg");
    if (leftLeg2) { leftLeg2.rotation.x = Math.sin(elapsedTime * walkSpeed + 0.5) * walkAmplitude; }
    const rightLeg2 = fig2.getObjectByName("rightLeg");
    if (rightLeg2) { rightLeg2.rotation.x = Math.cos(elapsedTime * walkSpeed + 0.5) * walkAmplitude * -1; }
}

// Scroll Related & Rendering
const scrollY = window.scrollY;
const maxScroll = Math.max(1, document.body.scrollHeight - window.innerHeight);
const normalizedScroll = Math.min(scrollY / maxScroll, 1);
const scrollInfoOpacity = Math.max(0, 1 - normalizedScroll * 3);
document.getElementById('scrollInfo').style.opacity = scrollInfoOpacity;
controls.update();
renderer.render(scene, camera);
}

animate1();
restaurantGroup.position.set(170,0,100)
restaurantGroup.rotation.set(0 , Math.PI + Math.PI/6, 0);
restaurantGroup.scale.set(2, 2, 2);
staticRoadGroup.add(restaurantGroup);


</script>

</body>
</html>